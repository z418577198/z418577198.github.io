<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>珠峰架构师成长计划</title>
    <link rel="stylesheet" type="text/css" href="../static/css/main.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" >
    <style>.page-toc > ul .red {
            background: #f3f3f3;
            z-index: 1;
            border-left: 3px solid #009a61;
            -webkit-transition: all .2s ease;
            transition: all .2s ease;
            color: #000
        }
    </style>
</head>
<body>
<div class="nav">
    <div class="logo">
        
                    珠峰架构师成长计划
                        
                        </div>
                        <ul><li><a href="../index.html">0.Async</a></li><li><a href="0.editor.html">0.editor</a></li><li><a href="0.module.html">0.module</a></li><li><a href="1.ES2015.html">1.ES2015</a></li><li><a href="2.Promise.html">2.Promise</a></li><li><a href="3.Node.html">3.Node</a></li><li><a href="4.NodeInstall.html">4.NodeInstall</a></li><li><a href="5.REPL.html">5.REPL</a></li><li><a href="6.NodeCore.html">6.NodeCore</a></li><li><a href="7.module&NPM.html">7.module&NPM</a></li><li><a href="8.Encoding.html">8.Encoding</a></li><li><a href="9.Buffer.html">9.Buffer</a></li><li><a href="10.fs.html">10.fs</a></li><li><a href="11.Stream-1.html">11.Stream-1</a></li><li><a href="11.Stream-2.html">11.Stream-2</a></li><li><a href="11.Stream-3.html">11.Stream-3</a></li><li><a href="11.Stream-4.html">11.Stream-4</a></li><li><a href="12-Network-2.html">12-Network-2</a></li><li><a href="12.NetWork-3.html">12.NetWork-3</a></li><li><a href="12.Network-1.html">12.Network-1</a></li><li><a href="13.tcp.html">13.tcp</a></li><li><a href="14.http-1.html">14.http-1</a></li><li><a href="14.http-2.html">14.http-2</a></li><li><a href="15.compress.html">15.compress</a></li><li><a href="16.crypto.html">16.crypto</a></li><li><a href="17.process.html">17.process</a></li><li><a href="18.yargs.html">18.yargs</a></li><li><a href="19.cache.html">19.cache</a></li><li><a href="20.action.html">20.action</a></li><li><a href="21.https.html">21.https</a></li><li><a href="22.cookie.html">22.cookie</a></li><li><a href="23.session.html">23.session</a></li><li><a href="24.express-1.html">24.express-1</a></li><li><a href="24.express-2.html">24.express-2</a></li><li><a href="24.express-3.html">24.express-3</a></li><li><a href="24.express-4.html">24.express-4</a></li><li><a href="25.koa-1.html">25.koa-1</a></li><li><a href="26.webpack-1-basic.html">26.webpack-1-basic</a></li><li><a href="26.webpack-2-optimize.html">26.webpack-2-optimize</a></li><li><a href="26.webpack-3-file.html">26.webpack-3-file</a></li><li><a href="26.webpack-4.tapable.html">26.webpack-4.tapable</a></li><li><a href="26.webpack-5-AST.html">26.webpack-5-AST</a></li><li><a href="26.webpack-6-sources.html">26.webpack-6-sources</a></li><li><a href="26.webpack-7-loader.html">26.webpack-7-loader</a></li><li><a href="26.webpack-8-plugin.html">26.webpack-8-plugin</a></li><li><a href="26.webpack-9-hand.html">26.webpack-9-hand</a></li><li><a href="26.webpack-10-prepare.html">26.webpack-10-prepare</a></li><li><a href="28.redux.html">28.redux</a></li><li><a href="28.redux-jwt-back.html">28.redux-jwt-back</a></li><li><a href="28.redux-jwt-front.html">28.redux-jwt-front</a></li><li><a href="29.mongodb-1.html">29.mongodb-1</a></li><li><a href="29.mongodb-2.html">29.mongodb-2</a></li><li><a href="29.mongodb-3.html">29.mongodb-3</a></li><li><a href="29.mongodb-4.html">29.mongodb-4</a></li><li><a href="29.mongodb-5.html">29.mongodb-5</a></li><li><a href="29.mongodb-6.html">29.mongodb-6</a></li><li><a href="30.cms-1-mysql.html">30.cms-1-mysql</a></li><li><a href="30.cms-2-mysql.html">30.cms-2-mysql</a></li><li><a href="30.cms-3-mysql.html">30.cms-3-mysql</a></li><li><a href="30.cms-4-nunjucks.html">30.cms-4-nunjucks</a></li><li><a href="30.cms-5-mock.html">30.cms-5-mock</a></li><li><a href="30.cms-6-egg.html">30.cms-6-egg</a></li><li><a href="30.cms-7-api.html">30.cms-7-api</a></li><li><a href="30.cms-8-roadhog.html">30.cms-8-roadhog</a></li><li><a href="30.cms-9-yaml.html">30.cms-9-yaml</a></li><li><a href="30.cms-10-umi.html">30.cms-10-umi</a></li><li><a href="30.cms-12-dva.html">30.cms-12-dva</a></li><li><a href="30.cms-13-dva-ant.html">30.cms-13-dva-ant</a></li><li><a href="30.cms-14-front.html">30.cms-14-front</a></li><li><a href="30.cms-15-deploy.html">30.cms-15-deploy</a></li><li><a href="31.dva.html">31.dva</a></li><li><a href="31.cms-13-dva-antdesign.html">31.cms-13-dva-antdesign</a></li><li><a href="33.redis.html">33.redis</a></li><li><a href="34.unittest.html">34.unittest</a></li><li><a href="35.jwt.html">35.jwt</a></li><li><a href="36.websocket-1.html">36.websocket-1</a></li><li><a href="36.websocket-2.html">36.websocket-2</a></li><li><a href="38.chat-api-1.html">38.chat-api-1</a></li><li><a href="38.chat-api-2.html">38.chat-api-2</a></li><li><a href="38.chat-3.html">38.chat-3</a></li><li><a href="38.chat-api-3.html">38.chat-api-3</a></li><li><a href="38.chat.html">38.chat</a></li><li><a href="38.chat2.html">38.chat2</a></li><li><a href="38.chat2.html">38.chat2</a></li><li><a href="39.crawl-0.html">39.crawl-0</a></li><li><a href="39.crawl-1.html">39.crawl-1</a></li><li><a href="39.crawl-2.html">39.crawl-2</a></li><li><a href="40.deploy.html">40.deploy</a></li><li><a href="41.safe.html">41.safe</a></li><li><a href="42.test.html">42.test</a></li><li><a href="43.nginx.html">43.nginx</a></li><li><a href="44.enzyme.html">44.enzyme</a></li><li><a href="45.docker.html">45.docker</a></li><li><a href="46.elastic.html">46.elastic</a></li><li><a href="47.oauth.html">47.oauth</a></li><li><a href="48.wxpay.html">48.wxpay</a></li><li><a href="index.html">index</a></li><li><a href="52.UML.html">52.UML</a></li><li><a href="53.design.html">53.design</a></li><li><a href="index.html">index</a></li><li><a href="54.linux.html">54.linux</a></li><li><a href="57.ts.html">57.ts</a></li><li><a href="56.react-ssr.html">56.react-ssr</a></li><li><a href="58.ts_react.html">58.ts_react</a></li><li><a href="59.ketang.html">59.ketang</a></li><li><a href="59.ketang2.html">59.ketang2</a></li><li><a href="61.1.devops-linux.html">61.1.devops-linux</a></li><li><a href="61.2.devops-vi.html">61.2.devops-vi</a></li><li><a href="61.3.devops-user.html">61.3.devops-user</a></li><li><a href="61.4.devops-auth.html">61.4.devops-auth</a></li><li><a href="61.5.devops-shell.html">61.5.devops-shell</a></li><li><a href="61.6.devops-install.html">61.6.devops-install</a></li><li><a href="61.7.devops-system.html">61.7.devops-system</a></li><li><a href="61.8.devops-service.html">61.8.devops-service</a></li><li><a href="61.9.devops-network.html">61.9.devops-network</a></li><li><a href="61.10.devops-nginx.html">61.10.devops-nginx</a></li><li><a href="61.11.devops-docker.html">61.11.devops-docker</a></li><li><a href="61.12.devops-jekins.html">61.12.devops-jekins</a></li><li><a href="61.13.devops-groovy.html">61.13.devops-groovy</a></li><li><a href="61.14.devops-php.html">61.14.devops-php</a></li><li><a href="61.15.devops-java.html">61.15.devops-java</a></li><li><a href="61.16.devops-node.html">61.16.devops-node</a></li><li><a href="61.17.devops-k8s.html">61.17.devops-k8s</a></li><li><a href="62.1.react-basic.html">62.1.react-basic</a></li><li><a href="62.2.react-state.html">62.2.react-state</a></li><li><a href="62.3.react-high.html">62.3.react-high</a></li><li><a href="62.4.react-optimize.html">62.4.react-optimize</a></li><li><a href="62.5.react-hooks.html">62.5.react-hooks</a></li><li><a href="62.6.react-immutable.html">62.6.react-immutable</a></li><li><a href="62.7.react-mobx.html">62.7.react-mobx</a></li><li><a href="62.8.react-source.html">62.8.react-source</a></li><li><a href="63.1.redux.html">63.1.redux</a></li><li><a href="63.2.redux-middleware.html">63.2.redux-middleware</a></li><li><a href="63.3.redux-hooks.html">63.3.redux-hooks</a></li><li><a href="63.4.redux-saga.html">63.4.redux-saga</a></li><li><a href="63.5.redux-saga-hand.html">63.5.redux-saga-hand</a></li><li><a href="64.1.router.html">64.1.router</a></li><li><a href="64.2.router-connected.html">64.2.router-connected</a></li><li><a href="65.1.typescript.html">65.1.typescript</a></li><li><a href="65.2.typescript.html">65.2.typescript</a></li><li><a href="65.3.typescript.html">65.3.typescript</a></li><li><a href="65.4.antd.html">65.4.antd</a></li><li><a href="65.4.definition.html">65.4.definition</a></li><li><a href="66-1.vue-base.html">66-1.vue-base</a></li><li><a href="66-2.vue-component.html">66-2.vue-component</a></li><li><a href="66-3.vue-cli3.0.html">66-3.vue-cli3.0</a></li><li><a href="66-4.$message组件.html">66-4.$message组件</a></li><li><a href="66-5.Form组件.html">66-5.Form组件</a></li><li><a href="66-6.tree.html">66-6.tree</a></li><li><a href="66-7.vue-router-apply.html">66-7.vue-router-apply</a></li><li><a href="66-8.axios-apply.html">66-8.axios-apply</a></li><li><a href="66-9.vuex-apply.html">66-9.vuex-apply</a></li><li><a href="66-10.jwt-vue.html">66-10.jwt-vue</a></li><li><a href="66-11.vue-ssr.html">66-11.vue-ssr</a></li><li><a href="66-12.nuxt-apply.html">66-12.nuxt-apply</a></li><li><a href="66-13.pwa.html">66-13.pwa</a></li><li><a href="66-14.vue单元测试.html">66-14.vue单元测试</a></li><li><a href="66-15.权限校验.html">66-15.权限校验</a></li><li><a href="67-1-network.html">67-1-network</a></li><li><a href="68-2-wireshark.html">68-2-wireshark</a></li><li><a href="7.npm2.html">7.npm2</a></li><li><a href="69-hooks.html">69-hooks</a></li><li><a href="70-deploy.html">70-deploy</a></li><li><a href="71-hmr.html">71-hmr</a></li><li><a href="72.deploy.html">72.deploy</a></li><li><a href="73.import.html">73.import</a></li><li><a href="74.mobile.html">74.mobile</a></li><li><a href="75.webpack-1.文件分析.html">75.webpack-1.文件分析</a></li><li><a href="75.webpack-2.loader.html">75.webpack-2.loader</a></li><li><a href="75.webpack-3.源码流程.html">75.webpack-3.源码流程</a></li><li><a href="75.webpack-4.tapable.html">75.webpack-4.tapable</a></li><li><a href="75.webpack-5.prepare.html">75.webpack-5.prepare</a></li><li><a href="75.webpack-6.resolve.html">75.webpack-6.resolve</a></li><li><a href="75.webpack-7.loader.html">75.webpack-7.loader</a></li><li><a href="75.webpack-8.module.html">75.webpack-8.module</a></li><li><a href="75.webpack-9.chunk.html">75.webpack-9.chunk</a></li><li><a href="75.webpack-10.asset.html">75.webpack-10.asset</a></li><li><a href="75.webpack-11.实现.html">75.webpack-11.实现</a></li><li><a href="76.react_optimize.html">76.react_optimize</a></li><li><a href="77.ts_ketang_back.html">77.ts_ketang_back</a></li><li><a href="77.ts_ketang_front.html">77.ts_ketang_front</a></li><li><a href="78.vue-domdiff.html">78.vue-domdiff</a></li><li><a href="79.grammar.html">79.grammar</a></li><li><a href="80.tree.html">80.tree</a></li><li><a href="81.axios.html">81.axios</a></li><li><a href="82.1.react.html">82.1.react</a></li><li><a href="82.2.react-high.html">82.2.react-high</a></li><li><a href="82.3.react-router.html">82.3.react-router</a></li><li><a href="82.4.redux.html">82.4.redux</a></li><li><a href="82.5.redux_middleware.html">82.5.redux_middleware</a></li><li><a href="82.6.connected.html">82.6.connected</a></li><li><a href="82.7.saga.html">82.7.saga</a></li><li><a href="82.8.dva.html">82.8.dva</a></li><li><a href="82.8.dva-source.html">82.8.dva-source</a></li><li><a href="82.9.roadhog.html">82.9.roadhog</a></li><li><a href="82.10.umi.html">82.10.umi</a></li><li><a href="82.11.antdesign.html">82.11.antdesign</a></li><li><a href="82.12.ketang-front.html">82.12.ketang-front</a></li><li><a href="82.12.ketang-back.html">82.12.ketang-back</a></li><li><a href="83.upload.html">83.upload</a></li><li><a href="84.graphql.html">84.graphql</a></li><li><a href="85.antpro.html">85.antpro</a></li><li><a href="86.1.uml.html">86.1.uml</a></li><li><a href="86.2.design.html">86.2.design</a></li><li><a href="87.postcss.html">87.postcss</a></li><li><a href="88.react16-1.html">88.react16-1</a></li><li><a href="89.nextjs.html">89.nextjs</a></li><li><a href="90.react-test.html">90.react-test</a></li><li><a href="91.react-ts.html">91.react-ts</a></li><li><a href="92.rbac.html">92.rbac</a></li><li><a href="93.tsnode.html">93.tsnode</a></li><li><a href="94.1.JavaScript.html">94.1.JavaScript</a></li><li><a href="94.2.JavaScript.html">94.2.JavaScript</a></li><li><a href="94.3.MODULE.html">94.3.MODULE</a></li><li><a href="94.4.EventLoop.html">94.4.EventLoop</a></li><li><a href="94.5.文件上传.html">94.5.文件上传</a></li><li><a href="94.6.https.html">94.6.https</a></li><li><a href="94.7. nginx.html">94.7. nginx</a></li><li><a href="95.1. react.html">95.1. react</a></li><li><a href="95.2.react.html">95.2.react</a></li><li><a href="96.1.react16.html">96.1.react16</a></li><li><a href="96.2.fiber.html">96.2.fiber</a></li><li><a href="96.3.fiber.html">96.3.fiber</a></li><li><a href="97.serverless.html">97.serverless</a></li><li><a href="98.websocket.html">98.websocket</a></li><li><a href="100.1.react-basic.html">100.1.react-basic</a></li><li><a href="101.1.monitor.html">101.1.monitor</a></li><li><a href="101.2.monitor.html">101.2.monitor</a></li><li><a href="102.java.html">102.java</a></li><li><a href="103.1.webpack-usage.html">103.1.webpack-usage</a></li><li><a href="103.2.webpack-bundle.html">103.2.webpack-bundle</a></li><li><a href="103.3.webpack-ast.html">103.3.webpack-ast</a></li><li><a href="103.4.webpack-flow.html">103.4.webpack-flow</a></li><li><a href="103.5.webpack-loader.html">103.5.webpack-loader</a></li><li><a href="103.6.webpack-tapable.html">103.6.webpack-tapable</a></li><li><a href="103.7.webpack-plugin.html">103.7.webpack-plugin</a></li><li><a href="103.8.webpack-optimize1.html">103.8.webpack-optimize1</a></li><li><a href="103.9.webpack-optimize2.html">103.9.webpack-optimize2</a></li><li><a href="103.10.webpack-hand.html">103.10.webpack-hand</a></li><li><a href="103.11.webpack-hmr.html">103.11.webpack-hmr</a></li><li><a href="103.13.webpack5.html">103.13.webpack5</a></li><li><a href="103.14.webpack-sourcemap.html">103.14.webpack-sourcemap</a></li><li><a href="103.15.webpack-compiler1.html">103.15.webpack-compiler1</a></li><li><a href="103.15.webpack-compiler2.html">103.15.webpack-compiler2</a></li><li><a href="103.16.vite.basic.html">103.16.vite.basic</a></li><li><a href="104.1.binary.html">104.1.binary</a></li><li><a href="104.2.binary.html">104.2.binary</a></li><li><a href="105.skeleton.html">105.skeleton</a></li><li class="active"><a href="106.1.react.html">106.1.react</a></li><li><a href="106.1.react_source.html">106.1.react_source</a></li><li><a href="106.2.react_hooks.html">106.2.react_hooks</a></li><li><a href="106.2.react_hooks_source.html">106.2.react_hooks_source</a></li><li><a href="106.3.react_router.html">106.3.react_router</a></li><li><a href="106.4.redux.html">106.4.redux</a></li><li><a href="106.5.redux_middleware.html">106.5.redux_middleware</a></li><li><a href="106.6.connected-react-router.html">106.6.connected-react-router</a></li><li><a href="106.7.redux-saga.html">106.7.redux-saga</a></li><li><a href="106.8.dva.html">106.8.dva</a></li><li><a href="106.9.umi.html">106.9.umi</a></li><li><a href="106.10.antpro.html">106.10.antpro</a></li><li><a href="107.fiber.html">107.fiber</a></li><li><a href="108.http.html">108.http</a></li><li><a href="109.1.webpack_usage.html">109.1.webpack_usage</a></li><li><a href="109.2.webpack_source.html">109.2.webpack_source</a></li><li><a href="109.3.dll.html">109.3.dll</a></li><li><a href="110.nest.js.html">110.nest.js</a></li><li><a href="111.xstate.html">111.xstate</a></li><li><a href="112.Form.html">112.Form</a></li><li><a href="113.redux-saga.html">113.redux-saga</a></li><li><a href="114.react+typescript.html">114.react+typescript</a></li><li><a href="115.immer.html">115.immer</a></li><li><a href="116.pro5.html">116.pro5</a></li><li><a href="117.css-loader.html">117.css-loader</a></li><li><a href="118.1.umi-core.html">118.1.umi-core</a></li><li><a href="119.2.module-federation.html">119.2.module-federation</a></li><li><a href="119.1.module-federation.html">119.1.module-federation</a></li><li><a href="120.create-react-app.html">120.create-react-app</a></li><li><a href="121.react-scripts.html">121.react-scripts</a></li><li><a href="122.react-optimize.html">122.react-optimize</a></li><li><a href="123.jsx-runtime.html">123.jsx-runtime</a></li><li><a href="124.next.js.html">124.next.js</a></li><li><a href="106.11.ketang.html">106.11.ketang</a></li><li><a href="125.1.linux.html">125.1.linux</a></li><li><a href="125.2.linux-vi.html">125.2.linux-vi</a></li><li><a href="125.3.linux-user.html">125.3.linux-user</a></li><li><a href="125.4.linux-auth.html">125.4.linux-auth</a></li><li><a href="125.5.linux-shell.html">125.5.linux-shell</a></li><li><a href="125.6.linux-install.html">125.6.linux-install</a></li><li><a href="125.7.linux-system.html">125.7.linux-system</a></li><li><a href="125.8.linux-service.html">125.8.linux-service</a></li><li><a href="125.9.linux-network.html">125.9.linux-network</a></li><li><a href="125.10.nginx.html">125.10.nginx</a></li><li><a href="125.11.docker.html">125.11.docker</a></li><li><a href="125.12.ci.html">125.12.ci</a></li><li><a href="126.11.react-1.html">126.11.react-1</a></li><li><a href="125.13.k8s.html">125.13.k8s</a></li><li><a href="125.14.k8s.html">125.14.k8s</a></li><li><a href="125.15.k8s.html">125.15.k8s</a></li><li><a href="125.16.k8s.html">125.16.k8s</a></li><li><a href="126.12.react-2.html">126.12.react-2</a></li><li><a href="126.12.react-3.html">126.12.react-3</a></li><li><a href="127.frontend.html">127.frontend</a></li><li><a href="128.rollup.html">128.rollup</a></li><li><a href="129.px2rem-loader.html">129.px2rem-loader</a></li><li><a href="130.health.html">130.health</a></li><li><a href="131.hooks.html">131.hooks</a></li><li><a href="126.12.react-4.html">126.12.react-4</a></li><li><a href="132.keepalive.html">132.keepalive</a></li><li><a href="133.vue-cli.html">133.vue-cli</a></li><li><a href="134.react18.html">134.react18</a></li><li><a href="103.16.vite.source.html">103.16.vite.source</a></li></ul>                        </div>

                        
<div class="warpper">
    <div class="page-toc">
        <ul><li><a href="106.1.react.html#t01.%20%E4%BB%80%E4%B9%88%E6%98%AFReact?">1. 什么是React?</a></li><li><a href="106.1.react.html#t12.%20%E7%BB%84%E4%BB%B6%E5%8C%96%E7%9A%84%E6%A6%82%E5%BF%B5">2. 组件化的概念</a></li><li><a href="106.1.react.html#t23.%E6%90%AD%E5%BB%BAReact%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83">3.搭建React开发环境</a></li><li><a href="106.1.react.html#t34.JSX">4.JSX</a><ul><li><a href="106.1.react.html#t44.1%20%E4%BB%80%E4%B9%88%E6%98%AFJSX">4.1 什么是JSX</a></li><li><a href="106.1.react.html#t54.2%20%E4%BB%80%E4%B9%88%E6%98%AF%E5%85%83%E7%B4%A0">4.2 什么是元素</a></li><li><a href="106.1.react.html#t64.3%20JSX%E8%A1%A8%E8%BE%BE%E5%BC%8F">4.3 JSX表达式</a></li><li><a href="106.1.react.html#t74.4%20JSX%E5%B1%9E%E6%80%A7">4.4 JSX属性</a></li><li><a href="106.1.react.html#t84.5%20JSX%E4%B9%9F%E6%98%AF%E5%AF%B9%E8%B1%A1">4.5 JSX也是对象</a></li><li><a href="106.1.react.html#t94.6%20%E6%9B%B4%E6%96%B0%E5%85%83%E7%B4%A0%E6%B8%B2%E6%9F%93">4.6 更新元素渲染</a></li><li><a href="106.1.react.html#t104.7%20React%E5%8F%AA%E4%BC%9A%E6%9B%B4%E6%96%B0%E5%BF%85%E8%A6%81%E7%9A%84%E9%83%A8%E5%88%86">4.7 React只会更新必要的部分</a></li></ul></li><li><a href="106.1.react.html#t115.%20%E7%BB%84%E4%BB%B6%20&%20Props">5. 组件 & Props</a><ul><li><a href="106.1.react.html#t125.1%20%E5%87%BD%E6%95%B0(%E5%AE%9A%E4%B9%89%E7%9A%84)%E7%BB%84%E4%BB%B6">5.1 函数(定义的)组件</a></li><li><a href="106.1.react.html#t135.2%20%E7%B1%BB(%E5%AE%9A%E4%B9%89%E7%9A%84)%E7%BB%84%E4%BB%B6">5.2 类(定义的)组件</a></li><li><a href="106.1.react.html#t145.3%20%E7%BB%84%E4%BB%B6%E6%B8%B2%E6%9F%93">5.3 组件渲染</a></li></ul></li><li><a href="106.1.react.html#t156.%20%E7%8A%B6%E6%80%81">6. 状态</a><ul><li><a href="106.1.react.html#t166.1%20%E4%B8%8D%E8%A6%81%E7%9B%B4%E6%8E%A5%E4%BF%AE%E6%94%B9%20State">6.1 不要直接修改 State</a></li><li><a href="106.1.react.html#t176.2%20State%20%E7%9A%84%E6%9B%B4%E6%96%B0%E5%8F%AF%E8%83%BD%E6%98%AF%E5%BC%82%E6%AD%A5%E7%9A%84">6.2 State 的更新可能是异步的</a></li><li><a href="106.1.react.html#t186.3%20State%20%E7%9A%84%E6%9B%B4%E6%96%B0%E4%BC%9A%E8%A2%AB%E5%90%88%E5%B9%B6">6.3 State 的更新会被合并</a></li></ul></li><li><a href="106.1.react.html#t197.%20%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86">7. 事件处理</a><ul><li><a href="106.1.react.html#t207.2%20this">7.2 this</a></li><li><a href="106.1.react.html#t217.3%20%E5%90%91%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E7%A8%8B%E5%BA%8F%E4%BC%A0%E9%80%92%E5%8F%82%E6%95%B0">7.3 向事件处理程序传递参数</a></li><li><a href="106.1.react.html#t227.4%20Ref">7.4 Ref</a><ul><li><a href="106.1.react.html#t237.4.1%20%E4%B8%BA%20DOM%20%E5%85%83%E7%B4%A0%E6%B7%BB%E5%8A%A0%20ref">7.4.1 为 DOM 元素添加 ref</a></li><li><a href="106.1.react.html#t247.4.2%20%E4%B8%BA%20class%20%E7%BB%84%E4%BB%B6%E6%B7%BB%E5%8A%A0%20Ref">7.4.2 为 class 组件添加 Ref</a></li><li><a href="106.1.react.html#t257.4.3%20Ref%E8%BD%AC%E5%8F%91">7.4.3 Ref转发</a></li></ul></li></ul></li><li><a href="106.1.react.html#t268.%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F">8.生命周期</a><ul><li><a href="106.1.react.html#t278.1%20%E6%97%A7%E7%89%88%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F">8.1 旧版生命周期</a></li><li><a href="106.1.react.html#t288.2%20%E6%96%B0%E7%89%88%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F">8.2 新版生命周期</a><ul><li><a href="106.1.react.html#t298.2.1%20getDerivedStateFromProps">8.2.1 getDerivedStateFromProps</a></li><li><a href="106.1.react.html#t308.2.2%20getSnapshotBeforeUpdate">8.2.2 getSnapshotBeforeUpdate</a></li></ul></li></ul></li><li><a href="106.1.react.html#t319.Context(%E4%B8%8A%E4%B8%8B%E6%96%87)">9.Context(上下文)</a><ul><li><a href="106.1.react.html#t329.1%20%E4%BD%BF%E7%94%A8">9.1 使用</a></li></ul></li><li><a href="106.1.react.html#t3310.%20%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6">10. 高阶组件</a><ul><li><a href="106.1.react.html#t3410.1%20cra%E6%94%AF%E6%8C%81%E8%A3%85%E9%A5%B0%E5%99%A8">10.1 cra支持装饰器</a><ul><li><a href="106.1.react.html#t3510.1.1%20%E5%AE%89%E8%A3%85">10.1.1 安装</a></li><li><a href="106.1.react.html#t3610.1.2%20%E4%BF%AE%E6%94%B9package.json">10.1.2 修改package.json</a></li><li><a href="106.1.react.html#t3710.1.3%20config-overrides.js">10.1.3 config-overrides.js</a></li><li><a href="106.1.react.html#t3810.1.4%20jsconfig.json">10.1.4 jsconfig.json</a></li></ul></li><li><a href="106.1.react.html#t3910.2%20%E5%B1%9E%E6%80%A7%E4%BB%A3%E7%90%86">10.2 属性代理</a></li><li><a href="106.1.react.html#t4010.3%20%E5%8F%8D%E5%90%91%E7%BB%A7%E6%89%BF">10.3 反向继承</a></li><li><a href="106.1.react.html#t4110.3%20@%E4%BF%AE%E9%A5%B0%E7%AC%A6">10.3 @修饰符</a></li></ul></li><li><a href="106.1.react.html#t4211.%20render%20props">11. render props</a><ul><li><a href="106.1.react.html#t4311.1%20%E5%8E%9F%E7%94%9F%E5%AE%9E%E7%8E%B0">11.1 原生实现</a></li><li><a href="106.1.react.html#t4411.2%20%20children">11.2  children</a></li><li><a href="106.1.react.html#t4511.3%20render%E5%B1%9E%E6%80%A7">11.3 render属性</a></li><li><a href="106.1.react.html#t4611.4%20HOC">11.4 HOC</a></li></ul></li><li><a href="106.1.react.html#t4712.%20shouldComponentUpdate">12. shouldComponentUpdate</a><ul><li><a href="106.1.react.html#t4812.1%20PureComponent">12.1 PureComponent</a></li><li><a href="106.1.react.html#t4912.2%20memo">12.2 memo</a></li></ul></li><li><a href="106.1.react.html#t5013.%20memo">13. memo</a><ul><li><a href="106.1.react.html#t5113.1%20src/utils.js">13.1 src\utils.js</a></li><li><a href="106.1.react.html#t5213.2%20src/Component.js">13.2 src\Component.js</a></li><li><a href="106.1.react.html#t5313.3%20src/constants.js">13.3 src\constants.js</a></li><li><a href="106.1.react.html#t5413.4%20src/react.js">13.4 src\react.js</a></li><li><a href="106.1.react.html#t5513.5%20src/react-dom.js">13.5 src\react-dom.js</a></li></ul></li><li><a href="106.1.react.html#t561.%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE">1.创建项目</a><ul><li><a href="106.1.react.html#t571.1%20%E4%BF%AE%E6%94%B9%E5%91%BD%E4%BB%A4">1.1 修改命令</a></li><li><a href="106.1.react.html#t581.2%20src/index.js">1.2 src\index.js</a></li><li><a href="106.1.react.html#t591.3%20public/index.html">1.3 public\index.html</a></li></ul></li><li><a href="106.1.react.html#t602.%E5%AE%9E%E7%8E%B0%E5%85%83%E7%B4%A0%E7%9A%84%E6%B8%B2%E6%9F%93">2.实现元素的渲染</a><ul><li><a href="106.1.react.html#t612.1%20src/index.js">2.1 src\index.js</a></li><li><a href="106.1.react.html#t622.2%20src/constants.js">2.2 src\constants.js</a></li><li><a href="106.1.react.html#t632.3%20src/utils.js">2.3 src\utils.js</a></li><li><a href="106.1.react.html#t642.4%20src/react.js">2.4 src\react.js</a></li><li><a href="106.1.react.html#t652.5%20react-dom.js">2.5 react-dom.js</a></li></ul></li><li><a href="106.1.react.html#t663.%E5%87%BD%E6%95%B0%E7%BB%84%E4%BB%B6%E6%B8%B2%E6%9F%93">3.函数组件渲染</a><ul><li><a href="106.1.react.html#t673.1%20src/index.js">3.1 src\index.js</a></li><li><a href="106.1.react.html#t683.2%20react-dom.js">3.2 react-dom.js</a></li></ul></li><li><a href="106.1.react.html#t694.%E7%B1%BB%E7%BB%84%E4%BB%B6%E6%B8%B2%E6%9F%93">4.类组件渲染</a><ul><li><a href="106.1.react.html#t704.1%20src/index.js">4.1 src\index.js</a></li><li><a href="106.1.react.html#t714.2%20src/Component.js">4.2 src\Component.js</a></li><li><a href="106.1.react.html#t724.3%20src/react.js">4.3 src\react.js</a></li><li><a href="106.1.react.html#t734.4%20src/react-dom.js">4.4 src\react-dom.js</a></li></ul></li><li><a href="106.1.react.html#t745.%E7%B1%BB%E7%BB%84%E4%BB%B6%E6%9B%B4%E6%96%B0">5.类组件更新</a><ul><li><a href="106.1.react.html#t755.1%20src/index.js">5.1 src\index.js</a></li><li><a href="106.1.react.html#t765.2%20src/Component.js">5.2 src\Component.js</a></li><li><a href="106.1.react.html#t775.3%20src/react-dom.js">5.3 src\react-dom.js</a></li></ul></li><li><a href="106.1.react.html#t786.%E5%90%88%E6%88%90%E4%BA%8B%E4%BB%B6%E5%92%8C%E6%89%B9%E9%87%8F%E6%9B%B4%E6%96%B0">6.合成事件和批量更新</a><ul><li><a href="106.1.react.html#t796.1%20src/index.js">6.1 src\index.js</a></li><li><a href="106.1.react.html#t806.2%20src/utils.js">6.2 src\utils.js</a></li><li><a href="106.1.react.html#t816.3%20src/Component.js">6.3 src\Component.js</a></li><li><a href="106.1.react.html#t826.4%20src/event.js">6.4 src\event.js</a></li><li><a href="106.1.react.html#t836.5%20src/react-dom.js">6.5 src\react-dom.js</a></li></ul></li><li><a href="106.1.react.html#t847.ref">7.ref</a><ul><li><a href="106.1.react.html#t857.1%20src/index.js">7.1 src\index.js</a></li><li><a href="106.1.react.html#t867.2%20src/constants.js">7.2 src\constants.js</a></li><li><a href="106.1.react.html#t877.3%20src/react.js">7.3 src\react.js</a></li><li><a href="106.1.react.html#t887.3%20src/react-dom.js">7.3 src\react-dom.js</a></li></ul></li><li><a href="106.1.react.html#t898.%E5%9F%BA%E6%9C%AC%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F">8.基本生命周期</a><ul><li><a href="106.1.react.html#t908.1%20src/index.js">8.1 src\index.js</a></li><li><a href="106.1.react.html#t918.2%20src/Component.js">8.2 src\Component.js</a></li><li><a href="106.1.react.html#t928.3%20src/react-dom.js">8.3 src\react-dom.js</a></li></ul></li><li><a href="106.1.react.html#t939.%E5%AD%90%E7%BB%84%E4%BB%B6%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F">9.子组件生命周期</a><ul><li><a href="106.1.react.html#t949.1%20src/index.js">9.1 src\index.js</a></li><li><a href="106.1.react.html#t959.2%20src/Component.js">9.2 src\Component.js</a></li><li><a href="106.1.react.html#t969.3%20react-dom.js">9.3 react-dom.js</a></li></ul></li><li><a href="106.1.react.html#t9710.DOM-DIFF%E7%AE%97%E6%B3%95">10.DOM-DIFF算法</a><ul><li><a href="106.1.react.html#t9810.1%20React%E4%BC%98%E5%8C%96%E5%8E%9F%E5%88%99">10.1 React优化原则</a></li></ul></li><li><a href="106.1.react.html#t9911.%E6%96%B0%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F">11.新的生命周期</a><ul><li><a href="106.1.react.html#t10011.1%20Component.js">11.1 Component.js</a></li></ul></li><li><a href="106.1.react.html#t10112.context">12.context</a><ul><li><a href="106.1.react.html#t10212.1%20src/index.js">12.1 src\index.js</a></li><li><a href="106.1.react.html#t10312.2%20src/react.js">12.2 src\react.js</a></li></ul></li><li><a href="106.1.react.html#t10412.context">12.context</a><ul><li><a href="106.1.react.html#t10512.1%20src/constants.js">12.1 src\constants.js</a></li><li><a href="106.1.react.html#t10612.2%20src/Component.js">12.2 src\Component.js</a></li><li><a href="106.1.react.html#t10712.3%20src/react.js">12.3 src\react.js</a></li><li><a href="106.1.react.html#t10812.4%20src/react-dom.js">12.4 src\react-dom.js</a></li></ul></li><li><a href="106.1.react.html#t10913.HOC">13.HOC</a><ul><li><a href="106.1.react.html#t11013.1%20src/react.js">13.1 src\react.js</a></li></ul></li></ul>
    </div>
    <div class="content markdown-body">
        <h2 id="t01. &#x4EC0;&#x4E48;&#x662F;React?">1. &#x4EC0;&#x4E48;&#x662F;React? <a href="106.1.react.html#t01.%20%E4%BB%80%E4%B9%88%E6%98%AFReact?"> # </a></h2>
<ul>
<li>React &#x662F;&#x4E00;&#x4E2A;&#x7528;&#x4E8E;&#x6784;&#x5EFA;&#x7528;&#x6237;&#x754C;&#x9762;&#x7684;JavaScript&#x5E93; &#x6838;&#x5FC3;&#x4E13;&#x6CE8;&#x4E8E;&#x89C6;&#x56FE;,&#x76EE;&#x7684;&#x5B9E;&#x73B0;&#x7EC4;&#x4EF6;&#x5316;&#x5F00;&#x53D1;</li>
</ul>
<h2 id="t12. &#x7EC4;&#x4EF6;&#x5316;&#x7684;&#x6982;&#x5FF5;">2. &#x7EC4;&#x4EF6;&#x5316;&#x7684;&#x6982;&#x5FF5; <a href="106.1.react.html#t12.%20%E7%BB%84%E4%BB%B6%E5%8C%96%E7%9A%84%E6%A6%82%E5%BF%B5"> # </a></h2>
<ul>
<li>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F88;&#x76F4;&#x89C2;&#x7684;&#x5C06;&#x4E00;&#x4E2A;&#x590D;&#x6742;&#x7684;&#x9875;&#x9762;&#x5206;&#x5272;&#x6210;&#x82E5;&#x5E72;&#x4E2A;&#x72EC;&#x7ACB;&#x7EC4;&#x4EF6;,&#x6BCF;&#x4E2A;&#x7EC4;&#x4EF6;&#x5305;&#x542B;&#x81EA;&#x5DF1;&#x7684;&#x903B;&#x8F91;&#x548C;&#x6837;&#x5F0F; &#x518D;&#x5C06;&#x8FD9;&#x4E9B;&#x72EC;&#x7ACB;&#x7EC4;&#x4EF6;&#x7EC4;&#x5408;&#x5B8C;&#x6210;&#x4E00;&#x4E2A;&#x590D;&#x6742;&#x7684;&#x9875;&#x9762;&#x3002; &#x8FD9;&#x6837;&#x65E2;&#x51CF;&#x5C11;&#x4E86;&#x903B;&#x8F91;&#x590D;&#x6742;&#x5EA6;&#xFF0C;&#x53C8;&#x5B9E;&#x73B0;&#x4E86;&#x4EE3;&#x7801;&#x7684;&#x91CD;&#x7528;<ul>
<li>&#x53EF;&#x7EC4;&#x5408;&#xFF1A;&#x4E00;&#x4E2A;&#x7EC4;&#x4EF6;&#x53EF;&#x4EE5;&#x548C;&#x5176;&#x4ED6;&#x7684;&#x7EC4;&#x4EF6;&#x4E00;&#x8D77;&#x4F7F;&#x7528;&#x6216;&#x8005;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5D4C;&#x5957;&#x5728;&#x53E6;&#x4E00;&#x4E2A;&#x7EC4;&#x4EF6;&#x5185;&#x90E8;</li>
<li>&#x53EF;&#x91CD;&#x7528;&#xFF1A;&#x6BCF;&#x4E2A;&#x7EC4;&#x4EF6;&#x90FD;&#x662F;&#x5177;&#x6709;&#x72EC;&#x7ACB;&#x529F;&#x80FD;&#x7684;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x88AB;&#x4F7F;&#x7528;&#x5728;&#x591A;&#x4E2A;&#x573A;&#x666F;&#x4E2D;</li>
<li>&#x53EF;&#x7EF4;&#x62A4;&#xFF1A;&#x6BCF;&#x4E2A;&#x5C0F;&#x7684;&#x7EC4;&#x4EF6;&#x4EC5;&#x4EC5;&#x5305;&#x542B;&#x81EA;&#x8EAB;&#x7684;&#x903B;&#x8F91;&#xFF0C;&#x66F4;&#x5BB9;&#x6613;&#x88AB;&#x7406;&#x89E3;&#x548C;&#x7EF4;&#x62A4;</li>
</ul>
</li>
</ul>
<h2 id="t23.&#x642D;&#x5EFA;React&#x5F00;&#x53D1;&#x73AF;&#x5883;">3.&#x642D;&#x5EFA;React&#x5F00;&#x53D1;&#x73AF;&#x5883; <a href="106.1.react.html#t23.%E6%90%AD%E5%BB%BAReact%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83"> # </a></h2>
<pre><code class="lang-js">cnpm i create-react-app -g
create-react-app zhufeng2020react
cd zhufeng2020react
npm start
</code></pre>
<h2 id="t34.JSX">4.JSX <a href="106.1.react.html#t34.JSX"> # </a></h2>
<h3 id="t44.1 &#x4EC0;&#x4E48;&#x662F;JSX">4.1 &#x4EC0;&#x4E48;&#x662F;JSX <a href="106.1.react.html#t44.1%20%E4%BB%80%E4%B9%88%E6%98%AFJSX"> # </a></h3>
<ul>
<li>&#x662F;&#x4E00;&#x79CD;JS&#x548C;HTML&#x6DF7;&#x5408;&#x7684;&#x8BED;&#x6CD5;,&#x5C06;&#x7EC4;&#x4EF6;&#x7684;&#x7ED3;&#x6784;&#x3001;&#x6570;&#x636E;&#x751A;&#x81F3;&#x6837;&#x5F0F;&#x90FD;&#x805A;&#x5408;&#x5728;&#x4E00;&#x8D77;&#x5B9A;&#x4E49;&#x7EC4;&#x4EF6;</li>
</ul>
<pre><code class="lang-js">ReactDOM.render(
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>,
  <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;root&apos;</span>)
);
</code></pre>
<h3 id="t54.2 &#x4EC0;&#x4E48;&#x662F;&#x5143;&#x7D20;">4.2 &#x4EC0;&#x4E48;&#x662F;&#x5143;&#x7D20; <a href="106.1.react.html#t54.2%20%E4%BB%80%E4%B9%88%E6%98%AF%E5%85%83%E7%B4%A0"> # </a></h3>
<ul>
<li>JSX&#x5176;&#x5B9E;&#x53EA;&#x662F;&#x4E00;&#x79CD;&#x8BED;&#x6CD5;&#x7CD6;,&#x6700;&#x7EC8;&#x4F1A;&#x901A;&#x8FC7;<a href="https://www.babeljs.cn/repl">babeljs</a>&#x8F6C;&#x8BD1;&#x6210;<code>createElement</code>&#x8BED;&#x6CD5;</li>
<li>React&#x5143;&#x7D20;&#x662F;&#x6784;&#x6210;<code>React</code>&#x5E94;&#x7528;&#x7684;&#x6700;&#x5C0F;&#x5355;&#x4F4D;</li>
<li>React&#x5143;&#x7D20;&#x7528;&#x6765;&#x63CF;&#x8FF0;&#x4F60;&#x5728;&#x5C4F;&#x5E55;&#x4E0A;&#x770B;&#x5230;&#x7684;&#x5185;&#x5BB9;</li>
<li>React&#x5143;&#x7D20;&#x4E8B;&#x5B9E;&#x4E0A;&#x662F;&#x666E;&#x901A;&#x7684;JS&#x5BF9;&#x8C61;,ReactDOM&#x6765;&#x786E;&#x4FDD;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x7684;DOM&#x6570;&#x636E;&#x548C;React&#x5143;&#x7D20;&#x4FDD;&#x6301;&#x4E00;&#x81F4;</li>
</ul>
<pre><code class="lang-js">&lt;h1 className=&quot;title&quot; style={{color:&apos;red&apos;}}&gt;hello&lt;/h1&gt;
</code></pre>
<pre><code class="lang-js">React.createElement(<span class="hljs-string">&quot;h1&quot;</span>, {
  <span class="hljs-attr">className</span>: <span class="hljs-string">&quot;title&quot;</span>,
  <span class="hljs-attr">style</span>: {
    <span class="hljs-attr">color</span>: <span class="hljs-string">&apos;red&apos;</span>
  }
}, <span class="hljs-string">&quot;hello&quot;</span>);
</code></pre>
<p>createElement&#x7684;&#x7ED3;&#x679C;</p>
<pre><code class="lang-js">{
  <span class="hljs-attr">type</span>:<span class="hljs-string">&apos;h1&apos;</span>,
  <span class="hljs-attr">props</span>:{
    <span class="hljs-attr">className</span>: <span class="hljs-string">&quot;title&quot;</span>,
    <span class="hljs-attr">style</span>: {
      <span class="hljs-attr">color</span>: <span class="hljs-string">&apos;red&apos;</span>
    }
  },
  <span class="hljs-attr">children</span>:<span class="hljs-string">&quot;hello&quot;</span>
}
</code></pre>
<h3 id="t64.3 JSX&#x8868;&#x8FBE;&#x5F0F;">4.3 JSX&#x8868;&#x8FBE;&#x5F0F; <a href="106.1.react.html#t64.3%20JSX%E8%A1%A8%E8%BE%BE%E5%BC%8F"> # </a></h3>
<ul>
<li>&#x53EF;&#x4EE5;&#x4EFB;&#x610F;&#x5730;&#x5728; JSX &#x5F53;&#x4E2D;&#x4F7F;&#x7528; JavaScript &#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x5728; JSX &#x5F53;&#x4E2D;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#x8981;&#x5305;&#x542B;&#x5728;&#x5927;&#x62EC;&#x53F7;&#x91CC;</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react-dom&apos;</span>;
<span class="hljs-keyword">let</span> title = <span class="hljs-string">&apos;hello&apos;</span>;
<span class="hljs-keyword">let</span> root = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;root&apos;</span>);
ReactDOM.render(
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>{title}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>,
    root
);
</code></pre>
<h3 id="t74.4 JSX&#x5C5E;&#x6027;">4.4 JSX&#x5C5E;&#x6027; <a href="106.1.react.html#t74.4%20JSX%E5%B1%9E%E6%80%A7"> # </a></h3>
<ul>
<li>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;JSX&#x5E76;&#x4E0D;&#x662F;<code>HTML</code>,&#x66F4;&#x50CF;<code>JavaScript</code></li>
<li>&#x5728;JSX&#x4E2D;&#x5C5E;&#x6027;&#x4E0D;&#x80FD;&#x5305;&#x542B;&#x5173;&#x952E;&#x5B57;&#xFF0C;&#x50CF;<code>class</code>&#x9700;&#x8981;&#x5199;&#x6210;<code>className</code>,<code>for</code>&#x9700;&#x8981;&#x5199;&#x6210;<code>htmlFor</code>,&#x5E76;&#x4E14;&#x5C5E;&#x6027;&#x540D;&#x9700;&#x8981;&#x91C7;&#x7528;&#x9A7C;&#x5CF0;&#x547D;&#x540D;&#x6CD5;</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react-dom&apos;</span>;
ReactDOM.render(
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;title&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">color:</span> &apos;<span class="hljs-attr">red</span>&apos; }}&gt;</span>Hello<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>,
    <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;root&apos;</span>)
);
</code></pre>
<h3 id="t84.5 JSX&#x4E5F;&#x662F;&#x5BF9;&#x8C61;">4.5 JSX&#x4E5F;&#x662F;&#x5BF9;&#x8C61; <a href="106.1.react.html#t84.5%20JSX%E4%B9%9F%E6%98%AF%E5%AF%B9%E8%B1%A1"> # </a></h3>
<ul>
<li>&#x53EF;&#x4EE5;&#x5728;<code>if</code>&#x6216;&#x8005; <code>for</code>&#x8BED;&#x53E5;&#x91CC;&#x4F7F;&#x7528;<code>JSX</code></li>
<li>&#x5C06;&#x5B83;&#x8D4B;&#x503C;&#x7ED9;&#x53D8;&#x91CF;&#xFF0C;&#x5F53;&#x4F5C;&#x53C2;&#x6570;&#x4F20;&#x5165;&#xFF0C;&#x4F5C;&#x4E3A;&#x8FD4;&#x56DE;&#x503C;&#x90FD;&#x53EF;&#x4EE5;</li>
</ul>
<p>if&#x4E2D;&#x4F7F;&#x7528;</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react-dom&apos;</span>;
<span class="hljs-keyword">let</span> root = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;root&apos;</span>);
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">greeting</span>(<span class="hljs-params">name</span>) </span>{
    <span class="hljs-keyword">if</span> (name) {
        <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello, {name}!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;
    }
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello, Stranger.<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;
}

<span class="hljs-keyword">const</span> element = greeting(<span class="hljs-string">&apos;zhufeng&apos;</span>);
ReactDOM.render(
    element,
    root
);
</code></pre>
<p>for&#x4E2D;&#x4F7F;&#x7528;</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react-dom&apos;</span>;
<span class="hljs-keyword">let</span> root = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;root&apos;</span>);
<span class="hljs-keyword">let</span> names = [<span class="hljs-string">&apos;&#x5F20;&#x4E09;&apos;</span>, <span class="hljs-string">&apos;&#x674E;&#x56DB;&apos;</span>, <span class="hljs-string">&apos;&#x738B;&#x4E94;&apos;</span>];
<span class="hljs-keyword">let</span> elements = [];
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; names.length; i++) {
    elements.push(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>{names[i]}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span>);
}
ReactDOM.render(
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
        {elements}
    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span>,
    root
);
</code></pre>
<h3 id="t94.6 &#x66F4;&#x65B0;&#x5143;&#x7D20;&#x6E32;&#x67D3;">4.6 &#x66F4;&#x65B0;&#x5143;&#x7D20;&#x6E32;&#x67D3; <a href="106.1.react.html#t94.6%20%E6%9B%B4%E6%96%B0%E5%85%83%E7%B4%A0%E6%B8%B2%E6%9F%93"> # </a></h3>
<ul>
<li>React &#x5143;&#x7D20;&#x90FD;&#x662F;<code>immutable</code>&#x4E0D;&#x53EF;&#x53D8;&#x7684;&#x3002;&#x5F53;&#x5143;&#x7D20;&#x88AB;&#x521B;&#x5EFA;&#x4E4B;&#x540E;&#xFF0C;&#x4F60;&#x662F;&#x65E0;&#x6CD5;&#x6539;&#x53D8;&#x5176;&#x5185;&#x5BB9;&#x6216;&#x5C5E;&#x6027;&#x7684;&#x3002;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x5C31;&#x597D;&#x50CF;&#x662F;&#x52A8;&#x753B;&#x91CC;&#x7684;&#x4E00;&#x5E27;&#xFF0C;&#x5B83;&#x4EE3;&#x8868;&#x5E94;&#x7528;&#x754C;&#x9762;&#x5728;&#x67D0;&#x4E00;&#x65F6;&#x95F4;&#x70B9;&#x7684;&#x6837;&#x5B50;</li>
<li>&#x66F4;&#x65B0;&#x754C;&#x9762;&#x7684;&#x552F;&#x4E00;&#x529E;&#x6CD5;&#x662F;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x5143;&#x7D20;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x5B83;&#x4F20;&#x5165;<code>ReactDOM.render()</code>&#x65B9;&#x6CD5;</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react-dom&apos;</span>;
<span class="hljs-keyword">let</span> root = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;root&apos;</span>);
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">tick</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">const</span> element = (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            {new Date().toLocaleTimeString()}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    );
    ReactDOM.render(element, root);
}
setInterval(tick, <span class="hljs-number">1000</span>);
</code></pre>
<h3 id="t104.7 React&#x53EA;&#x4F1A;&#x66F4;&#x65B0;&#x5FC5;&#x8981;&#x7684;&#x90E8;&#x5206;">4.7 React&#x53EA;&#x4F1A;&#x66F4;&#x65B0;&#x5FC5;&#x8981;&#x7684;&#x90E8;&#x5206; <a href="106.1.react.html#t104.7%20React%E5%8F%AA%E4%BC%9A%E6%9B%B4%E6%96%B0%E5%BF%85%E8%A6%81%E7%9A%84%E9%83%A8%E5%88%86"> # </a></h3>
<ul>
<li>React DOM &#x9996;&#x5148;&#x4F1A;&#x6BD4;&#x8F83;&#x5143;&#x7D20;&#x5185;&#x5BB9;&#x5148;&#x540E;&#x7684;&#x4E0D;&#x540C;&#xFF0C;&#x800C;&#x5728;&#x6E32;&#x67D3;&#x8FC7;&#x7A0B;&#x4E2D;&#x53EA;&#x4F1A;&#x66F4;&#x65B0;&#x6539;&#x53D8;&#x4E86;&#x7684;&#x90E8;&#x5206;&#x3002;</li>
<li>&#x5373;&#x4FBF;&#x6211;&#x4EEC;&#x6BCF;&#x79D2;&#x90FD;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x63CF;&#x8FF0;&#x6574;&#x4E2A;UI&#x6811;&#x7684;&#x65B0;&#x5143;&#x7D20;&#xFF0C;React DOM &#x4E5F;&#x53EA;&#x4F1A;&#x66F4;&#x65B0;&#x6E32;&#x67D3;&#x6587;&#x672C;&#x8282;&#x70B9;&#x4E2D;&#x53D1;&#x751F;&#x53D8;&#x5316;&#x7684;&#x5185;&#x5BB9;</li>
</ul>
<h2 id="t115. &#x7EC4;&#x4EF6; &amp; Props">5. &#x7EC4;&#x4EF6; &amp; Props <a href="106.1.react.html#t115.%20%E7%BB%84%E4%BB%B6%20&%20Props"> # </a></h2>
<ul>
<li>&#x53EF;&#x4EE5;&#x5C06;UI&#x5207;&#x5206;&#x6210;&#x4E00;&#x4E9B;&#x72EC;&#x7ACB;&#x7684;&#x3001;&#x53EF;&#x590D;&#x7528;&#x7684;&#x90E8;&#x4EF6;&#xFF0C;&#x8FD9;&#x6837;&#x4F60;&#x5C31;&#x53EA;&#x9700;&#x4E13;&#x6CE8;&#x4E8E;&#x6784;&#x5EFA;&#x6BCF;&#x4E00;&#x4E2A;&#x5355;&#x72EC;&#x7684;&#x90E8;&#x4EF6;</li>
<li>&#x7EC4;&#x4EF6;&#x4ECE;&#x6982;&#x5FF5;&#x4E0A;&#x7C7B;&#x4F3C;&#x4E8E; JavaScript &#x51FD;&#x6570;&#x3002;&#x5B83;&#x63A5;&#x53D7;&#x4EFB;&#x610F;&#x7684;&#x5165;&#x53C2;&#xFF08;&#x5373; &#x201C;props&#x201D;&#xFF09;&#xFF0C;&#x5E76;&#x8FD4;&#x56DE;&#x7528;&#x4E8E;&#x63CF;&#x8FF0;&#x9875;&#x9762;&#x5C55;&#x793A;&#x5185;&#x5BB9;&#x7684; React &#x5143;&#x7D20;</li>
</ul>
<h3 id="t125.1 &#x51FD;&#x6570;(&#x5B9A;&#x4E49;&#x7684;)&#x7EC4;&#x4EF6;">5.1 &#x51FD;&#x6570;(&#x5B9A;&#x4E49;&#x7684;)&#x7EC4;&#x4EF6; <a href="106.1.react.html#t125.1%20%E5%87%BD%E6%95%B0(%E5%AE%9A%E4%B9%89%E7%9A%84)%E7%BB%84%E4%BB%B6"> # </a></h3>
<ul>
<li>&#x51FD;&#x6570;&#x7EC4;&#x4EF6;&#x63A5;&#x6536;&#x4E00;&#x4E2A;&#x5355;&#x4E00;&#x7684;<code>props</code>&#x5BF9;&#x8C61;&#x5E76;&#x8FD4;&#x56DE;&#x4E86;&#x4E00;&#x4E2A;React&#x5143;&#x7D20;</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react-dom&apos;</span>;
<span class="hljs-keyword">let</span> root = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;root&apos;</span>);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Welcome</span>(<span class="hljs-params">props</span>)</span>{
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello, {props.name}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;
}

ReactDOM.render(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Welcome</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;zhufeng&quot;</span>/&gt;</span></span>, root);
</code></pre>
<h3 id="t135.2 &#x7C7B;(&#x5B9A;&#x4E49;&#x7684;)&#x7EC4;&#x4EF6;">5.2 &#x7C7B;(&#x5B9A;&#x4E49;&#x7684;)&#x7EC4;&#x4EF6; <a href="106.1.react.html#t135.2%20%E7%B1%BB(%E5%AE%9A%E4%B9%89%E7%9A%84)%E7%BB%84%E4%BB%B6"> # </a></h3>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react-dom&apos;</span>;
<span class="hljs-keyword">let</span> root = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;root&apos;</span>);

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Welcome</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
  render(){
      <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello, {this.props.name}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;
  }
}

ReactDOM.render(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Welcome</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;zhufeng&quot;</span>/&gt;</span></span>, root);
</code></pre>
<h3 id="t145.3 &#x7EC4;&#x4EF6;&#x6E32;&#x67D3;">5.3 &#x7EC4;&#x4EF6;&#x6E32;&#x67D3; <a href="106.1.react.html#t145.3%20%E7%BB%84%E4%BB%B6%E6%B8%B2%E6%9F%93"> # </a></h3>
<ul>
<li>React&#x5143;&#x7D20;&#x4E0D;&#x4F46;&#x53EF;&#x4EE5;&#x662F;DOM&#x6807;&#x7B7E;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x662F;&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x7EC4;&#x4EF6;</li>
<li>&#x5F53; React &#x5143;&#x7D20;&#x4E3A;&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x7EC4;&#x4EF6;&#x65F6;&#xFF0C;&#x5B83;&#x4F1A;&#x5C06; JSX &#x6240;&#x63A5;&#x6536;&#x7684;&#x5C5E;&#x6027;&#xFF08;attributes&#xFF09;&#x8F6C;&#x6362;&#x4E3A;&#x5355;&#x4E2A;&#x5BF9;&#x8C61;&#x4F20;&#x9012;&#x7ED9;&#x7EC4;&#x4EF6;&#xFF0C;&#x8FD9;&#x4E2A;&#x5BF9;&#x8C61;&#x88AB;&#x79F0;&#x4E4B;&#x4E3A; <code>props</code></li>
<li>&#x7EC4;&#x4EF6;&#x540D;&#x79F0;&#x5FC5;&#x987B;&#x4EE5;&#x5927;&#x5199;&#x5B57;&#x6BCD;&#x5F00;&#x5934;</li>
<li>&#x7EC4;&#x4EF6;&#x5FC5;&#x987B;&#x5728;&#x4F7F;&#x7528;&#x7684;&#x65F6;&#x5019;&#x5B9A;&#x4E49;&#x6216;&#x5F15;&#x7528;&#x5B83;</li>
<li>&#x7EC4;&#x4EF6;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x53EA;&#x80FD;&#x6709;&#x4E00;&#x4E2A;&#x6839;&#x5143;&#x7D20;</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react-dom&apos;</span>;
<span class="hljs-keyword">let</span> root = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;root&apos;</span>);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Welcome</span>(<span class="hljs-params">props</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello, {props.name}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Welcome2</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
    render() {
        <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello, {this.props.name}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;
    }
}

<span class="hljs-keyword">const</span> element1= <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Welcome</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;zhufeng&quot;</span> /&gt;</span></span>;
<span class="hljs-built_in">console</span>.log(element1.props.name);
<span class="hljs-keyword">const</span> element2= <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Welcome2</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;zhufeng&quot;</span> /&gt;</span></span>;
<span class="hljs-built_in">console</span>.log(element1.props.name);

ReactDOM.render(
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{element1}{element2}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>,
    root
);
</code></pre>
<h2 id="t156. &#x72B6;&#x6001;">6. &#x72B6;&#x6001; <a href="106.1.react.html#t156.%20%E7%8A%B6%E6%80%81"> # </a></h2>
<ul>
<li>&#x7EC4;&#x4EF6;&#x7684;&#x6570;&#x636E;&#x6765;&#x6E90;&#x6709;&#x4E24;&#x4E2A;&#x5730;&#x65B9;&#xFF0C;&#x5206;&#x522B;&#x662F;&#x5C5E;&#x6027;&#x5BF9;&#x8C61;&#x548C;&#x72B6;&#x6001;&#x5BF9;&#x8C61;</li>
<li>&#x5C5E;&#x6027;&#x662F;&#x7236;&#x7EC4;&#x4EF6;&#x4F20;&#x9012;&#x8FC7;&#x6765;&#x7684;(&#x9ED8;&#x8BA4;&#x5C5E;&#x6027;&#xFF0C;&#x5C5E;&#x6027;&#x6821;&#x9A8C;) </li>
<li>&#x72B6;&#x6001;&#x662F;&#x81EA;&#x5DF1;&#x5185;&#x90E8;&#x7684;,&#x6539;&#x53D8;&#x72B6;&#x6001;&#x552F;&#x4E00;&#x7684;&#x65B9;&#x5F0F;&#x5C31;&#x662F;<code>setState</code></li>
<li>&#x5C5E;&#x6027;&#x548C;&#x72B6;&#x6001;&#x7684;&#x53D8;&#x5316;&#x90FD;&#x4F1A;&#x5F71;&#x54CD;&#x89C6;&#x56FE;&#x66F4;&#x65B0;</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react-dom&apos;</span>;
interface Props {

}
interface State {
    <span class="hljs-attr">date</span>: any
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Clock</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span>&lt;<span class="hljs-title">Props</span>, <span class="hljs-title">State</span>&gt;</span>{
    timerID
    <span class="hljs-keyword">constructor</span>(props) {
        <span class="hljs-keyword">super</span>(props);
        <span class="hljs-keyword">this</span>.state = { <span class="hljs-attr">date</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>() };
    }

    componentDidMount() {
        <span class="hljs-keyword">this</span>.timerID = setInterval(
            <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-keyword">this</span>.tick(),
            <span class="hljs-number">1000</span>
        );
    }

    componentWillUnmount() {
        clearInterval(<span class="hljs-keyword">this</span>.timerID);
    }

    tick() {
        <span class="hljs-keyword">this</span>.setState({
            <span class="hljs-attr">date</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()
        });
    }

    render() {
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello, world!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>It is {this.state.date.toLocaleTimeString()}<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
        );
    }
}

ReactDOM.render(
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Clock</span> /&gt;</span></span>,
    <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;root&apos;</span>)
);
</code></pre>
<h3 id="t166.1 &#x4E0D;&#x8981;&#x76F4;&#x63A5;&#x4FEE;&#x6539; State">6.1 &#x4E0D;&#x8981;&#x76F4;&#x63A5;&#x4FEE;&#x6539; State <a href="106.1.react.html#t166.1%20%E4%B8%8D%E8%A6%81%E7%9B%B4%E6%8E%A5%E4%BF%AE%E6%94%B9%20State"> # </a></h3>
<ul>
<li>&#x6784;&#x9020;&#x51FD;&#x6570;&#x662F;&#x552F;&#x4E00;&#x53EF;&#x4EE5;&#x7ED9; <code>this.state</code> &#x8D4B;&#x503C;&#x7684;&#x5730;&#x65B9;</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react-dom&apos;</span>;
interface Props {
}
interface State {
    <span class="hljs-attr">number</span>: number
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Counter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span>&lt;<span class="hljs-title">Props</span>, <span class="hljs-title">State</span>&gt; </span>{
    timerID
    <span class="hljs-keyword">constructor</span>(props) {
        <span class="hljs-keyword">super</span>(props);
        <span class="hljs-keyword">this</span>.state = {
            <span class="hljs-attr">number</span>: <span class="hljs-number">0</span>
        };
    }

    componentDidMount() {
        <span class="hljs-keyword">this</span>.timerID = setInterval(
            <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
                <span class="hljs-keyword">this</span>.setState({ <span class="hljs-attr">number</span>: <span class="hljs-keyword">this</span>.state.number + <span class="hljs-number">1</span> });
                <span class="hljs-comment">//this.state.number = this.state.number + 1;</span>
            },
            <span class="hljs-number">1000</span>
        );
    }

    componentWillUnmount() {
        clearInterval(<span class="hljs-keyword">this</span>.timerID);
    }

    render() {
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> &gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span> {this.state.number} <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
        );
    }
}

ReactDOM.render(&lt;
    Counter /&gt;,
    <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;root&apos;</span>)
);
</code></pre>
<h3 id="t176.2 State &#x7684;&#x66F4;&#x65B0;&#x53EF;&#x80FD;&#x662F;&#x5F02;&#x6B65;&#x7684;">6.2 State &#x7684;&#x66F4;&#x65B0;&#x53EF;&#x80FD;&#x662F;&#x5F02;&#x6B65;&#x7684; <a href="106.1.react.html#t176.2%20State%20%E7%9A%84%E6%9B%B4%E6%96%B0%E5%8F%AF%E8%83%BD%E6%98%AF%E5%BC%82%E6%AD%A5%E7%9A%84"> # </a></h3>
<ul>
<li>&#x51FA;&#x4E8E;&#x6027;&#x80FD;&#x8003;&#x8651;&#xFF0C;React &#x53EF;&#x80FD;&#x4F1A;&#x628A;&#x591A;&#x4E2A; setState() &#x8C03;&#x7528;&#x5408;&#x5E76;&#x6210;&#x4E00;&#x4E2A;&#x8C03;&#x7528;</li>
<li>&#x56E0;&#x4E3A; this.props &#x548C; this.state &#x53EF;&#x80FD;&#x4F1A;&#x5F02;&#x6B65;&#x66F4;&#x65B0;&#xFF0C;&#x6240;&#x4EE5;&#x4F60;&#x4E0D;&#x8981;&#x4F9D;&#x8D56;&#x4ED6;&#x4EEC;&#x7684;&#x503C;&#x6765;&#x66F4;&#x65B0;&#x4E0B;&#x4E00;&#x4E2A;&#x72B6;&#x6001;</li>
<li>&#x53EF;&#x4EE5;&#x8BA9; setState() &#x63A5;&#x6536;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x800C;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x3002;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x7528;&#x4E0A;&#x4E00;&#x4E2A; state &#x4F5C;&#x4E3A;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react-dom&apos;</span>;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Counter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
    <span class="hljs-keyword">constructor</span>(props) {
        <span class="hljs-keyword">super</span>(props);
        <span class="hljs-keyword">this</span>.state = {
            <span class="hljs-attr">number</span>: <span class="hljs-number">0</span>
        };
    }
    handleClick = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        <span class="hljs-comment">//this.setState({number:this.state.number+1});</span>
        <span class="hljs-comment">//console.log(this.state.number);</span>
        <span class="hljs-comment">//this.setState({number:this.state.number+1});</span>

        <span class="hljs-keyword">this</span>.setState(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> (
            { <span class="hljs-attr">number</span>: state.number + <span class="hljs-number">1</span> }
        ));
        <span class="hljs-keyword">this</span>.setState(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> (
            { <span class="hljs-attr">number</span>: state.number + <span class="hljs-number">1</span> }
        ));
    }
    render() {
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> &gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span> {this.state.number} <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{this.handleClick}</span>&gt;</span>+<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
        );
    }
}

ReactDOM.render(&lt;
    Counter /&gt;,
    <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;root&apos;</span>)
);
</code></pre>
<h3 id="t186.3 State &#x7684;&#x66F4;&#x65B0;&#x4F1A;&#x88AB;&#x5408;&#x5E76;">6.3 State &#x7684;&#x66F4;&#x65B0;&#x4F1A;&#x88AB;&#x5408;&#x5E76; <a href="106.1.react.html#t186.3%20State%20%E7%9A%84%E6%9B%B4%E6%96%B0%E4%BC%9A%E8%A2%AB%E5%90%88%E5%B9%B6"> # </a></h3>
<ul>
<li>&#x5F53;&#x4F60;&#x8C03;&#x7528; setState() &#x7684;&#x65F6;&#x5019;&#xFF0C;React &#x4F1A;&#x628A;&#x4F60;&#x63D0;&#x4F9B;&#x7684;&#x5BF9;&#x8C61;&#x5408;&#x5E76;&#x5230;&#x5F53;&#x524D;&#x7684; state</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react-dom&apos;</span>;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Counter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
    <span class="hljs-keyword">constructor</span>(props) {
        <span class="hljs-keyword">super</span>(props);
        <span class="hljs-keyword">this</span>.state = {
            <span class="hljs-attr">name</span>: <span class="hljs-string">&apos;zhufeng&apos;</span>,
            <span class="hljs-attr">number</span>: <span class="hljs-number">0</span>
        };
    }
    handleClick = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        <span class="hljs-comment">//this.setState({number:this.state.number+1});</span>
        <span class="hljs-comment">//console.log(this.state.number);</span>
        <span class="hljs-comment">//this.setState({number:this.state.number+1});</span>

        <span class="hljs-keyword">this</span>.setState(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> (
            { <span class="hljs-attr">number</span>: state.number + <span class="hljs-number">1</span> }
        ));
        <span class="hljs-keyword">this</span>.setState(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> (
            { <span class="hljs-attr">number</span>: state.number + <span class="hljs-number">1</span> }
        ));
    }
    render() {
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> &gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{this.state.name}: {this.state.number} <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{this.handleClick}</span>&gt;</span>+<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
        );
    }
}

ReactDOM.render(&lt;
    Counter /&gt;,
    <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;root&apos;</span>)
);
</code></pre>
<h2 id="t197. &#x4E8B;&#x4EF6;&#x5904;&#x7406;">7. &#x4E8B;&#x4EF6;&#x5904;&#x7406; <a href="106.1.react.html#t197.%20%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86"> # </a></h2>
<ul>
<li>React &#x4E8B;&#x4EF6;&#x7684;&#x547D;&#x540D;&#x91C7;&#x7528;&#x5C0F;&#x9A7C;&#x5CF0;&#x5F0F;&#xFF08;camelCase&#xFF09;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x7EAF;&#x5C0F;&#x5199;&#x3002;</li>
<li>&#x4F7F;&#x7528; JSX &#x8BED;&#x6CD5;&#x65F6;&#x4F60;&#x9700;&#x8981;&#x4F20;&#x5165;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x4F5C;&#x4E3A;&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x51FD;&#x6570;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;</li>
<li>&#x4F60;&#x4E0D;&#x80FD;&#x901A;&#x8FC7;&#x8FD4;&#x56DE; <code>false</code> &#x7684;&#x65B9;&#x5F0F;&#x963B;&#x6B62;&#x9ED8;&#x8BA4;&#x884C;&#x4E3A;&#x3002;&#x4F60;&#x5FC5;&#x987B;&#x663E;&#x5F0F;&#x7684;&#x4F7F;&#x7528;<code>preventDefault</code></li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react-dom&apos;</span>;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Link</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
    handleClick(e) {
        e.preventDefault();
        alert(<span class="hljs-string">&apos;The link was clicked.&apos;</span>);
    }

    render() {
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;http://www.baidu.com&quot;</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{this.handleClick}</span>&gt;</span>
                Click me
          <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span>
        );
    }
}

ReactDOM.render(
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Link</span> /&gt;</span></span>,
    <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;root&apos;</span>)
);
</code></pre>
<h3 id="t207.2 this">7.2 this <a href="106.1.react.html#t207.2%20this"> # </a></h3>
<ul>
<li>&#x4F60;&#x5FC5;&#x987B;&#x8C28;&#x614E;&#x5BF9;&#x5F85; JSX &#x56DE;&#x8C03;&#x51FD;&#x6570;&#x4E2D;&#x7684; this,&#x53EF;&#x4EE5;&#x4F7F;&#x7528;:<ul>
<li>&#x516C;&#x5171;&#x5C5E;&#x6027;(&#x7BAD;&#x5934;&#x51FD;&#x6570;)</li>
<li>&#x533F;&#x540D;&#x51FD;&#x6570;</li>
<li>bind&#x8FDB;&#x884C;&#x7ED1;&#x5B9A;</li>
</ul>
</li>
</ul>
<pre><code class="lang-js"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoggingButton</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
    handleClick() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;this is:&apos;</span>, <span class="hljs-keyword">this</span>);
    }
    handleClick1 = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;this is:&apos;</span>, <span class="hljs-keyword">this</span>);
    }
    render() {
        <span class="hljs-comment">//onClick={this.handleClick.bind(this)</span>
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{(event)</span> =&gt;</span> this.handleClick(event)}&gt;
                Click me
        <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
        );
    }
}
</code></pre>
<h3 id="t217.3 &#x5411;&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x4F20;&#x9012;&#x53C2;&#x6570;">7.3 &#x5411;&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x4F20;&#x9012;&#x53C2;&#x6570; <a href="106.1.react.html#t217.3%20%E5%90%91%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E7%A8%8B%E5%BA%8F%E4%BC%A0%E9%80%92%E5%8F%82%E6%95%B0"> # </a></h3>
<ul>
<li>&#x533F;&#x540D;&#x51FD;&#x6570;</li>
<li>bind</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react-dom&apos;</span>;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoggingButton</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
    handleClick = <span class="hljs-function">(<span class="hljs-params">id, event</span>) =&gt;</span> {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;id:&apos;</span>, id);
    }
    render() {
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{(event)</span> =&gt;</span> this.handleClick(&apos;1&apos;, event)}&gt;
                    Click me
            <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{this.handleClick.bind(this,</span> &apos;<span class="hljs-attr">1</span>&apos;)}&gt;</span>
                    Click me
            <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;/&gt;</span></span>
        );
    }
}
ReactDOM.render(
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">LoggingButton</span> /&gt;</span></span>,
    <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;root&apos;</span>)
);
</code></pre>
<h3 id="t227.4 Ref">7.4 Ref <a href="106.1.react.html#t227.4%20Ref"> # </a></h3>
<ul>
<li>Refs &#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x79CD;&#x65B9;&#x5F0F;&#xFF0C;&#x5141;&#x8BB8;&#x6211;&#x4EEC;&#x8BBF;&#x95EE; DOM &#x8282;&#x70B9;&#x6216;&#x5728; render &#x65B9;&#x6CD5;&#x4E2D;&#x521B;&#x5EFA;&#x7684; React &#x5143;&#x7D20;</li>
<li>&#x5728; React &#x6E32;&#x67D3;&#x751F;&#x547D;&#x5468;&#x671F;&#x65F6;&#xFF0C;&#x8868;&#x5355;&#x5143;&#x7D20;&#x4E0A;&#x7684; value &#x5C06;&#x4F1A;&#x8986;&#x76D6; DOM &#x8282;&#x70B9;&#x4E2D;&#x7684;&#x503C;&#xFF0C;&#x5728;&#x975E;&#x53D7;&#x63A7;&#x7EC4;&#x4EF6;&#x4E2D;&#xFF0C;&#x4F60;&#x7ECF;&#x5E38;&#x5E0C;&#x671B; React &#x80FD;&#x8D4B;&#x4E88;&#x7EC4;&#x4EF6;&#x4E00;&#x4E2A;&#x521D;&#x59CB;&#x503C;&#xFF0C;&#x4F46;&#x662F;&#x4E0D;&#x53BB;&#x63A7;&#x5236;&#x540E;&#x7EED;&#x7684;&#x66F4;&#x65B0;&#x3002; &#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;, &#x4F60;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x4E00;&#x4E2A; defaultValue &#x5C5E;&#x6027;&#xFF0C;&#x800C;&#x4E0D;&#x662F; <code>value</code></li>
</ul>
<h4 id="t237.4.1 &#x4E3A; DOM &#x5143;&#x7D20;&#x6DFB;&#x52A0; ref">7.4.1 &#x4E3A; DOM &#x5143;&#x7D20;&#x6DFB;&#x52A0; ref <a href="106.1.react.html#t237.4.1%20%E4%B8%BA%20DOM%20%E5%85%83%E7%B4%A0%E6%B7%BB%E5%8A%A0%20ref"> # </a></h4>
<ul>
<li>&#x53EF;&#x4EE5;&#x4F7F;&#x7528; ref &#x53BB;&#x5B58;&#x50A8; DOM &#x8282;&#x70B9;&#x7684;&#x5F15;&#x7528;</li>
<li>&#x5F53; ref &#x5C5E;&#x6027;&#x7528;&#x4E8E; HTML &#x5143;&#x7D20;&#x65F6;&#xFF0C;&#x6784;&#x9020;&#x51FD;&#x6570;&#x4E2D;&#x4F7F;&#x7528; React.createRef() &#x521B;&#x5EFA;&#x7684; ref &#x63A5;&#x6536;&#x5E95;&#x5C42; DOM &#x5143;&#x7D20;&#x4F5C;&#x4E3A;&#x5176; current &#x5C5E;&#x6027;</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react-dom&apos;</span>;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Sum</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
    a
    b
    result
    <span class="hljs-keyword">constructor</span>(props) {
        <span class="hljs-keyword">super</span>(props);
        <span class="hljs-keyword">this</span>.a = React.createRef();
        <span class="hljs-keyword">this</span>.b = React.createRef();
        <span class="hljs-keyword">this</span>.result = React.createRef();
    }
    handleAdd = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        <span class="hljs-keyword">let</span> a = <span class="hljs-keyword">this</span>.a.current.value;
        <span class="hljs-keyword">let</span> b = <span class="hljs-keyword">this</span>.b.current.value;
        <span class="hljs-keyword">this</span>.result.current.value = a + b;
    }
    render() {
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{this.a}</span> /&gt;</span>+<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{this.b}</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{this.handleAdd}</span>&gt;</span>=<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{this.result}</span> /&gt;</span>
            <span class="hljs-tag">&lt;/&gt;</span></span>
        );
    }
}
ReactDOM.render(
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Sum</span> /&gt;</span></span>,
    <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;root&apos;</span>)
);
</code></pre>
<h4 id="t247.4.2 &#x4E3A; class &#x7EC4;&#x4EF6;&#x6DFB;&#x52A0; Ref">7.4.2 &#x4E3A; class &#x7EC4;&#x4EF6;&#x6DFB;&#x52A0; Ref <a href="106.1.react.html#t247.4.2%20%E4%B8%BA%20class%20%E7%BB%84%E4%BB%B6%E6%B7%BB%E5%8A%A0%20Ref"> # </a></h4>
<ul>
<li>&#x5F53; ref &#x5C5E;&#x6027;&#x7528;&#x4E8E;&#x81EA;&#x5B9A;&#x4E49; class &#x7EC4;&#x4EF6;&#x65F6;&#xFF0C;ref &#x5BF9;&#x8C61;&#x63A5;&#x6536;&#x7EC4;&#x4EF6;&#x7684;&#x6302;&#x8F7D;&#x5B9E;&#x4F8B;&#x4F5C;&#x4E3A;&#x5176; current &#x5C5E;&#x6027;</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react-dom&apos;</span>;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Form</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
    input
    <span class="hljs-keyword">constructor</span>(props) {
        <span class="hljs-keyword">super</span>(props);
        <span class="hljs-keyword">this</span>.input = React.createRef();
    }
    getFocus = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        <span class="hljs-keyword">this</span>.input.current.getFocus();
    }
    render() {
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">TextInput</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{this.input}</span> /&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{this.getFocus}</span>&gt;</span>&#x83B7;&#x5F97;&#x7126;&#x70B9;<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;/&gt;</span></span>
        );
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TextInput</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
    input
    <span class="hljs-keyword">constructor</span>(props) {
        <span class="hljs-keyword">super</span>(props);
        <span class="hljs-keyword">this</span>.input = React.createRef();
    }
    getFocus = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        <span class="hljs-keyword">this</span>.input.current.focus();
    }
    render() {
        <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{this.input}</span> /&gt;</span></span>
    }
}
ReactDOM.render(
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Form</span> /&gt;</span></span>,
    <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;root&apos;</span>)
);
</code></pre>
<h4 id="t257.4.3 Ref&#x8F6C;&#x53D1;">7.4.3 Ref&#x8F6C;&#x53D1; <a href="106.1.react.html#t257.4.3%20Ref%E8%BD%AC%E5%8F%91"> # </a></h4>
<ul>
<li>&#x4F60;&#x4E0D;&#x80FD;&#x5728;&#x51FD;&#x6570;&#x7EC4;&#x4EF6;&#x4E0A;&#x4F7F;&#x7528; ref &#x5C5E;&#x6027;&#xFF0C;&#x56E0;&#x4E3A;&#x4ED6;&#x4EEC;&#x6CA1;&#x6709;&#x5B9E;&#x4F8B;</li>
<li>Ref &#x8F6C;&#x53D1;&#x662F;&#x4E00;&#x9879;&#x5C06; ref &#x81EA;&#x52A8;&#x5730;&#x901A;&#x8FC7;&#x7EC4;&#x4EF6;&#x4F20;&#x9012;&#x5230;&#x5176;&#x4E00;&#x5B50;&#x7EC4;&#x4EF6;&#x7684;&#x6280;&#x5DE7;</li>
<li>Ref &#x8F6C;&#x53D1;&#x5141;&#x8BB8;&#x67D0;&#x4E9B;&#x7EC4;&#x4EF6;&#x63A5;&#x6536; ref&#xFF0C;&#x5E76;&#x5C06;&#x5176;&#x5411;&#x4E0B;&#x4F20;&#x9012;&#xFF08;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;&#x201C;&#x8F6C;&#x53D1;&#x201D;&#x5B83;&#xFF09;&#x7ED9;&#x5B50;&#x7EC4;&#x4EF6;<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react-dom&apos;</span>;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Form</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
  input
  <span class="hljs-keyword">constructor</span>(props) {
      <span class="hljs-keyword">super</span>(props);
      <span class="hljs-keyword">this</span>.input = React.createRef();
  }
  getFocus = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
      <span class="hljs-keyword">this</span>.input.current.getFocus();
  }
  render() {
      <span class="hljs-keyword">return</span> (
          <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">TextInput</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{this.input}</span> /&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{this.getFocus}</span>&gt;</span>&#x83B7;&#x5F97;&#x7126;&#x70B9;<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
          <span class="hljs-tag">&lt;/&gt;</span></span>
      );
  }
}
<span class="hljs-comment">//Function components cannot be given refs. Attempts to access this ref will fail. Did you mean to use React.forwardRef()?</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">TextInput</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> /&gt;</span></span>
}
ReactDOM.render(
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Form</span> /&gt;</span></span>,
  <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;root&apos;</span>)
);
</code></pre>
</li>
</ul>
<p>&#x4F7F;&#x7528;forwardRef</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react-dom&apos;</span>;
interface InputProps { }
<span class="hljs-keyword">const</span> TextInput = React.forwardRef(<span class="hljs-function">(<span class="hljs-params">props, ref</span>) =&gt;</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{ref}</span> /&gt;</span></span>
));
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Form</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
    input
    <span class="hljs-keyword">constructor</span>(props) {
        <span class="hljs-keyword">super</span>(props);
        <span class="hljs-keyword">this</span>.input = React.createRef();
    }
    getFocus = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>.input.current);

        <span class="hljs-keyword">this</span>.input.current.focus();
    }
    render() {
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">TextInput</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{this.input}</span> /&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{this.getFocus}</span>&gt;</span>&#x83B7;&#x5F97;&#x7126;&#x70B9;<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;/&gt;</span></span>
        );
    }
}

ReactDOM.render(
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Form</span> /&gt;</span></span>,
    <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;root&apos;</span>)
);
</code></pre>
<h2 id="t268.&#x751F;&#x547D;&#x5468;&#x671F;">8.&#x751F;&#x547D;&#x5468;&#x671F; <a href="106.1.react.html#t268.%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"> # </a></h2>
<h3 id="t278.1 &#x65E7;&#x7248;&#x751F;&#x547D;&#x5468;&#x671F;">8.1 &#x65E7;&#x7248;&#x751F;&#x547D;&#x5468;&#x671F; <a href="106.1.react.html#t278.1%20%E6%97%A7%E7%89%88%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"> # </a></h3>
<p><img src="http://img.zhufengpeixun.cn/react15.jpg" alt="react15"></p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React, { Component } <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react-dom&apos;</span>;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Counter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span></span>{ <span class="hljs-comment">// &#x4ED6;&#x4F1A;&#x6BD4;&#x8F83;&#x4E24;&#x4E2A;&#x72B6;&#x6001;&#x76F8;&#x7B49;&#x5C31;&#x4E0D;&#x4F1A;&#x5237;&#x65B0;&#x89C6;&#x56FE; PureComponent&#x662F;&#x6D45;&#x6BD4;&#x8F83;</span>
    <span class="hljs-keyword">static</span> defaultProps = {
        <span class="hljs-attr">name</span>: <span class="hljs-string">&apos;&#x73E0;&#x5CF0;&#x67B6;&#x6784;&apos;</span>
    };
    <span class="hljs-keyword">constructor</span>(props) {
        <span class="hljs-keyword">super</span>(props);
        <span class="hljs-keyword">this</span>.state = { <span class="hljs-attr">number</span>: <span class="hljs-number">0</span> }
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;1.constructor&#x6784;&#x9020;&#x51FD;&#x6570;&apos;</span>)
    }
    componentWillMount() { <span class="hljs-comment">// &#x53D6;&#x672C;&#x5730;&#x7684;&#x6570;&#x636E; &#x540C;&#x6B65;&#x7684;&#x65B9;&#x5F0F;&#xFF1A;&#x91C7;&#x7528;&#x6E32;&#x67D3;&#x4E4B;&#x524D;&#x83B7;&#x53D6;&#x6570;&#x636E;&#xFF0C;&#x53EA;&#x6E32;&#x67D3;&#x4E00;&#x6B21;</span>
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;2.&#x7EC4;&#x4EF6;&#x5C06;&#x8981;&#x52A0;&#x8F7D; componentWillMount&apos;</span>);
    }
    componentDidMount() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;4.&#x7EC4;&#x4EF6;&#x6302;&#x8F7D;&#x5B8C;&#x6210; componentDidMount&apos;</span>);
    }
    handleClick = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        <span class="hljs-keyword">this</span>.setState({ <span class="hljs-attr">number</span>: <span class="hljs-keyword">this</span>.state.number + <span class="hljs-number">1</span> });
    };
    <span class="hljs-comment">// react&#x53EF;&#x4EE5;shouldComponentUpdate&#x65B9;&#x6CD5;&#x4E2D;&#x4F18;&#x5316; PureComponent &#x53EF;&#x4EE5;&#x5E2E;&#x6211;&#x4EEC;&#x505A;&#x8FD9;&#x4EF6;&#x4E8B;</span>
    shouldComponentUpdate(nextProps, nextState) { <span class="hljs-comment">// &#x4EE3;&#x8868;&#x7684;&#x662F;&#x4E0B;&#x4E00;&#x6B21;&#x7684;&#x5C5E;&#x6027; &#x548C; &#x4E0B;&#x4E00;&#x6B21;&#x7684;&#x72B6;&#x6001;</span>
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;5.&#x7EC4;&#x4EF6;&#x662F;&#x5426;&#x66F4;&#x65B0; shouldComponentUpdate&apos;</span>);
        <span class="hljs-keyword">return</span> nextState.number % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>;
        <span class="hljs-comment">// return nextState.number!==this.state.number; //&#x5982;&#x679C;&#x6B64;&#x51FD;&#x6570;&#x79CD;&#x8FD4;&#x56DE;&#x4E86;false &#x5C31;&#x4E0D;&#x4F1A;&#x8C03;&#x7528;render&#x65B9;&#x6CD5;&#x4E86;</span>
    } <span class="hljs-comment">//&#x4E0D;&#x8981;&#x968F;&#x4FBF;&#x7528;setState &#x53EF;&#x80FD;&#x4F1A;&#x6B7B;&#x5FAA;&#x73AF;</span>
    componentWillUpdate() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;6.&#x7EC4;&#x4EF6;&#x5C06;&#x8981;&#x66F4;&#x65B0; componentWillUpdate&apos;</span>);
    }
    componentDidUpdate() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;7.&#x7EC4;&#x4EF6;&#x5B8C;&#x6210;&#x66F4;&#x65B0; componentDidUpdate&apos;</span>);
    }
    render() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;3.render&apos;</span>);
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{this.state.number}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                {this.state.number &gt; 3 ? null : <span class="hljs-tag">&lt;<span class="hljs-name">ChildCounter</span> <span class="hljs-attr">n</span>=<span class="hljs-string">{this.state.number}</span> /&gt;</span>}
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{this.handleClick}</span>&gt;</span>+<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
        )
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ChildCounter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>{
    componentWillUnmount() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;&#x7EC4;&#x4EF6;&#x5C06;&#x8981;&#x5378;&#x8F7D;componentWillUnmount&apos;</span>)
    }
    componentWillMount() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;child componentWillMount&apos;</span>)
    }
    render() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;child-render&apos;</span>)
        <span class="hljs-keyword">return</span> (<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            {this.props.n}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>)
    }
    componentDidMount() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;child componentDidMount&apos;</span>)
    }
    componentWillReceiveProps(newProps) { <span class="hljs-comment">// &#x7B2C;&#x4E00;&#x6B21;&#x4E0D;&#x4F1A;&#x6267;&#x884C;&#xFF0C;&#x4E4B;&#x540E;&#x5C5E;&#x6027;&#x66F4;&#x65B0;&#x65F6;&#x624D;&#x4F1A;&#x6267;&#x884C;</span>
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;child componentWillReceiveProps&apos;</span>)
    }
    shouldComponentUpdate(nextProps, nextState) {
        <span class="hljs-keyword">return</span> nextProps.n % <span class="hljs-number">3</span> == <span class="hljs-number">0</span>; <span class="hljs-comment">//&#x5B50;&#x7EC4;&#x4EF6;&#x5224;&#x65AD;&#x63A5;&#x6536;&#x7684;&#x5C5E;&#x6027; &#x662F;&#x5426;&#x6EE1;&#x8DB3;&#x66F4;&#x65B0;&#x6761;&#x4EF6; &#x4E3A;true&#x5219;&#x66F4;&#x65B0;</span>
    }
}
ReactDOM.render(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Counter</span> /&gt;</span></span>, <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;root&apos;</span>));
<span class="hljs-comment">// defaultProps</span>
<span class="hljs-comment">// constructor</span>
<span class="hljs-comment">// componentWillMount</span>
<span class="hljs-comment">// render</span>
<span class="hljs-comment">// componentDidMount</span>
<span class="hljs-comment">// &#x72B6;&#x6001;&#x66F4;&#x65B0;&#x4F1A;&#x89E6;&#x53D1;&#x7684;</span>
<span class="hljs-comment">// shouldComponentUpdate nextProps,nextState=&gt;boolean</span>
<span class="hljs-comment">// componentWillUpdate</span>
<span class="hljs-comment">// componentDidUpdate</span>
<span class="hljs-comment">// &#x5C5E;&#x6027;&#x66F4;&#x65B0;</span>
<span class="hljs-comment">// componentWillReceiveProps newProps</span>
<span class="hljs-comment">// &#x5378;&#x8F7D;</span>
<span class="hljs-comment">// componentWillUnmount</span>
</code></pre>
<h3 id="t288.2 &#x65B0;&#x7248;&#x751F;&#x547D;&#x5468;&#x671F;">8.2 &#x65B0;&#x7248;&#x751F;&#x547D;&#x5468;&#x671F; <a href="106.1.react.html#t288.2%20%E6%96%B0%E7%89%88%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"> # </a></h3>
<p><img src="http://img.zhufengpeixun.cn/react16.jpg" alt="react16"></p>
<h4 id="t298.2.1 getDerivedStateFromProps">8.2.1 getDerivedStateFromProps <a href="106.1.react.html#t298.2.1%20getDerivedStateFromProps"> # </a></h4>
<ul>
<li>static getDerivedStateFromProps(props, state) &#x8FD9;&#x4E2A;&#x751F;&#x547D;&#x5468;&#x671F;&#x7684;&#x529F;&#x80FD;&#x5B9E;&#x9645;&#x4E0A;&#x5C31;&#x662F;&#x5C06;&#x4F20;&#x5165;&#x7684;props&#x6620;&#x5C04;&#x5230;state&#x4E0A;&#x9762;</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react-dom&apos;</span>;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Counter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span></span>{
    <span class="hljs-keyword">static</span> defaultProps = {
        <span class="hljs-attr">name</span>: <span class="hljs-string">&apos;&#x73E0;&#x5CF0;&#x67B6;&#x6784;&apos;</span>
    };
    <span class="hljs-keyword">constructor</span>(props) {
        <span class="hljs-keyword">super</span>(props);
        <span class="hljs-keyword">this</span>.state = { <span class="hljs-attr">number</span>: <span class="hljs-number">0</span> }
    }

    handleClick = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        <span class="hljs-keyword">this</span>.setState({ <span class="hljs-attr">number</span>: <span class="hljs-keyword">this</span>.state.number + <span class="hljs-number">1</span> });
    };

    render() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;3.render&apos;</span>);
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{this.state.number}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">ChildCounter</span> <span class="hljs-attr">number</span>=<span class="hljs-string">{this.state.number}</span> /&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{this.handleClick}</span>&gt;</span>+<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
        )
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ChildCounter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
    <span class="hljs-keyword">constructor</span>(props) {
        <span class="hljs-keyword">super</span>(props);
        <span class="hljs-keyword">this</span>.state = { <span class="hljs-attr">number</span>: <span class="hljs-number">0</span> };
    }
    <span class="hljs-keyword">static</span> getDerivedStateFromProps(nextProps, prevState) {
        <span class="hljs-keyword">const</span> { number } = nextProps;
        <span class="hljs-comment">// &#x5F53;&#x4F20;&#x5165;&#x7684;type&#x53D1;&#x751F;&#x53D8;&#x5316;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x66F4;&#x65B0;state</span>
        <span class="hljs-keyword">if</span> (number % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">number</span>: number * <span class="hljs-number">2</span> };
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">number</span>: number * <span class="hljs-number">3</span> };
        }
    }
    render() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;child-render&apos;</span>, <span class="hljs-keyword">this</span>.state)
        <span class="hljs-keyword">return</span> (<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            {this.state.number}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>)
    }

}

ReactDOM.render(
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Counter</span> /&gt;</span></span>,
    <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;root&apos;</span>)
);
</code></pre>
<h4 id="t308.2.2 getSnapshotBeforeUpdate">8.2.2 getSnapshotBeforeUpdate <a href="106.1.react.html#t308.2.2%20getSnapshotBeforeUpdate"> # </a></h4>
<ul>
<li>getSnapshotBeforeUpdate() &#x88AB;&#x8C03;&#x7528;&#x4E8E;render&#x4E4B;&#x540E;&#xFF0C;&#x53EF;&#x4EE5;&#x8BFB;&#x53D6;&#x4F46;&#x65E0;&#x6CD5;&#x4F7F;&#x7528;DOM&#x7684;&#x65F6;&#x5019;&#x3002;&#x5B83;&#x4F7F;&#x60A8;&#x7684;&#x7EC4;&#x4EF6;&#x53EF;&#x4EE5;&#x5728;&#x53EF;&#x80FD;&#x66F4;&#x6539;&#x4E4B;&#x524D;&#x4ECE;DOM&#x6355;&#x83B7;&#x4E00;&#x4E9B;&#x4FE1;&#x606F;&#xFF08;&#x4F8B;&#x5982;&#x6EDA;&#x52A8;&#x4F4D;&#x7F6E;&#xFF09;&#x3002;&#x6B64;&#x751F;&#x547D;&#x5468;&#x671F;&#x8FD4;&#x56DE;&#x7684;&#x4EFB;&#x4F55;&#x503C;&#x90FD;&#x5C06;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x4F20;&#x9012;&#x7ED9;componentDidUpdate()</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./react&apos;</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./react-dom&apos;</span>;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ScrollingList</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
    <span class="hljs-keyword">constructor</span>(props) {
        <span class="hljs-keyword">super</span>(props);
        <span class="hljs-keyword">this</span>.state = { <span class="hljs-attr">messages</span>: [] }
        <span class="hljs-keyword">this</span>.wrapper = React.createRef();
    }

    addMessage() {
        <span class="hljs-keyword">this</span>.setState(<span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> ({
            <span class="hljs-attr">messages</span>: [<span class="hljs-string">`<span class="hljs-subst">${state.messages.length}</span>`</span>, ...state.messages],
        }))
    }
    componentDidMount() {
        <span class="hljs-keyword">this</span>.timeID = <span class="hljs-built_in">window</span>.setInterval(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {<span class="hljs-comment">//&#x8BBE;&#x7F6E;&#x5B9A;&#x65F6;&#x5668;</span>
            <span class="hljs-keyword">this</span>.addMessage();
        }, <span class="hljs-number">1000</span>)
    }
    componentWillUnmount() {<span class="hljs-comment">//&#x6E05;&#x9664;&#x5B9A;&#x65F6;&#x5668;</span>
        <span class="hljs-built_in">window</span>.clearInterval(<span class="hljs-keyword">this</span>.timeID);
    }
    getSnapshotBeforeUpdate() {<span class="hljs-comment">//&#x5F88;&#x5173;&#x952E;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x83B7;&#x53D6;&#x5F53;&#x524D;rootNode&#x7684;scrollHeight&#xFF0C;&#x4F20;&#x5230;componentDidUpdate &#x7684;&#x53C2;&#x6570;perScrollHeight</span>
        <span class="hljs-keyword">return</span> {<span class="hljs-attr">prevScrollTop</span>:<span class="hljs-keyword">this</span>.wrapper.current.scrollTop,<span class="hljs-attr">prevScrollHeight</span>:<span class="hljs-keyword">this</span>.wrapper.current.scrollHeight};
    }
    componentDidUpdate(pervProps, pervState, {prevScrollHeight,prevScrollTop}) {
        <span class="hljs-comment">//&#x5F53;&#x524D;&#x5411;&#x4E0A;&#x5377;&#x53BB;&#x7684;&#x9AD8;&#x5EA6;&#x52A0;&#x4E0A;&#x589E;&#x52A0;&#x7684;&#x5185;&#x5BB9;&#x9AD8;&#x5EA6;</span>
        <span class="hljs-keyword">this</span>.wrapper.current.scrollTop = prevScrollTop + (<span class="hljs-keyword">this</span>.wrapper.current.scrollHeight - prevScrollHeight);
    }
    render() {
        <span class="hljs-keyword">let</span> style = {
            <span class="hljs-attr">height</span>: <span class="hljs-string">&apos;100px&apos;</span>,
            <span class="hljs-attr">width</span>: <span class="hljs-string">&apos;200px&apos;</span>,
            <span class="hljs-attr">border</span>: <span class="hljs-string">&apos;1px solid red&apos;</span>,
            <span class="hljs-attr">overflow</span>: <span class="hljs-string">&apos;auto&apos;</span>
        }
        <span class="hljs-comment">//&lt;div key={index}&gt;&#x91CC;&#x4E0D;&#x8981;&#x52A0;&#x7A7A;&#x683C;!</span>
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{style}</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{this.wrapper}</span> &gt;</span>
                {this.state.messages.map((message, index) =&gt; (
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{index}</span>&gt;</span>{message}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                ))}
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
        );
    }
}

ReactDOM.render(
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ScrollingList</span> /&gt;</span></span>,
    <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;root&apos;</span>)
);
</code></pre>
<h2 id="t319.Context(&#x4E0A;&#x4E0B;&#x6587;)">9.Context(&#x4E0A;&#x4E0B;&#x6587;) <a href="106.1.react.html#t319.Context(%E4%B8%8A%E4%B8%8B%E6%96%87)"> # </a></h2>
<ul>
<li>&#x5728;&#x67D0;&#x4E9B;&#x573A;&#x666F;&#x4E0B;&#xFF0C;&#x4F60;&#x60F3;&#x5728;&#x6574;&#x4E2A;&#x7EC4;&#x4EF6;&#x6811;&#x4E2D;&#x4F20;&#x9012;&#x6570;&#x636E;&#xFF0C;&#x4F46;&#x5374;&#x4E0D;&#x60F3;&#x624B;&#x52A8;&#x5730;&#x5728;&#x6BCF;&#x4E00;&#x5C42;&#x4F20;&#x9012;&#x5C5E;&#x6027;&#x3002;&#x4F60;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5728; React &#x4E2D;&#x4F7F;&#x7528;&#x5F3A;&#x5927;&#x7684;<code>context</code>API&#x89E3;&#x51B3;&#x4E0A;&#x8FF0;&#x95EE;&#x9898;</li>
<li>&#x5728;&#x4E00;&#x4E2A;&#x5178;&#x578B;&#x7684; React &#x5E94;&#x7528;&#x4E2D;&#xFF0C;&#x6570;&#x636E;&#x662F;&#x901A;&#x8FC7; props &#x5C5E;&#x6027;&#x81EA;&#x4E0A;&#x800C;&#x4E0B;&#xFF08;&#x7531;&#x7236;&#x53CA;&#x5B50;&#xFF09;&#x8FDB;&#x884C;&#x4F20;&#x9012;&#x7684;&#xFF0C;&#x4F46;&#x8FD9;&#x79CD;&#x505A;&#x6CD5;&#x5BF9;&#x4E8E;&#x67D0;&#x4E9B;&#x7C7B;&#x578B;&#x7684;&#x5C5E;&#x6027;&#x800C;&#x8A00;&#x662F;&#x6781;&#x5176;&#x7E41;&#x7410;&#x7684;&#xFF08;&#x4F8B;&#x5982;&#xFF1A;&#x5730;&#x533A;&#x504F;&#x597D;&#xFF0C;UI &#x4E3B;&#x9898;&#xFF09;&#xFF0C;&#x8FD9;&#x4E9B;&#x5C5E;&#x6027;&#x662F;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#x8BB8;&#x591A;&#x7EC4;&#x4EF6;&#x90FD;&#x9700;&#x8981;&#x7684;&#x3002;Context &#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x79CD;&#x5728;&#x7EC4;&#x4EF6;&#x4E4B;&#x95F4;&#x5171;&#x4EAB;&#x6B64;&#x7C7B;&#x503C;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x800C;&#x4E0D;&#x5FC5;&#x663E;&#x5F0F;&#x5730;&#x901A;&#x8FC7;&#x7EC4;&#x4EF6;&#x6811;&#x7684;&#x9010;&#x5C42;&#x4F20;&#x9012; props</li>
</ul>
<p><img src="http://img.zhufengpeixun.cn/contextapi.gif" alt="contextapi"></p>
<h3 id="t329.1 &#x4F7F;&#x7528;">9.1 &#x4F7F;&#x7528; <a href="106.1.react.html#t329.1%20%E4%BD%BF%E7%94%A8"> # </a></h3>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React, { Component } <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./react&apos;</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./react-dom&apos;</span>;
<span class="hljs-keyword">let</span> ThemeContext = React.createContext(<span class="hljs-literal">null</span>);
<span class="hljs-keyword">let</span> root = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">&apos;#root&apos;</span>);
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Header</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>{
    render() {
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ThemeContext.Consumer</span>&gt;</span>
                {
                    (value) =&gt; (
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">border:</span> `<span class="hljs-attr">5px</span> <span class="hljs-attr">solid</span> ${<span class="hljs-attr">value.color</span>}`, <span class="hljs-attr">padding:</span> &apos;<span class="hljs-attr">5px</span>&apos; }}&gt;</span>
                            header
                          <span class="hljs-tag">&lt;<span class="hljs-name">Title</span> /&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    )
                }
            <span class="hljs-tag">&lt;/<span class="hljs-name">ThemeContext.Consumer</span>&gt;</span></span>
        )
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Title</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>{
    render() {
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ThemeContext.Consumer</span>&gt;</span>
                {
                    (value) =&gt; (
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">border:</span> `<span class="hljs-attr">5px</span> <span class="hljs-attr">solid</span> ${<span class="hljs-attr">value.color</span>}` }}&gt;</span>
                            title
                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    )
                }
            <span class="hljs-tag">&lt;/<span class="hljs-name">ThemeContext.Consumer</span>&gt;</span></span>
        )
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Main</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>{
    render() {
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ThemeContext.Consumer</span>&gt;</span>
                {
                    (value) =&gt; (
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">border:</span> `<span class="hljs-attr">5px</span> <span class="hljs-attr">solid</span> ${<span class="hljs-attr">value.color</span>}`, <span class="hljs-attr">margin:</span> &apos;<span class="hljs-attr">5px</span>&apos;, <span class="hljs-attr">padding:</span> &apos;<span class="hljs-attr">5px</span>&apos; }}&gt;</span>
                            main
                        <span class="hljs-tag">&lt;<span class="hljs-name">Content</span> /&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    )
                }
            <span class="hljs-tag">&lt;/<span class="hljs-name">ThemeContext.Consumer</span>&gt;</span></span>
        )
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Content</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>{
    render() {
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ThemeContext.Consumer</span>&gt;</span>
                {
                    (value) =&gt; (
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">border:</span> `<span class="hljs-attr">5px</span> <span class="hljs-attr">solid</span> ${<span class="hljs-attr">value.color</span>}`, <span class="hljs-attr">padding:</span> &apos;<span class="hljs-attr">5px</span>&apos; }}&gt;</span>
                            Content
                            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> value.changeColor(&apos;red&apos;)} style={{ color: &apos;red&apos; }}&gt;&#x7EA2;&#x8272;<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> value.changeColor(&apos;green&apos;)} style={{ color: &apos;green&apos; }}&gt;&#x7EFF;&#x8272;<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    )
                }
            <span class="hljs-tag">&lt;/<span class="hljs-name">ThemeContext.Consumer</span>&gt;</span></span>

        )
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Page</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span></span>{
    <span class="hljs-keyword">constructor</span>(props) {
        <span class="hljs-keyword">super</span>(props);
        <span class="hljs-keyword">this</span>.state = { <span class="hljs-attr">color</span>: <span class="hljs-string">&apos;red&apos;</span> };
    }
    changeColor = <span class="hljs-function">(<span class="hljs-params">color</span>) =&gt;</span> {
        <span class="hljs-keyword">this</span>.setState({ color });
    }
    render() {
        <span class="hljs-keyword">let</span> contextVal = { <span class="hljs-attr">changeColor</span>: <span class="hljs-keyword">this</span>.changeColor, <span class="hljs-attr">color</span>: <span class="hljs-keyword">this</span>.state.color };
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ThemeContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{contextVal}</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">margin:</span> &apos;<span class="hljs-attr">10px</span>&apos;, <span class="hljs-attr">border:</span> `<span class="hljs-attr">5px</span> <span class="hljs-attr">solid</span> ${<span class="hljs-attr">this.state.color</span>}`, <span class="hljs-attr">padding:</span> &apos;<span class="hljs-attr">5px</span>&apos;, <span class="hljs-attr">width:</span> <span class="hljs-attr">200</span> }}&gt;</span>
                    page
                    <span class="hljs-tag">&lt;<span class="hljs-name">Header</span> /&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">Main</span> /&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">ThemeContext.Provider</span>&gt;</span></span>

        )
    }
}
ReactDOM.render(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Page</span> /&gt;</span></span>, root);
</code></pre>
<h2 id="t3310. &#x9AD8;&#x9636;&#x7EC4;&#x4EF6;">10. &#x9AD8;&#x9636;&#x7EC4;&#x4EF6; <a href="106.1.react.html#t3310.%20%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6"> # </a></h2>
<ul>
<li>&#x9AD8;&#x9636;&#x7EC4;&#x4EF6;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x4F20;&#x7ED9;&#x5B83;&#x4E00;&#x4E2A;&#x7EC4;&#x4EF6;&#xFF0C;&#x5B83;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x7EC4;&#x4EF6;</li>
<li>&#x9AD8;&#x9636;&#x7EC4;&#x4EF6;&#x7684;&#x4F5C;&#x7528;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x4E3A;&#x4E86;&#x7EC4;&#x4EF6;&#x4E4B;&#x95F4;&#x7684;&#x4EE3;&#x7801;&#x590D;&#x7528;</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> NewComponent = higherOrderComponent(OldComponent)
</code></pre>
<h3 id="t3410.1 cra&#x652F;&#x6301;&#x88C5;&#x9970;&#x5668;">10.1 cra&#x652F;&#x6301;&#x88C5;&#x9970;&#x5668; <a href="106.1.react.html#t3410.1%20cra%E6%94%AF%E6%8C%81%E8%A3%85%E9%A5%B0%E5%99%A8"> # </a></h3>
<h4 id="t3510.1.1 &#x5B89;&#x88C5;">10.1.1 &#x5B89;&#x88C5; <a href="106.1.react.html#t3510.1.1%20%E5%AE%89%E8%A3%85"> # </a></h4>
<pre><code class="lang-js">cnpm i react-app-rewired customize-cra @babel/plugin-proposal-decorators -D
</code></pre>
<h4 id="t3610.1.2 &#x4FEE;&#x6539;package.json">10.1.2 &#x4FEE;&#x6539;package.json <a href="106.1.react.html#t3610.1.2%20%E4%BF%AE%E6%94%B9package.json"> # </a></h4>
<pre><code class="lang-json">  &quot;scripts&quot;: {
    &quot;start&quot;: &quot;react-app-rewired start&quot;,
    &quot;build&quot;: &quot;react-app-rewired build&quot;,
    &quot;test&quot;: &quot;react-app-rewired test&quot;,
    &quot;eject&quot;: &quot;react-app-rewired eject&quot;
  }
</code></pre>
<h4 id="t3710.1.3 config-overrides.js">10.1.3 config-overrides.js <a href="106.1.react.html#t3710.1.3%20config-overrides.js"> # </a></h4>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> {override,addBabelPlugin} = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;customize-cra&apos;</span>);

<span class="hljs-built_in">module</span>.exports = override(
  addBabelPlugin( [
    <span class="hljs-string">&quot;@babel/plugin-proposal-decorators&quot;</span>, { <span class="hljs-string">&quot;legacy&quot;</span>: <span class="hljs-literal">true</span> }
  ])
)
</code></pre>
<h4 id="t3810.1.4 jsconfig.json">10.1.4 jsconfig.json <a href="106.1.react.html#t3810.1.4%20jsconfig.json"> # </a></h4>
<pre><code class="lang-json">{
  <span class="hljs-attr">&quot;compilerOptions&quot;</span>: {
     <span class="hljs-attr">&quot;experimentalDecorators&quot;</span>: <span class="hljs-literal">true</span>
  }
}
</code></pre>
<h3 id="t3910.2 &#x5C5E;&#x6027;&#x4EE3;&#x7406;">10.2 &#x5C5E;&#x6027;&#x4EE3;&#x7406; <a href="106.1.react.html#t3910.2%20%E5%B1%9E%E6%80%A7%E4%BB%A3%E7%90%86"> # </a></h3>
<ul>
<li>&#x57FA;&#x4E8E;&#x5C5E;&#x6027;&#x4EE3;&#x7406;&#xFF1A;&#x64CD;&#x4F5C;&#x7EC4;&#x4EF6;&#x7684;props</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react-dom&apos;</span>;
<span class="hljs-keyword">const</span> loading = <span class="hljs-function"><span class="hljs-params">message</span> =&gt;</span><span class="hljs-function"><span class="hljs-params">OldComponent</span> =&gt;</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span></span>{
        render(){
            <span class="hljs-keyword">const</span> state = {
                <span class="hljs-attr">show</span>:<span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span>{
                    <span class="hljs-keyword">let</span> div = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">&apos;div&apos;</span>);
                    div.innerHTML = <span class="hljs-string">`&lt;p id=&quot;loading&quot; style=&quot;position:absolute;top:100px;z-index:10;background-color:black&quot;&gt;<span class="hljs-subst">${message}</span>&lt;/p&gt;`</span>;
                    <span class="hljs-built_in">document</span>.body.appendChild(div);
                },
                <span class="hljs-attr">hide</span>:<span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span>{
                    <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;loading&apos;</span>).remove();
                }
            }
            <span class="hljs-keyword">return</span>  (
                <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">OldComponent</span> {<span class="hljs-attr">...this.props</span>} {<span class="hljs-attr">...state</span>} {<span class="hljs-attr">...</span>{<span class="hljs-attr">...this.props</span>,<span class="hljs-attr">...state</span>}}/&gt;</span></span>
            )
        }
    }
}
@loading(<span class="hljs-string">&apos;&#x6B63;&#x5728;&#x52A0;&#x8F7D;&#x4E2D;&apos;</span>)
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Hello</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span></span>{
  render(){
     <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>hello<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{this.props.show}</span>&gt;</span>show<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{this.props.hide}</span>&gt;</span>hide<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
  }
}
<span class="hljs-keyword">let</span> LoadingHello  = loading(<span class="hljs-string">&apos;&#x6B63;&#x5728;&#x52A0;&#x8F7D;&apos;</span>)(Hello);

ReactDOM.render(
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">LoadingHello</span>/&gt;</span></span>, <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;root&apos;</span>));
</code></pre>
<h3 id="t4010.3 &#x53CD;&#x5411;&#x7EE7;&#x627F;">10.3 &#x53CD;&#x5411;&#x7EE7;&#x627F; <a href="106.1.react.html#t4010.3%20%E5%8F%8D%E5%90%91%E7%BB%A7%E6%89%BF"> # </a></h3>
<ul>
<li>&#x57FA;&#x4E8E;&#x53CD;&#x5411;&#x7EE7;&#x627F;&#xFF1A;&#x62E6;&#x622A;&#x751F;&#x547D;&#x5468;&#x671F;&#x3001;state&#x3001;&#x6E32;&#x67D3;&#x8FC7;&#x7A0B;</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react-dom&apos;</span>;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Button</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span></span>{
    state = {<span class="hljs-attr">name</span>:<span class="hljs-string">&apos;&#x5F20;&#x4E09;&apos;</span>}
    componentWillMount(){
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;Button componentWillMount&apos;</span>);
    }
    componentDidMount(){
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;Button componentDidMount&apos;</span>);
    }
    render(){
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;Button render&apos;</span>);
        <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">name</span>=<span class="hljs-string">{this.state.name}</span> <span class="hljs-attr">title</span>=<span class="hljs-string">{this.props.title}/</span>&gt;</span></span>
    }
}
<span class="hljs-keyword">const</span> wrapper = <span class="hljs-function"><span class="hljs-params">OldComponent</span> =&gt;</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NewComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">OldComponent</span></span>{
        state = {<span class="hljs-attr">number</span>:<span class="hljs-number">0</span>}
        componentWillMount(){
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;WrapperButton componentWillMount&apos;</span>);
             <span class="hljs-keyword">super</span>.componentWillMount();
        }
        componentDidMount(){
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;WrapperButton componentDidMount&apos;</span>);
             <span class="hljs-keyword">super</span>.componentDidMount();
        }
        handleClick = <span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span>{
            <span class="hljs-keyword">this</span>.setState({<span class="hljs-attr">number</span>:<span class="hljs-keyword">this</span>.state.number+<span class="hljs-number">1</span>});
        }
        render(){
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;WrapperButton render&apos;</span>);
            <span class="hljs-keyword">let</span> renderElement = <span class="hljs-keyword">super</span>.render();
            <span class="hljs-keyword">let</span> newProps = {
                ...renderElement.props,
                ...this.state,
                <span class="hljs-attr">onClick</span>:<span class="hljs-keyword">this</span>.handleClick
            }
            <span class="hljs-keyword">return</span>  React.cloneElement(
                renderElement,
                newProps,
                <span class="hljs-keyword">this</span>.state.number
            );
        }
    }
}
<span class="hljs-keyword">let</span> WrappedButton = wrapper(Button);
ReactDOM.render(
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">WrappedButton</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;&#x6807;&#x9898;&quot;</span>/&gt;</span></span>, <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;root&apos;</span>));
</code></pre>
<h3 id="t4110.3 @&#x4FEE;&#x9970;&#x7B26;">10.3 @&#x4FEE;&#x9970;&#x7B26; <a href="106.1.react.html#t4110.3%20@%E4%BF%AE%E9%A5%B0%E7%AC%A6"> # </a></h3>
<h2 id="t4211. render props">11. render props <a href="106.1.react.html#t4211.%20render%20props"> # </a></h2>
<ul>
<li><a href="https://zh-hans.reactjs.org/docs/render-props.html">render-props</a></li>
<li><code>render prop</code> &#x662F;&#x6307;&#x4E00;&#x79CD;&#x5728; React &#x7EC4;&#x4EF6;&#x4E4B;&#x95F4;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x503C;&#x4E3A;&#x51FD;&#x6570;&#x7684; prop &#x5171;&#x4EAB;&#x4EE3;&#x7801;&#x7684;&#x7B80;&#x5355;&#x6280;&#x672F;</li>
<li>&#x5177;&#x6709; render prop &#x7684;&#x7EC4;&#x4EF6;&#x63A5;&#x53D7;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x8BE5;&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A; React &#x5143;&#x7D20;&#x5E76;&#x8C03;&#x7528;&#x5B83;&#x800C;&#x4E0D;&#x662F;&#x5B9E;&#x73B0;&#x81EA;&#x5DF1;&#x7684;&#x6E32;&#x67D3;&#x903B;&#x8F91;</li>
<li>render prop &#x662F;&#x4E00;&#x4E2A;&#x7528;&#x4E8E;&#x544A;&#x77E5;&#x7EC4;&#x4EF6;&#x9700;&#x8981;&#x6E32;&#x67D3;&#x4EC0;&#x4E48;&#x5185;&#x5BB9;&#x7684;&#x51FD;&#x6570; prop</li>
<li>&#x8FD9;&#x4E5F;&#x662F;&#x903B;&#x8F91;&#x590D;&#x7528;&#x7684;&#x4E00;&#x79CD;&#x65B9;&#x5F0F;</li>
</ul>
<h3 id="t4311.1 &#x539F;&#x751F;&#x5B9E;&#x73B0;">11.1 &#x539F;&#x751F;&#x5B9E;&#x73B0; <a href="106.1.react.html#t4311.1%20%E5%8E%9F%E7%94%9F%E5%AE%9E%E7%8E%B0"> # </a></h3>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react-dom&apos;</span>;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MouseTracker</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
    <span class="hljs-keyword">constructor</span>(props) {
        <span class="hljs-keyword">super</span>(props);
        <span class="hljs-keyword">this</span>.state = { <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span> };
    }

    handleMouseMove = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
        <span class="hljs-keyword">this</span>.setState({
            <span class="hljs-attr">x</span>: event.clientX,
            <span class="hljs-attr">y</span>: event.clientY
        });
    }

    render() {
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">onMouseMove</span>=<span class="hljs-string">{this.handleMouseMove}</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#x79FB;&#x52A8;&#x9F20;&#x6807;!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>&#x5F53;&#x524D;&#x7684;&#x9F20;&#x6807;&#x4F4D;&#x7F6E;&#x662F; ({this.state.x}, {this.state.y})<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
        );
    }
}
ReactDOM.render(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">MouseTracker</span> /&gt;</span></span>, <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;root&apos;</span>));
</code></pre>
<h3 id="t4411.2  children">11.2  children <a href="106.1.react.html#t4411.2%20%20children"> # </a></h3>
<ul>
<li>children&#x662F;&#x4E00;&#x4E2A;&#x6E32;&#x67D3;&#x7684;&#x65B9;&#x6CD5;</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./react&apos;</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./react-dom&apos;</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MouseTracker</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
    <span class="hljs-keyword">constructor</span>(props) {
        <span class="hljs-keyword">super</span>(props);
        <span class="hljs-keyword">this</span>.state = { <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span> };
    }

    handleMouseMove = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
        <span class="hljs-keyword">this</span>.setState({
            <span class="hljs-attr">x</span>: event.clientX,
            <span class="hljs-attr">y</span>: event.clientY
        });
    }

    render() {
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">onMouseMove</span>=<span class="hljs-string">{this.handleMouseMove}</span>&gt;</span>
                {this.props.children(this.state)}
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
        );
    }
}
ReactDOM.render(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">MouseTracker</span> &gt;</span>
    {
        (props) =&gt; (
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#x79FB;&#x52A8;&#x9F20;&#x6807;!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>&#x5F53;&#x524D;&#x7684;&#x9F20;&#x6807;&#x4F4D;&#x7F6E;&#x662F; ({props.x}, {props.y})<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        )
    }
<span class="hljs-tag">&lt;/<span class="hljs-name">MouseTracker</span> &gt;</span>, document.getElementById(&apos;root&apos;));
</span></code></pre>
<h3 id="t4511.3 render&#x5C5E;&#x6027;">11.3 render&#x5C5E;&#x6027; <a href="106.1.react.html#t4511.3%20render%E5%B1%9E%E6%80%A7"> # </a></h3>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react-dom&apos;</span>;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MouseTracker</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
    <span class="hljs-keyword">constructor</span>(props) {
        <span class="hljs-keyword">super</span>(props);
        <span class="hljs-keyword">this</span>.state = { <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span> };
    }

    handleMouseMove = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
        <span class="hljs-keyword">this</span>.setState({
            <span class="hljs-attr">x</span>: event.clientX,
            <span class="hljs-attr">y</span>: event.clientY
        });
    }

    render() {
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">onMouseMove</span>=<span class="hljs-string">{this.handleMouseMove}</span>&gt;</span>
                {this.props.render(this.state)}
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
        );
    }
}

ReactDOM.render(&lt; MouseTracker render={params =&gt; (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#x79FB;&#x52A8;&#x9F20;&#x6807;!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>&#x5F53;&#x524D;&#x7684;&#x9F20;&#x6807;&#x4F4D;&#x7F6E;&#x662F; ({params.x}, {params.y})<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
)} /&gt;, <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;root&apos;</span>));
</code></pre>
<h3 id="t4611.4 HOC">11.4 HOC <a href="106.1.react.html#t4611.4%20HOC"> # </a></h3>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react-dom&apos;</span>;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">withTracker</span>(<span class="hljs-params">OldComponent</span>)</span>{
  <span class="hljs-keyword">return</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MouseTracker</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span></span>{
    <span class="hljs-keyword">constructor</span>(props){
        <span class="hljs-keyword">super</span>(props);
        <span class="hljs-keyword">this</span>.state = {<span class="hljs-attr">x</span>:<span class="hljs-number">0</span>,<span class="hljs-attr">y</span>:<span class="hljs-number">0</span>};
    }
    handleMouseMove = <span class="hljs-function">(<span class="hljs-params">event</span>)=&gt;</span>{
        <span class="hljs-keyword">this</span>.setState({
            <span class="hljs-attr">x</span>:event.clientX,
            <span class="hljs-attr">y</span>:event.clientY
        });
    }
    render(){
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">onMouseMove</span> = <span class="hljs-string">{this.handleMouseMove}</span>&gt;</span>
               <span class="hljs-tag">&lt;<span class="hljs-name">OldComponent</span> {<span class="hljs-attr">...this.state</span>}/&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
        )
    }
 }
}
<span class="hljs-comment">//render</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Show</span>(<span class="hljs-params">props</span>)</span>{
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">React.Fragment</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>&#x8BF7;&#x79FB;&#x52A8;&#x9F20;&#x6807;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>&#x5F53;&#x524D;&#x9F20;&#x6807;&#x7684;&#x4F4D;&#x7F6E;&#x662F;: x:{props.x} y:{props.y}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">React.Fragment</span>&gt;</span></span>
    )
}
<span class="hljs-keyword">let</span> HighShow = withTracker(Show);
ReactDOM.render(
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">HighShow</span>/&gt;</span></span>, <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;root&apos;</span>));
</code></pre>
<h2 id="t4712. shouldComponentUpdate">12. shouldComponentUpdate <a href="106.1.react.html#t4712.%20shouldComponentUpdate"> # </a></h2>
<ul>
<li>&#x5F53;&#x4E00;&#x4E2A;&#x7EC4;&#x4EF6;&#x7684;props&#x6216;state&#x53D8;&#x66F4;&#xFF0C;React&#x4F1A;&#x5C06;&#x6700;&#x65B0;&#x8FD4;&#x56DE;&#x7684;&#x5143;&#x7D20;&#x4E0E;&#x4E4B;&#x524D;&#x6E32;&#x67D3;&#x7684;&#x5143;&#x7D20;&#x8FDB;&#x884C;&#x5BF9;&#x6BD4;&#xFF0C;&#x4EE5;&#x6B64;&#x51B3;&#x5B9A;&#x662F;&#x5426;&#x6709;&#x5FC5;&#x8981;&#x66F4;&#x65B0;&#x771F;&#x5B9E;&#x7684; DOM&#xFF0C;&#x5F53;&#x5B83;&#x4EEC;&#x4E0D;&#x76F8;&#x540C;&#x65F6; React &#x4F1A;&#x66F4;&#x65B0;&#x8BE5; DOM</li>
<li>&#x5982;&#x679C;&#x6E32;&#x67D3;&#x7684;&#x7EC4;&#x4EF6;&#x975E;&#x5E38;&#x591A;&#x65F6;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8986;&#x76D6;&#x751F;&#x547D;&#x5468;&#x671F;&#x65B9;&#x6CD5; shouldComponentUpdate &#x6765;&#x8FDB;&#x884C;&#x4F18;&#x5316;</li>
<li>shouldComponentUpdate &#x65B9;&#x6CD5;&#x4F1A;&#x5728;&#x91CD;&#x65B0;&#x6E32;&#x67D3;&#x524D;&#x88AB;&#x89E6;&#x53D1;&#x3002;&#x5176;&#x9ED8;&#x8BA4;&#x5B9E;&#x73B0;&#x662F;&#x8FD4;&#x56DE; true,&#x5982;&#x679C;&#x7EC4;&#x4EF6;&#x4E0D;&#x9700;&#x8981;&#x66F4;&#x65B0;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;shouldComponentUpdate&#x4E2D;&#x8FD4;&#x56DE; false &#x6765;&#x8DF3;&#x8FC7;&#x6574;&#x4E2A;&#x6E32;&#x67D3;&#x8FC7;&#x7A0B;&#x3002;&#x5176;&#x5305;&#x62EC;&#x8BE5;&#x7EC4;&#x4EF6;&#x7684; render &#x8C03;&#x7528;&#x4EE5;&#x53CA;&#x4E4B;&#x540E;&#x7684;&#x64CD;&#x4F5C;</li>
</ul>
<h3 id="t4812.1 PureComponent">12.1 PureComponent <a href="106.1.react.html#t4812.1%20PureComponent"> # </a></h3>
<pre><code class="lang-js"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PureComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>{
  shouldComponentUpdate(newProps,nextState) {
    <span class="hljs-keyword">return</span> !shallowEqual(<span class="hljs-keyword">this</span>.props, newProps)||!shallowEqual(<span class="hljs-keyword">this</span>.state, nextState);
  }
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">shallowEqual</span>(<span class="hljs-params">obj1, obj2</span>) </span>{
  <span class="hljs-keyword">if</span> (obj1 === obj2) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> obj1 != <span class="hljs-string">&quot;object&quot;</span> ||obj1 === <span class="hljs-literal">null</span> ||<span class="hljs-keyword">typeof</span> obj2 != <span class="hljs-string">&quot;object&quot;</span> ||obj2 === <span class="hljs-literal">null</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }
  <span class="hljs-keyword">let</span> keys1 = <span class="hljs-built_in">Object</span>.keys(obj1);
  <span class="hljs-keyword">let</span> keys2 = <span class="hljs-built_in">Object</span>.keys(obj2);
  <span class="hljs-keyword">if</span> (keys1.length != keys2.length) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> key <span class="hljs-keyword">of</span> keys1) {
    <span class="hljs-keyword">if</span> (!obj2.hasOwnProperty(key) || obj1[key] !== obj2[key]) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
  }
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}
</code></pre>
<h3 id="t4912.2 memo">12.2 memo <a href="106.1.react.html#t4912.2%20memo"> # </a></h3>
<pre><code class="lang-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">memo</span>(<span class="hljs-params">OldComponent</span>)</span>{
  <span class="hljs-keyword">return</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">PureComponent</span></span>{
    render(){
      <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">OldComponent</span> {<span class="hljs-attr">...this.props</span>}/&gt;</span></span>
    }
  }
}
</code></pre>
<h2 id="t5013. memo">13. memo <a href="106.1.react.html#t5013.%20memo"> # </a></h2>
<h3 id="t5113.1 src\utils.js">13.1 src\utils.js <a href="106.1.react.html#t5113.1%20src/utils.js"> # </a></h3>
<p>src\utils.js</p>
<pre><code class="lang-diff"><span class="hljs-addition">+export function shallowEqual(obj1, obj2) {</span>
<span class="hljs-addition">+   if (obj1 === obj2) {</span>
<span class="hljs-addition">+     return true;</span>
<span class="hljs-addition">+   }</span>
<span class="hljs-addition">+   if (typeof obj1 != &quot;object&quot; ||obj1 === null ||typeof obj2 != &quot;object&quot; ||obj2 === null) {</span>
<span class="hljs-addition">+     return false;</span>
<span class="hljs-addition">+   }</span>
<span class="hljs-addition">+   let keys1 = Object.keys(obj1);</span>
<span class="hljs-addition">+   let keys2 = Object.keys(obj2);</span>
<span class="hljs-addition">+   if (keys1.length !== keys2.length) {</span>
<span class="hljs-addition">+     return false;</span>
<span class="hljs-addition">+   }</span>
<span class="hljs-addition">+   for (let key of keys1) {</span>
<span class="hljs-addition">+     if (!obj2.hasOwnProperty(key) || obj1[key] !== obj2[key]) {</span>
<span class="hljs-addition">+       return false;</span>
<span class="hljs-addition">+     }</span>
<span class="hljs-addition">+   }</span>
<span class="hljs-addition">+   return true;</span>
<span class="hljs-addition">+ }</span>
</code></pre>
<h3 id="t5213.2 src\Component.js">13.2 src\Component.js <a href="106.1.react.html#t5213.2%20src/Component.js"> # </a></h3>
<p>src\Component.js</p>
<pre><code class="lang-diff"><span class="hljs-addition">+import {shallowEqual} from &apos;./utils&apos;;</span>
<span class="hljs-addition">+export class PureComponent extends Component {</span>
<span class="hljs-addition">+  shouldComponentUpdate(newProps,nextState) {</span>
<span class="hljs-addition">+    return !shallowEqual(this.props, newProps)||!shallowEqual(this.state, nextState);</span>
<span class="hljs-addition">+  }</span>
<span class="hljs-addition">+}</span>
</code></pre>
<h3 id="t5313.3 src\constants.js">13.3 src\constants.js <a href="106.1.react.html#t5313.3%20src/constants.js"> # </a></h3>
<p>src\constants.js</p>
<pre><code class="lang-diff"><span class="hljs-addition">+export const REACT_MEMO =  Symbol(&apos;react.memo&apos;)</span>
</code></pre>
<h3 id="t5413.4 src\react.js">13.4 src\react.js <a href="106.1.react.html#t5413.4%20src/react.js"> # </a></h3>
<p>src\react.js</p>
<pre><code class="lang-diff"><span class="hljs-addition">+import {shallowEqual} from &apos;./utils&apos;;</span>
<span class="hljs-addition">+function memo(type,compare=shallowEqual){</span>
<span class="hljs-addition">+  return {</span>
<span class="hljs-addition">+    $$typeof:REACT_MEMO,</span>
<span class="hljs-addition">+    type,</span>
<span class="hljs-addition">+    compare</span>
<span class="hljs-addition">+  }</span>
<span class="hljs-addition">+}</span>
const React = {
<span class="hljs-addition">+   memo</span>
}
</code></pre>
<h3 id="t5513.5 src\react-dom.js">13.5 src\react-dom.js <a href="106.1.react.html#t5513.5%20src/react-dom.js"> # </a></h3>
<p>src\react-dom.js</p>
<pre><code class="lang-diff"><span class="hljs-addition">+import { REACT_TEXT, REACT_FORWARD_REF_TYPE,REACT_MEMO } from &apos;./constants&apos;;</span>

function createDOM(vdom) {
    let { type, props, ref } = vdom;
    let dom;
<span class="hljs-addition">+    if (type &amp;&amp; type.$$typeof === REACT_MEMO) {</span>
<span class="hljs-addition">+        return mountMemoComponent(vdom);</span>
    }else if (type &amp;&amp; type.type <span class="hljs-comment">=== REACT_FORWARD_REF_TYPE) {</span>
        return mountForwardComponent(vdom);
    } else if (type <span class="hljs-comment">=== REACT_TEXT) {</span>
        dom = document.createTextNode(props.content);
    } else if (typeof type <span class="hljs-comment">=== &apos;function&apos;) {</span>
        if (type.isReactComponent) {
            return mountClassComponent(vdom);
        } else {
            return mountFunctionComponent(vdom);
        }
    } else {
        dom = document.createElement(type);
    }
    if (props) {
        updateProps(dom, {}, props);
        if (typeof props.children == &apos;object&apos; &amp;&amp; props.children.type) {
            render(props.children, dom);
        } else if (Array.isArray(props.children)) {
            reconcileChildren(props.children, dom);
        }
    }
    vdom.dom = dom;
    if (ref) ref.current = dom;
    return dom;
}

<span class="hljs-addition">+function mountMemoComponent(vdom) {</span>
<span class="hljs-addition">+    let { type, props } = vdom;</span>
<span class="hljs-addition">+    let renderVdom = type.type(props);</span>
<span class="hljs-addition">+    vdom.prevProps = props;</span>
<span class="hljs-addition">+    vdom.oldRenderVdom = renderVdom;</span>
<span class="hljs-addition">+    return createDOM(renderVdom);</span>
<span class="hljs-addition">+}</span>
<span class="hljs-addition">+</span>
<span class="hljs-addition">+export function findDOM(vdom) {</span>
<span class="hljs-addition">+    let { type } = vdom;</span>
<span class="hljs-addition">+    let dom;</span>
<span class="hljs-addition">+    if (typeof type === &apos;string&apos; || type===REACT_TEXT) {</span>
<span class="hljs-addition">+        dom = vdom.dom;</span>
<span class="hljs-addition">+    } else {</span>
<span class="hljs-addition">+        dom = findDOM(vdom.oldRenderVdom);</span>
<span class="hljs-addition">+    }</span>
<span class="hljs-addition">+    return dom;</span>
<span class="hljs-addition">+}</span>

function updateElement(oldVdom, newVdom) {
<span class="hljs-addition">+    if(oldVdom.type&amp;&amp;oldVdom.type.$$typeof === REACT_MEMO){</span>
<span class="hljs-addition">+        updateMemoComponent(oldVdom, newVdom);</span>
    }else if (oldVdom.type <span class="hljs-comment">=== REACT_TEXT &amp;&amp; newVdom.type === REACT_TEXT) {</span>
        let currentDOM = newVdom.dom = findDOM(oldVdom);
        if (oldVdom.props.content !== newVdom.props.content) {
            currentDOM.textContent = newVdom.props.content;
        }
        return;
    }else if (typeof oldVdom.type <span class="hljs-comment">=== &apos;string&apos;) {</span>
        let currentDOM = newVdom.dom = findDOM(oldVdom);
        updateProps(currentDOM, oldVdom.props, newVdom.props);
        updateChildren(currentDOM, oldVdom.props.children, newVdom.props.children);
    } else if (typeof oldVdom.type <span class="hljs-comment">=== &apos;function&apos;) {</span>
        if (oldVdom.type.isReactComponent) {
            newVdom.classInstance = oldVdom.classInstance;
            updateClassInstance(oldVdom, newVdom);
        } else {
            updateFunctionComponent(oldVdom, newVdom);
        }
    }
}

<span class="hljs-addition">+function updateMemoComponent(oldVdom, newVdom){</span>
<span class="hljs-addition">+    let {type,prevProps}=oldVdom;</span>
<span class="hljs-addition">+    if(!type.compare(prevProps,newVdom.props)){</span>
<span class="hljs-addition">+        let oldDOM = findDOM(oldVdom);</span>
<span class="hljs-addition">+        let parentDOM = oldDOM.parentNode;</span>
<span class="hljs-addition">+        let { type, props } = newVdom;</span>
<span class="hljs-addition">+        let renderVdom = type.type(props);</span>
<span class="hljs-addition">+        compareTwoVdom(parentDOM, oldVdom.oldRenderVdom, renderVdom);</span>
<span class="hljs-addition">+        newVdom.prevProps = props;</span>
<span class="hljs-addition">+        newVdom.oldRenderVdom = renderVdom;</span>
<span class="hljs-addition">+    }else{</span>
<span class="hljs-addition">+        newVdom.oldRenderVdom = oldVdom.oldRenderVdom;</span>
<span class="hljs-addition">+    }</span>
<span class="hljs-addition">+}</span>
</code></pre>
<h2 id="t561.&#x521B;&#x5EFA;&#x9879;&#x76EE;">1.&#x521B;&#x5EFA;&#x9879;&#x76EE; <a href="106.1.react.html#t561.%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE"> # </a></h2>
<h3 id="t571.1 &#x4FEE;&#x6539;&#x547D;&#x4EE4;">1.1 &#x4FEE;&#x6539;&#x547D;&#x4EE4; <a href="106.1.react.html#t571.1%20%E4%BF%AE%E6%94%B9%E5%91%BD%E4%BB%A4"> # </a></h3>
<pre><code class="lang-diff">  &quot;scripts&quot;: {
<span class="hljs-addition">+    &quot;start&quot;: &quot;set DISABLE_NEW_JSX_TRANSFORM=true&amp;&amp;react-scripts start&quot;,</span>
<span class="hljs-addition">+    &quot;build&quot;: &quot;set DISABLE_NEW_JSX_TRANSFORM=true&amp;&amp;react-scripts build&quot;,</span>
<span class="hljs-addition">+    &quot;test&quot;: &quot;set DISABLE_NEW_JSX_TRANSFORM=true&amp;&amp;react-scripts test&quot;,</span>
<span class="hljs-addition">+    &quot;eject&quot;: &quot;set DISABLE_NEW_JSX_TRANSFORM=true&amp;&amp;react-scripts eject&quot;</span>
  },
</code></pre>
<h3 id="t581.2 src\index.js">1.2 src\index.js <a href="106.1.react.html#t581.2%20src/index.js"> # </a></h3>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react-dom&apos;</span>;
<span class="hljs-keyword">let</span> element1 = <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;title&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">color:</span> &apos;<span class="hljs-attr">red</span>&apos; }}&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>hello<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>world<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
<span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">JSON</span>.stringify(element1,<span class="hljs-literal">null</span>,<span class="hljs-number">2</span>));
ReactDOM.render(element1, <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;root&apos;</span>));
</code></pre>
<pre><code class="lang-json">{
    <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;div&quot;</span>,
    <span class="hljs-attr">&quot;props&quot;</span>: {
        <span class="hljs-attr">&quot;className&quot;</span>: <span class="hljs-string">&quot;title&quot;</span>,
        <span class="hljs-attr">&quot;style&quot;</span>: {
            <span class="hljs-attr">&quot;color&quot;</span>: <span class="hljs-string">&quot;red&quot;</span>
        },
        <span class="hljs-attr">&quot;children&quot;</span>: [
            {
                <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;span&quot;</span>,
                <span class="hljs-attr">&quot;props&quot;</span>: {
                    <span class="hljs-attr">&quot;children&quot;</span>: <span class="hljs-string">&quot;hello&quot;</span>
                }
            },
            <span class="hljs-string">&quot;world&quot;</span>
        ]
    }
}
</code></pre>
<h3 id="t591.3 public\index.html">1.3 public\index.html <a href="106.1.react.html#t591.3%20public/index.html"> # </a></h3>
<pre><code class="lang-html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;theme-color&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;#000000&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span>
      <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;description&quot;</span>
      <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;Web site created using create-react-app&quot;</span>
    /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>React App<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
      <span class="hljs-selector-class">.title</span>{
        <span class="hljs-attribute">background-color</span>: green;
      }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h2 id="t602.&#x5B9E;&#x73B0;&#x5143;&#x7D20;&#x7684;&#x6E32;&#x67D3;">2.&#x5B9E;&#x73B0;&#x5143;&#x7D20;&#x7684;&#x6E32;&#x67D3; <a href="106.1.react.html#t602.%E5%AE%9E%E7%8E%B0%E5%85%83%E7%B4%A0%E7%9A%84%E6%B8%B2%E6%9F%93"> # </a></h2>
<p><img src="https://img.zhufengpeixun.com/1609002145166" alt="1609002145166"></p>
<h3 id="t612.1 src\index.js">2.1 src\index.js <a href="106.1.react.html#t612.1%20src/index.js"> # </a></h3>
<pre><code class="lang-diff"><span class="hljs-addition">+import React from &apos;./react&apos;;</span>
<span class="hljs-addition">+import ReactDOM from &apos;./react-dom&apos;;</span>
let element1 = &lt;div className=&quot;title&quot; style={{ color: &apos;red&apos; }}&gt;&lt;span&gt;hello&lt;/span&gt;world&lt;/div&gt;;
console.log(JSON.stringify(element1,null,2));
ReactDOM.render(element1, document.getElementById(&apos;root&apos;));
</code></pre>
<h3 id="t622.2 src\constants.js">2.2 src\constants.js <a href="106.1.react.html#t622.2%20src/constants.js"> # </a></h3>
<p>src\constants.js</p>
<pre><code class="lang-js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> REACT_TEXT = <span class="hljs-built_in">Symbol</span>(<span class="hljs-string">&apos;REACT_TEXT&apos;</span>);
</code></pre>
<h3 id="t632.3 src\utils.js">2.3 src\utils.js <a href="106.1.react.html#t632.3%20src/utils.js"> # </a></h3>
<p>src\utils.js</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> {REACT_TEXT} <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./constants&apos;</span>;
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">wrapToVdom</span>(<span class="hljs-params">element</span>)</span>{
    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">typeof</span> element === <span class="hljs-string">&apos;string&apos;</span>||<span class="hljs-keyword">typeof</span> element === <span class="hljs-string">&apos;number&apos;</span>)
    ?{<span class="hljs-attr">type</span>:REACT_TEXT,<span class="hljs-attr">props</span>:{<span class="hljs-attr">content</span>:element}}:element;
}
</code></pre>
<h3 id="t642.4 src\react.js">2.4 src\react.js <a href="106.1.react.html#t642.4%20src/react.js"> # </a></h3>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> {wrapToVdom} <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./utils&apos;</span>;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createElement</span>(<span class="hljs-params">type,config,children</span>)</span>{
    <span class="hljs-keyword">let</span> ref;
    <span class="hljs-keyword">let</span> key;
    <span class="hljs-keyword">if</span>(config){
        <span class="hljs-keyword">delete</span> config.__source;
        <span class="hljs-keyword">delete</span> config.__self;
        ref = config.ref;
        <span class="hljs-keyword">delete</span> config.ref;
        key = config.key;
        <span class="hljs-keyword">delete</span> config.key;
    }
   <span class="hljs-keyword">let</span> props = {...config};
   <span class="hljs-keyword">if</span>(<span class="hljs-built_in">arguments</span>.length&gt;<span class="hljs-number">3</span>){
       props.children=<span class="hljs-built_in">Array</span>.prototype.slice.call(<span class="hljs-built_in">arguments</span>,<span class="hljs-number">2</span>).map(wrapToVdom);
   }<span class="hljs-keyword">else</span>{
        props.children=wrapToVdom(children);
   }
   <span class="hljs-keyword">return</span> {
       type,
       ref,
       key,
       props
   }
}
<span class="hljs-keyword">const</span> React = {
    createElement
};
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> React;
</code></pre>
<h3 id="t652.5 react-dom.js">2.5 react-dom.js <a href="106.1.react.html#t652.5%20react-dom.js"> # </a></h3>
<p>src\react-dom.js</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> {REACT_TEXT} <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./constants&apos;</span>;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span>(<span class="hljs-params">vdom,container</span>)</span>{
    mount(vdom,container);
}
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">mount</span>(<span class="hljs-params">vdom,container</span>)</span>{
    <span class="hljs-keyword">let</span> newDOM = createDOM(vdom);
    container.appendChild(newDOM)
}
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createDOM</span>(<span class="hljs-params">vdom</span>)</span>{
    <span class="hljs-keyword">let</span> {type,props} = vdom;
    <span class="hljs-keyword">let</span> dom;
    <span class="hljs-keyword">if</span>(type === REACT_TEXT){
        dom = <span class="hljs-built_in">document</span>.createTextNode(props.content);
    }<span class="hljs-keyword">else</span>{
        dom = <span class="hljs-built_in">document</span>.createElement(type);
    }
    <span class="hljs-keyword">if</span>(props){
        updateProps(dom,{},props);
        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> props.children==<span class="hljs-string">&apos;object&apos;</span> &amp;&amp; props.children.type){
            mount(props.children,dom);
        }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-built_in">Array</span>.isArray(props.children)){<span class="hljs-comment">//&#x662F;&#x6570;&#x7EC4;&#x7684;&#x8BDD;</span>
            reconcileChildren(props.children,dom);
        }
    }
    vdom.dom=dom;
    <span class="hljs-keyword">return</span> dom;
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateProps</span>(<span class="hljs-params">dom,oldProps,newProps</span>)</span>{
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> newProps){
        <span class="hljs-keyword">if</span>(key === <span class="hljs-string">&apos;children&apos;</span>){<span class="hljs-keyword">continue</span>;}
        <span class="hljs-keyword">if</span>(key === <span class="hljs-string">&apos;style&apos;</span>){
            <span class="hljs-keyword">let</span> style = newProps[key];
            <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> attr <span class="hljs-keyword">in</span> style){
                dom.style[attr] = style[attr]
            }
        }<span class="hljs-keyword">else</span>{
            dom[key]=newProps[key];
        }
    }
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">reconcileChildren</span>(<span class="hljs-params">childrenVdom,parentDOM</span>)</span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; childrenVdom.length; i++) {
        <span class="hljs-keyword">let</span> childVdom = childrenVdom[i];
        mount(childVdom,parentDOM);
    }
}
<span class="hljs-keyword">const</span> ReactDOM =  {
    render
};
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> ReactDOM;
</code></pre>
<h2 id="t663.&#x51FD;&#x6570;&#x7EC4;&#x4EF6;&#x6E32;&#x67D3;">3.&#x51FD;&#x6570;&#x7EC4;&#x4EF6;&#x6E32;&#x67D3; <a href="106.1.react.html#t663.%E5%87%BD%E6%95%B0%E7%BB%84%E4%BB%B6%E6%B8%B2%E6%9F%93"> # </a></h2>
<p><img src="https://img.zhufengpeixun.com/1609002319803" alt="1609002319803"></p>
<h3 id="t673.1 src\index.js">3.1 src\index.js <a href="106.1.react.html#t673.1%20src/index.js"> # </a></h3>
<pre><code class="lang-diff">import React from &apos;./react&apos;;
import ReactDOM from &apos;./react-dom&apos;;
<span class="hljs-addition">+function FunctionComponent(props){</span>
<span class="hljs-addition">+  return &lt;div className=&quot;title&quot; style={{ color: &apos;red&apos; }}&gt;&lt;span&gt;{props.name}&lt;/span&gt;{props.children}&lt;/div&gt;;</span>
<span class="hljs-addition">+}</span>
<span class="hljs-addition">+let element = &lt;FunctionComponent name=&quot;hello&quot;&gt;world&lt;/FunctionComponent&gt;;</span>
ReactDOM.render(element, document.getElementById(&apos;root&apos;));
</code></pre>
<h3 id="t683.2 react-dom.js">3.2 react-dom.js <a href="106.1.react.html#t683.2%20react-dom.js"> # </a></h3>
<p>src\react-dom.js</p>
<pre><code class="lang-diff">import {REACT_TEXT} from &apos;./constants&apos;;
function render(vdom,container){
    mount(vdom,container);
}
export function mount(vdom,container){
    let newDOM = createDOM(vdom);
    container.appendChild(newDOM)
}
export function createDOM(vdom){
    let {type,props} = vdom;
    let dom;
    if(type <span class="hljs-comment">=== REACT_TEXT){</span>
        dom = document.createTextNode(props.content);
<span class="hljs-addition">+   }else if(typeof type === &apos;function&apos;){//&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x51FD;&#x6570;&#x7EC4;&#x4EF6;</span>
<span class="hljs-addition">+       return mountFunctionComponent(vdom);</span>
<span class="hljs-addition">+   }else{</span>
        dom = document.createElement(type);
    }
    if(props){
        updateProps(dom,{},props);
        if(typeof props.children==&apos;object&apos; &amp;&amp; props.children.type){
            mount(props.children,dom);
        }else if(Array.isArray(props.children)){//&#x662F;&#x6570;&#x7EC4;&#x7684;&#x8BDD;
            reconcileChildren(props.children,dom);
        }
    }
    vdom.dom=dom;
    return dom;
}
<span class="hljs-addition">+function mountFunctionComponent(vdom){</span>
<span class="hljs-addition">+    let {type,props}= vdom;</span>
<span class="hljs-addition">+    let renderVdom = type(props);</span>
<span class="hljs-addition">+    return createDOM(renderVdom);</span>
<span class="hljs-addition">+}</span>
function updateProps(dom,oldProps,newProps){
    for(let key in newProps){
        if(key <span class="hljs-comment">=== &apos;children&apos;){continue;}</span>
        if(key <span class="hljs-comment">=== &apos;style&apos;){</span>
            let style = newProps[key];
            for(let attr in style){
                dom.style[attr] = style[attr]
            }
        }else{
            dom[key]=newProps[key];
        }
    }
}
function reconcileChildren(childrenVdom,parentDOM){
    for (let i = 0; i &lt; childrenVdom.length; i++) {
        let childVdom = childrenVdom[i];
        mount(childVdom,parentDOM);
    }
}
const ReactDOM =  {
    render
};
export default ReactDOM;
</code></pre>
<h2 id="t694.&#x7C7B;&#x7EC4;&#x4EF6;&#x6E32;&#x67D3;">4.&#x7C7B;&#x7EC4;&#x4EF6;&#x6E32;&#x67D3; <a href="106.1.react.html#t694.%E7%B1%BB%E7%BB%84%E4%BB%B6%E6%B8%B2%E6%9F%93"> # </a></h2>
<p><img src="https://img.zhufengpeixun.com/1609002426742" alt="1609002426742"></p>
<h3 id="t704.1 src\index.js">4.1 src\index.js <a href="106.1.react.html#t704.1%20src/index.js"> # </a></h3>
<p>src\index.js</p>
<pre><code class="lang-diff">import React from &apos;./react&apos;;
import ReactDOM from &apos;./react-dom&apos;;
<span class="hljs-addition">+class ClassComponent extends React.Component{</span>
<span class="hljs-addition">+    render(){</span>
<span class="hljs-addition">+        return &lt;div className=&quot;title&quot; style={{ color: &apos;red&apos; }}&gt;&lt;span&gt;{this.props.name}&lt;/span&gt;{this.props.children}&lt;/div&gt;;</span>
<span class="hljs-addition">+    }</span>
<span class="hljs-addition">+}</span>
<span class="hljs-addition">+let element = &lt;ClassComponent name=&quot;hello&quot;&gt;world&lt;/ClassComponent&gt;;</span>
ReactDOM.render(element, document.getElementById(&apos;root&apos;));
</code></pre>
<h3 id="t714.2 src\Component.js">4.2 src\Component.js <a href="106.1.react.html#t714.2%20src/Component.js"> # </a></h3>
<p>src\Component.js</p>
<pre><code class="lang-js"><span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Component</span></span>{
    <span class="hljs-keyword">static</span> isReactComponent=<span class="hljs-literal">true</span>
    <span class="hljs-keyword">constructor</span>(props){
        <span class="hljs-keyword">this</span>.props = props;
    }
}
</code></pre>
<h3 id="t724.3 src\react.js">4.3 src\react.js <a href="106.1.react.html#t724.3%20src/react.js"> # </a></h3>
<p>src\react.js</p>
<pre><code class="lang-diff">import {wrapToVdom} from &apos;./utils&apos;;
<span class="hljs-addition">+import {Component} from &apos;./Component&apos;;</span>
function createElement(type,config,children){
    let ref;
    let key;
    if(config){
        delete config.__source;
        delete config.__self;
        ref = config.ref;
        delete config.ref;
        key = config.key;
        delete config.key;
    }
   let props = {...config};
   if(arguments.length&gt;3){
       props.children=Array.prototype.slice.call(arguments,2).map(wrapToVdom);
   }else{
        props.children=wrapToVdom(children);
   }
   return {
       type,
       ref,
       key,
       props
   }
}
const React = {
    createElement,
<span class="hljs-addition">+   Component</span>
};
export default React;

</code></pre>
<h3 id="t734.4 src\react-dom.js">4.4 src\react-dom.js <a href="106.1.react.html#t734.4%20src/react-dom.js"> # </a></h3>
<p>src\react-dom.js</p>
<pre><code class="lang-diff">import {REACT_TEXT} from &apos;./constants&apos;;
function render(vdom,container){
    mount(vdom,container);
}
export function mount(vdom,container){
    let newDOM = createDOM(vdom);
    container.appendChild(newDOM)
}
export function createDOM(vdom){
    let {type,props} = vdom;
    let dom;
    if(type <span class="hljs-comment">=== REACT_TEXT){</span>
        dom = document.createTextNode(props.content);
    }else if(typeof type <span class="hljs-comment">=== &apos;function&apos;){//&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x51FD;&#x6570;&#x7EC4;&#x4EF6;</span>
<span class="hljs-addition">+       if(type.isReactComponent){//&#x8BF4;&#x660E;&#x8FD9;&#x4E2A;type&#x662F;&#x4E00;&#x4E2A;&#x7C7B;&#x7EC4;&#x4EF6;&#x7684;&#x865A;&#x62DF;DOM&#x5143;&#x7D20;</span>
<span class="hljs-addition">+                return mountClassComponent(vdom);</span>
        } else{
                return mountFunctionComponent(vdom);
        }
    }else{
        dom = document.createElement(type);
    }
    if(props){
        updateProps(dom,{},props);
        if(typeof props.children==&apos;object&apos; &amp;&amp; props.children.type){
            mount(props.children,dom);
        }else if(Array.isArray(props.children)){//&#x662F;&#x6570;&#x7EC4;&#x7684;&#x8BDD;
            reconcileChildren(props.children,dom);
        }
    }
    vdom.dom=dom;
    return dom;
}
<span class="hljs-addition">+function mountClassComponent(vdom){</span>
<span class="hljs-addition">+    let {type,props}= vdom;</span>
<span class="hljs-addition">+    let classInstance = new type(props);</span>
<span class="hljs-addition">+    let renderVdom = classInstance.render();</span>
<span class="hljs-addition">+    let dom =  createDOM(renderVdom);</span>
<span class="hljs-addition">+    return dom;</span>
<span class="hljs-addition">+}</span>
function mountFunctionComponent(vdom){
    let {type,props}= vdom;
    let renderVdom = type(props);
    return createDOM(renderVdom);
}
function updateProps(dom,oldProps,newProps){
    for(let key in newProps){
        if(key <span class="hljs-comment">=== &apos;children&apos;){continue;}</span>
        if(key <span class="hljs-comment">=== &apos;style&apos;){</span>
            let style = newProps[key];
            for(let attr in style){
                dom.style[attr] = style[attr]
            }
        }else{
            dom[key]=newProps[key];
        }
    }
}
function reconcileChildren(childrenVdom,parentDOM){
    for (let i = 0; i &lt; childrenVdom.length; i++) {
        let childVdom = childrenVdom[i];
        mount(childVdom,parentDOM);
    }
}
const ReactDOM =  {
    render
};
export default ReactDOM;
</code></pre>
<h2 id="t745.&#x7C7B;&#x7EC4;&#x4EF6;&#x66F4;&#x65B0;">5.&#x7C7B;&#x7EC4;&#x4EF6;&#x66F4;&#x65B0; <a href="106.1.react.html#t745.%E7%B1%BB%E7%BB%84%E4%BB%B6%E6%9B%B4%E6%96%B0"> # </a></h2>
<p><img src="http://img.zhufengpeixun.cn/setState2.jpg" alt="setState2"></p>
<h3 id="t755.1 src\index.js">5.1 src\index.js <a href="106.1.react.html#t755.1%20src/index.js"> # </a></h3>
<pre><code class="lang-diff">import React from &apos;./react&apos;;
import ReactDOM from &apos;./react-dom&apos;;
<span class="hljs-addition">+class Counter extends React.Component {</span>
<span class="hljs-addition">+    constructor(props) {</span>
<span class="hljs-addition">+        super(props);</span>
<span class="hljs-addition">+        this.state = { number: 0 };</span>
<span class="hljs-addition">+    }</span>
<span class="hljs-addition">+    handleClick = () =&gt; {</span>
<span class="hljs-addition">+        this.setState({ number: this.state.number + 1 });</span>
<span class="hljs-addition">+        console.log(this.state);</span>
<span class="hljs-addition">+</span>
<span class="hljs-addition">+    }</span>
<span class="hljs-addition">+    render() {</span>
<span class="hljs-addition">+        return (</span>
<span class="hljs-addition">+            &lt;div&gt;</span>
<span class="hljs-addition">+                &lt;p&gt;number:{this.state.number}&lt;/p&gt;</span>
<span class="hljs-addition">+                &lt;button onClick={this.handleClick}&gt;+&lt;/button&gt;</span>
<span class="hljs-addition">+            &lt;/div&gt;</span>
<span class="hljs-addition">+        )</span>
<span class="hljs-addition">+    }</span>
<span class="hljs-addition">+}</span>
<span class="hljs-addition">+ReactDOM.render(&lt;Counter title=&quot;&#x8BA1;&#x6570;&#x5668;&quot; /&gt;, document.getElementById(&apos;root&apos;));</span>
</code></pre>
<h3 id="t765.2 src\Component.js">5.2 src\Component.js <a href="106.1.react.html#t765.2%20src/Component.js"> # </a></h3>
<p>src\Component.js</p>
<pre><code class="lang-diff"><span class="hljs-addition">+import {findDOM,compareTwoVdom} from &apos;./react-dom&apos;;</span>
<span class="hljs-addition">+class Updater{</span>
<span class="hljs-addition">+    constructor(classInstance){</span>
<span class="hljs-addition">+        this.classInstance = classInstance;</span>
<span class="hljs-addition">+        this.pendingStates = [];</span>
<span class="hljs-addition">+        this.callbacks = [];</span>
<span class="hljs-addition">+    }</span>
<span class="hljs-addition">+    addState(partialState,callback){</span>
<span class="hljs-addition">+        this.pendingStates.push(partialState);///&#x7B49;&#x5F85;&#x66F4;&#x65B0;&#x7684;&#x6216;&#x8005;&#x8BF4;&#x7B49;&#x5F85;&#x751F;&#x6548;&#x7684;&#x72B6;&#x6001;</span>
<span class="hljs-addition">+        if(typeof callback ===&apos;function&apos;)</span>
<span class="hljs-addition">+            this.callbacks.push(callback);//&#x72B6;&#x6001;&#x66F4;&#x65B0;&#x540E;&#x7684;&#x56DE;&#x8C03;</span>
<span class="hljs-addition">+        this.emitUpdate();    </span>
<span class="hljs-addition">+    }</span>
<span class="hljs-addition">+    emitUpdate(){</span>
<span class="hljs-addition">+        this.updateComponent();</span>
<span class="hljs-addition">+    }</span>
<span class="hljs-addition">+    updateComponent(){</span>
<span class="hljs-addition">+        let {classInstance,pendingStates} = this;</span>
<span class="hljs-addition">+        if(pendingStates.length&gt;0){</span>
<span class="hljs-addition">+           shouldUpdate(classInstance,this.getState());</span>
<span class="hljs-addition">+        }</span>
<span class="hljs-addition">+    }</span>
<span class="hljs-addition">+    getState(){</span>
<span class="hljs-addition">+        let {classInstance,pendingStates} = this;</span>
<span class="hljs-addition">+        let {state}=classInstance;</span>
<span class="hljs-addition">+        pendingStates.forEach((nextState)=&gt;{</span>
<span class="hljs-addition">+            if(typeof nextState === &apos;function&apos;){</span>
<span class="hljs-addition">+                nextState=nextState(state);</span>
<span class="hljs-addition">+            }</span>
<span class="hljs-addition">+            state={...state,...nextState};</span>
<span class="hljs-addition">+        });</span>
<span class="hljs-addition">+        pendingStates.length=0;</span>
<span class="hljs-addition">+        return state;</span>
<span class="hljs-addition">+    }</span>
<span class="hljs-addition">+}</span>
<span class="hljs-addition">+function shouldUpdate(classInstance,nextState){</span>
<span class="hljs-addition">+    classInstance.state = nextState;</span>
<span class="hljs-addition">+    classInstance.forceUpdate();</span>
<span class="hljs-addition">+}</span>
export class Component{
    static isReactComponent = true;
    constructor(props){
        this.props = props;
<span class="hljs-addition">+        this.state = {};</span>
<span class="hljs-addition">+        this.updater = new Updater(this);</span>
<span class="hljs-addition">+    }</span>
<span class="hljs-addition">+    setState(partialState,callback){</span>
<span class="hljs-addition">+        this.updater.addState(partialState,callback);</span>
<span class="hljs-addition">+    }</span>
<span class="hljs-addition">+    forceUpdate(){</span>
<span class="hljs-addition">+        let oldRenderVdom=this.oldRenderVdom;</span>
<span class="hljs-addition">+        let oldDOM = findDOM(oldRenderVdom);</span>
<span class="hljs-addition">+        let newRenderVdom = this.render();</span>
<span class="hljs-addition">+        compareTwoVdom(oldDOM.parentNode,oldRenderVdom,newRenderVdom);</span>
<span class="hljs-addition">+        this.oldRenderVdom=newRenderVdom;</span>
<span class="hljs-addition">+    }</span>
<span class="hljs-addition">+}</span>
</code></pre>
<h3 id="t775.3 src\react-dom.js">5.3 src\react-dom.js <a href="106.1.react.html#t775.3%20src/react-dom.js"> # </a></h3>
<p>src\react-dom.js</p>
<pre><code class="lang-diff">import {REACT_TEXT} from &apos;./constants&apos;;
function render(vdom,container){
    mount(vdom,container);
}
export function mount(vdom,container){
    let newDOM = createDOM(vdom);
    container.appendChild(newDOM)
}
export function createDOM(vdom){
    let {type,props} = vdom;
    let dom;
    if(type <span class="hljs-comment">=== REACT_TEXT){</span>
        dom = document.createTextNode(props.content);
    }else if(typeof type <span class="hljs-comment">=== &apos;function&apos;){//&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x51FD;&#x6570;&#x7EC4;&#x4EF6;</span>
        if(type.isReactComponent){//&#x8BF4;&#x660E;&#x8FD9;&#x4E2A;type&#x662F;&#x4E00;&#x4E2A;&#x7C7B;&#x7EC4;&#x4EF6;&#x7684;&#x865A;&#x62DF;DOM&#x5143;&#x7D20;
                return mountClassComponent(vdom);
        } else{
                return mountFunctionComponent(vdom);
        }
    }else{
        dom = document.createElement(type);
    }
    if(props){
        updateProps(dom,{},props);
        if(typeof props.children==&apos;object&apos; &amp;&amp; props.children.type){
            mount(props.children,dom);
        }else if(Array.isArray(props.children)){//&#x662F;&#x6570;&#x7EC4;&#x7684;&#x8BDD;
            reconcileChildren(props.children,dom);
        }
    }
    vdom.dom=dom;
    return dom;
}
function mountClassComponent(vdom){
    let {type,props}= vdom;
    let classInstance = new type(props);
    let renderVdom = classInstance.render();
<span class="hljs-addition">+   classInstance.oldRenderVdom = renderVdom;</span>
    let dom =  createDOM(renderVdom);
    return dom;
}
function mountFunctionComponent(vdom){
    let {type,props}= vdom;
    let renderVdom = type(props);
    return createDOM(renderVdom);
}
function updateProps(dom,oldProps,newProps){
    for(let key in newProps){
        if(key <span class="hljs-comment">=== &apos;children&apos;){continue;}</span>
        if(key <span class="hljs-comment">=== &apos;style&apos;){</span>
            let style = newProps[key];
            for(let attr in style){
                dom.style[attr] = style[attr]
            }
<span class="hljs-addition">+       }else if(key.startsWith(&apos;on&apos;)){</span>
<span class="hljs-addition">+           dom[key.toLocaleLowerCase()]=newProps[key];</span>
        }else{
            dom[key]=newProps[key];
        }
    }
}
function reconcileChildren(childrenVdom,parentDOM){
    for (let i = 0; i &lt; childrenVdom.length; i++) {
        let childVdom = childrenVdom[i];
        mount(childVdom,parentDOM);
    }
}
<span class="hljs-addition">+export function findDOM(vdom){</span>
<span class="hljs-addition">+    let {type}= vdom;</span>
<span class="hljs-addition">+    let dom;</span>
<span class="hljs-addition">+    if(typeof type === &apos;function&apos;){</span>
<span class="hljs-addition">+        dom=findDOM(vdom.oldRenderVdom);</span>
<span class="hljs-addition">+    }else{</span>
<span class="hljs-addition">+        dom=vdom.dom;</span>
<span class="hljs-addition">+    }</span>
<span class="hljs-addition">+    return dom;</span>
<span class="hljs-addition">+}</span>
<span class="hljs-addition">+export function compareTwoVdom(parentDOM, oldVdom, newVdom) {</span>
<span class="hljs-addition">+    let oldDOM = findDOM(oldVdom);</span>
<span class="hljs-addition">+    let newDOM = createDOM(newVdom);</span>
<span class="hljs-addition">+    parentDOM.replaceChild(newDOM, oldDOM);</span>
<span class="hljs-addition">+}</span>
const ReactDOM =  {
    render
};
export default ReactDOM;
</code></pre>
<h2 id="t786.&#x5408;&#x6210;&#x4E8B;&#x4EF6;&#x548C;&#x6279;&#x91CF;&#x66F4;&#x65B0;">6.&#x5408;&#x6210;&#x4E8B;&#x4EF6;&#x548C;&#x6279;&#x91CF;&#x66F4;&#x65B0; <a href="106.1.react.html#t786.%E5%90%88%E6%88%90%E4%BA%8B%E4%BB%B6%E5%92%8C%E6%89%B9%E9%87%8F%E6%9B%B4%E6%96%B0"> # </a></h2>
<h3 id="t796.1 src\index.js">6.1 src\index.js <a href="106.1.react.html#t796.1%20src/index.js"> # </a></h3>
<pre><code class="lang-diff">import React from &apos;./react&apos;;
import ReactDOM from &apos;./react-dom&apos;;
class Counter extends React.Component {
    constructor(props) {
        super(props);
        this.state = { number: 0 };
    }
<span class="hljs-addition">+   handleClick = () =&gt; {</span>
<span class="hljs-addition">+        this.setState({ number: this.state.number + 1 });</span>
<span class="hljs-addition">+        console.log(this.state);</span>
<span class="hljs-addition">+        this.setState({ number: this.state.number + 1 });</span>
<span class="hljs-addition">+        console.log(this.state);</span>
<span class="hljs-addition">+        setTimeout(()=&gt;{</span>
<span class="hljs-addition">+            this.setState({ number: this.state.number + 1 });</span>
<span class="hljs-addition">+            console.log(this.state);</span>
<span class="hljs-addition">+        });</span>
<span class="hljs-addition">+   }</span>
    render() {
        return (
            &lt;div&gt;
                &lt;p&gt;number:{this.state.number}&lt;/p&gt;
                &lt;button onClick={this.handleClick}&gt;+&lt;/button&gt;
            &lt;/div&gt;
        )
    }
}
ReactDOM.render(&lt;Counter title=&quot;&#x8BA1;&#x6570;&#x5668;&quot; /&gt;, document.getElementById(&apos;root&apos;));
</code></pre>
<h3 id="t806.2 src\utils.js">6.2 src\utils.js <a href="106.1.react.html#t806.2%20src/utils.js"> # </a></h3>
<p>src\utils.js</p>
<pre><code class="lang-diff">import {REACT_TEXT} from &apos;./constants&apos;;
export function wrapToVdom(element){
    return (typeof element <span class="hljs-comment">=== &apos;string&apos;||typeof element === &apos;number&apos;)</span>
    ?{type:REACT_TEXT,props:{content:element}}:element;
}
<span class="hljs-addition">+export function isFunction(obj) {</span>
<span class="hljs-addition">+    return typeof obj === &apos;function&apos;;</span>
<span class="hljs-addition">+}</span>
</code></pre>
<h3 id="t816.3 src\Component.js">6.3 src\Component.js <a href="106.1.react.html#t816.3%20src/Component.js"> # </a></h3>
<p>src\Component.js</p>
<pre><code class="lang-diff">import {findDOM,compareTwoVdom} from &apos;./react-dom&apos;;
<span class="hljs-addition">+export let updateQueue = {</span>
<span class="hljs-addition">+    isBatchingUpdate:false,</span>
<span class="hljs-addition">+    updaters:[],</span>
<span class="hljs-addition">+    batchUpdate(){//&#x6279;&#x91CF;&#x66F4;&#x65B0;</span>
<span class="hljs-addition">+      for(let updater of updateQueue.updaters){</span>
<span class="hljs-addition">+        updater.updateComponent();</span>
<span class="hljs-addition">+      }</span>
<span class="hljs-addition">+      updateQueue.isBatchingUpdate = false;</span>
<span class="hljs-addition">+      updateQueue.updaters.length=0;</span>
<span class="hljs-addition">+    }</span>
<span class="hljs-addition">+}</span>
class Updater{
    constructor(classInstance){
        this.classInstance = classInstance;
        this.pendingStates = [];
        this.callbacks = [];
    }
    addState(partialState,callback){
        this.pendingStates.push(partialState);///&#x7B49;&#x5F85;&#x66F4;&#x65B0;&#x7684;&#x6216;&#x8005;&#x8BF4;&#x7B49;&#x5F85;&#x751F;&#x6548;&#x7684;&#x72B6;&#x6001;
        if(typeof callback <span class="hljs-comment">===&apos;function&apos;)</span>
            this.callbacks.push(callback);//&#x72B6;&#x6001;&#x66F4;&#x65B0;&#x540E;&#x7684;&#x56DE;&#x8C03;
        this.emitUpdate();    
    }
<span class="hljs-addition">+   emitUpdate(nextProps){</span>
<span class="hljs-addition">+       this.nextProps = nextProps;</span>
<span class="hljs-addition">+       if(updateQueue.isBatchingUpdate){</span>
<span class="hljs-addition">+           updateQueue.updaters.push(this);</span>
<span class="hljs-addition">+       }else{</span>
<span class="hljs-addition">+           this.updateComponent();</span>
<span class="hljs-addition">+       }</span>
<span class="hljs-addition">+   }</span>
    updateComponent(){
        let {classInstance,pendingStates,nextProps} = this;
<span class="hljs-addition">+       if(nextProps || pendingStates.length&gt;0){</span>
<span class="hljs-addition">+          shouldUpdate(classInstance,nextProps,this.getState());</span>
<span class="hljs-addition">+       }</span>
    }
    getState(){
        let {classInstance,pendingStates} = this;
        let {state}=classInstance;
        pendingStates.forEach((nextState)=&gt;{
            if(typeof nextState <span class="hljs-comment">=== &apos;function&apos;){</span>
                nextState=nextState(state);
            }
            state={...state,...nextState};
        });
        pendingStates.length=0;
        return state;
    }
}
<span class="hljs-addition">+function shouldUpdate(classInstance,nextProps,nextState){</span>
    classInstance.state = nextState;
    classInstance.forceUpdate();
}
export class Component{
    static isReactComponent = true;
    constructor(props){
        this.props = props;
        this.state = {};
        this.updater = new Updater(this);
    }
    setState(partialState,callback){
        this.updater.addState(partialState,callback);
    }
    forceUpdate(){
        let oldRenderVdom=this.oldRenderVdom;
        let oldDOM = findDOM(oldRenderVdom);
        let newRenderVdom = this.render();
        compareTwoVdom(oldDOM.parentNode,oldRenderVdom,newRenderVdom);
        this.oldRenderVdom=newRenderVdom;
    }
}
</code></pre>
<h3 id="t826.4 src\event.js">6.4 src\event.js <a href="106.1.react.html#t826.4%20src/event.js"> # </a></h3>
<p>src\event.js</p>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> {updateQueue} <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./Component&apos;</span>;
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addEvent</span>(<span class="hljs-params">dom,eventType,handleClick</span>)</span>{
    <span class="hljs-keyword">let</span> store;
    <span class="hljs-keyword">if</span>(dom.store){
        store = dom.store;
    }<span class="hljs-keyword">else</span>{
        dom.store={};
        store=dom.store;
    }
   store[eventType]=handleClick;
   <span class="hljs-keyword">if</span>(!<span class="hljs-built_in">document</span>[eventType]){
    <span class="hljs-built_in">document</span>[eventType]=dispatchEvent;
   }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dispatchEvent</span>(<span class="hljs-params">event</span>)</span>{
    <span class="hljs-keyword">let</span> {target,type}= event;
    <span class="hljs-keyword">let</span> eventType = <span class="hljs-string">`on<span class="hljs-subst">${type}</span>`</span>;
    updateQueue.isBatchingUpdate = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">let</span> syntheticEvent = createSyntheticEvent(event);
    <span class="hljs-keyword">while</span>(target){
        <span class="hljs-keyword">let</span> {store}=target;
        <span class="hljs-keyword">let</span> handleClick = store&amp;&amp;store[eventType];
        handleClick&amp;&amp;handleClick.call(target,syntheticEvent);
        target=target.parentNode;
    }
    updateQueue.isBatchingUpdate = <span class="hljs-literal">false</span>;
    updateQueue.batchUpdate();
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createSyntheticEvent</span>(<span class="hljs-params">nativeEvent</span>)</span>{
    <span class="hljs-keyword">let</span> syntheticEvent = {};
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> nativeEvent){
        syntheticEvent[key]=nativeEvent[key];
    }
    <span class="hljs-keyword">return</span> syntheticEvent;
}
</code></pre>
<h3 id="t836.5 src\react-dom.js">6.5 src\react-dom.js <a href="106.1.react.html#t836.5%20src/react-dom.js"> # </a></h3>
<p>src\react-dom.js</p>
<pre><code class="lang-diff"><span class="hljs-addition">+import { addEvent } from &apos;./event&apos;;</span>
function updateProps(dom,oldProps,newProps){
    for(let key in newProps){
        if(key <span class="hljs-comment">=== &apos;children&apos;){continue;}</span>
        if(key <span class="hljs-comment">=== &apos;style&apos;){</span>
            let style = newProps[key];
            for(let attr in style){
                dom.style[attr] = style[attr]
            }
        }else if(key.startsWith(&apos;on&apos;)){
<span class="hljs-addition">+           addEvent(dom,key.toLocaleLowerCase(),newProps[key]);</span>
        }else{
            dom[key]=newProps[key];
        }
    }
}
</code></pre>
<h2 id="t847.ref">7.ref <a href="106.1.react.html#t847.ref"> # </a></h2>
<h3 id="t857.1 src\index.js">7.1 src\index.js <a href="106.1.react.html#t857.1%20src/index.js"> # </a></h3>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react-dom&apos;</span>;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Sum</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
    <span class="hljs-keyword">constructor</span>(props) {
        <span class="hljs-keyword">super</span>(props);
        <span class="hljs-keyword">this</span>.a = React.createRef();
        <span class="hljs-keyword">this</span>.b = React.createRef();
        <span class="hljs-keyword">this</span>.result = React.createRef();
    }
    handleAdd = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        <span class="hljs-keyword">let</span> a = <span class="hljs-keyword">this</span>.a.current.value;
        <span class="hljs-keyword">let</span> b = <span class="hljs-keyword">this</span>.b.current.value;
        <span class="hljs-keyword">this</span>.result.current.value = <span class="hljs-built_in">parseFloat</span>(a) + <span class="hljs-built_in">parseFloat</span>(b);
    }
    render() {
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{this.a}</span> /&gt;</span>+<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{this.b}</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{this.handleAdd}</span>&gt;</span>=<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{this.result}</span> /&gt;</span>
            <span class="hljs-tag">&lt;/&gt;</span></span>
        );
    }
}
ReactDOM.render(
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Sum</span> /&gt;</span></span>,
    <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;root&apos;</span>)
);
</code></pre>
<h3 id="t867.2 src\constants.js">7.2 src\constants.js <a href="106.1.react.html#t867.2%20src/constants.js"> # </a></h3>
<p>src\constants.js</p>
<pre><code class="lang-diff">export const REACT_TEXT = Symbol(&apos;REACT_TEXT&apos;);
<span class="hljs-addition">+export const REACT_FORWARD_REF_TYPE = Symbol(&apos;react.forward_ref&apos;);</span>
</code></pre>
<h3 id="t877.3 src\react.js">7.3 src\react.js <a href="106.1.react.html#t877.3%20src/react.js"> # </a></h3>
<p>src\react.js</p>
<pre><code class="lang-diff">import {wrapToVdom} from &apos;./utils&apos;;
import {Component} from &apos;./Component&apos;;
function createElement(type,config,children){
    let ref;
    let key;
    if(config){
        delete config.__source;
        delete config.__self;
        ref = config.ref;
        delete config.ref;
        key = config.key;
        delete config.key;
    }
   let props = {...config};
   if(arguments.length&gt;3){
       props.children=Array.prototype.slice.call(arguments,2).map(wrapToVdom);
   }else{
        props.children=wrapToVdom(children);
   }
   return {
       type,
       ref,
       key,
       props
   }
}
<span class="hljs-addition">+function createRef(){</span>
<span class="hljs-addition">+    return {current:null};</span>
<span class="hljs-addition">+}</span>
<span class="hljs-addition">+function forwardRef(render) {  </span>
<span class="hljs-addition">+    var elementType = {</span>
<span class="hljs-addition">+      type: REACT_FORWARD_REF_TYPE,</span>
<span class="hljs-addition">+      render: render</span>
<span class="hljs-addition">+    };</span>
<span class="hljs-addition">+    return elementType;</span>
<span class="hljs-addition">+}</span>
const React = {
    createElement,
    Component,
<span class="hljs-addition">+   createRef</span>
};
export default React;
</code></pre>
<h3 id="t887.3 src\react-dom.js">7.3 src\react-dom.js <a href="106.1.react.html#t887.3%20src/react-dom.js"> # </a></h3>
<p>src\react-dom.js</p>
<pre><code class="lang-diff"><span class="hljs-addition">+import {REACT_TEXT,REACT_FORWARD_REF_TYPE} from &apos;./constants&apos;;</span>
import {addEvent} from &apos;./event&apos;;
function render(vdom,container){
    mount(vdom,container);
}
export function mount(vdom,container){
    let newDOM = createDOM(vdom);
    container.appendChild(newDOM)
}
export function createDOM(vdom){
    let {type,props,ref} = vdom;
    let dom;
<span class="hljs-addition">+   if(type&amp;&amp;type.$$typeof===REACT_FORWARD_REF_TYPE){</span>
<span class="hljs-addition">+       return mountForwardComponent(vdom);</span>
    }else if(type <span class="hljs-comment">=== REACT_TEXT){</span>
        dom = document.createTextNode(props.content);
    }else if(typeof type <span class="hljs-comment">=== &apos;function&apos;){//&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x51FD;&#x6570;&#x7EC4;&#x4EF6;</span>
        if(type.isReactComponent){//&#x8BF4;&#x660E;&#x8FD9;&#x4E2A;type&#x662F;&#x4E00;&#x4E2A;&#x7C7B;&#x7EC4;&#x4EF6;&#x7684;&#x865A;&#x62DF;DOM&#x5143;&#x7D20;
                return mountClassComponent(vdom);
        } else{
                return mountFunctionComponent(vdom);
        }
    }else{
        dom = document.createElement(type);
    }
    if(props){
        updateProps(dom,{},props);
        if(typeof props.children==&apos;object&apos; &amp;&amp; props.children.type){
            mount(props.children,dom);
        }else if(Array.isArray(props.children)){//&#x662F;&#x6570;&#x7EC4;&#x7684;&#x8BDD;
            reconcileChildren(props.children,dom);
        }
    }
    vdom.dom=dom;
<span class="hljs-addition">+   if(ref) ref.current = dom;</span>
    return dom;
}
<span class="hljs-addition">+function mountForwardComponent(vdom){</span>
<span class="hljs-addition">+    let {type,props,ref} = vdom;</span>
<span class="hljs-addition">+    let renderVdom = type.render(props,ref);</span>
<span class="hljs-addition">+    vdom.oldRenderVdom = renderVdom;</span>
<span class="hljs-addition">+    return createDOM(renderVdom);</span>
<span class="hljs-addition">+}</span>
function mountClassComponent(vdom){
    let {type,props,ref}= vdom;
    let classInstance = new type(props);
<span class="hljs-addition">+   if(ref) classInstance.ref = ref;</span>
    let renderVdom = classInstance.render();
    classInstance.oldRenderVdom = renderVdom;
    let dom =  createDOM(renderVdom);
    return dom;
}
function mountFunctionComponent(vdom){
    let {type,props}= vdom;
    let renderVdom = type(props);
    return createDOM(renderVdom);
}
function updateProps(dom,oldProps,newProps){
    for(let key in newProps){
        if(key <span class="hljs-comment">=== &apos;children&apos;){continue;}</span>
        if(key <span class="hljs-comment">=== &apos;style&apos;){</span>
            let style = newProps[key];
            for(let attr in style){
                dom.style[attr] = style[attr]
            }
        }else if(key.startsWith(&apos;on&apos;)){
            addEvent(dom,key.toLocaleLowerCase(),newProps[key]);
        }else{
            dom[key]=newProps[key];
        }
    }
}
function reconcileChildren(childrenVdom,parentDOM){
    for (let i = 0; i &lt; childrenVdom.length; i++) {
        let childVdom = childrenVdom[i];
        mount(childVdom,parentDOM);
    }
}
export function findDOM(vdom){
    let {type}= vdom;
    let dom;
    if(typeof type <span class="hljs-comment">=== &apos;function&apos;){</span>
        dom=findDOM(vdom.oldRenderVdom);
    }else{
        dom=vdom.dom;
    }
    return dom;
}
export function compareTwoVdom(parentDOM, oldVdom, newVdom) {
    let oldDOM = findDOM(oldVdom);
    let newDOM = createDOM(newVdom);
    parentDOM.replaceChild(newDOM, oldDOM);
}
const ReactDOM =  {
    render
};
export default ReactDOM;
</code></pre>
<h2 id="t898.&#x57FA;&#x672C;&#x751F;&#x547D;&#x5468;&#x671F;">8.&#x57FA;&#x672C;&#x751F;&#x547D;&#x5468;&#x671F; <a href="106.1.react.html#t898.%E5%9F%BA%E6%9C%AC%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"> # </a></h2>
<h3 id="t908.1 src\index.js">8.1 src\index.js <a href="106.1.react.html#t908.1%20src/index.js"> # </a></h3>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./react&apos;</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./react-dom&apos;</span>;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Counter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span></span>{ <span class="hljs-comment">// &#x4ED6;&#x4F1A;&#x6BD4;&#x8F83;&#x4E24;&#x4E2A;&#x72B6;&#x6001;&#x76F8;&#x7B49;&#x5C31;&#x4E0D;&#x4F1A;&#x5237;&#x65B0;&#x89C6;&#x56FE; PureComponent&#x662F;&#x6D45;&#x6BD4;&#x8F83;</span>
    <span class="hljs-keyword">static</span> defaultProps = {
        <span class="hljs-attr">name</span>: <span class="hljs-string">&apos;&#x73E0;&#x5CF0;&#x67B6;&#x6784;&apos;</span>
    };
    <span class="hljs-keyword">constructor</span>(props) {
        <span class="hljs-keyword">super</span>(props);
        <span class="hljs-keyword">this</span>.state = { <span class="hljs-attr">number</span>: <span class="hljs-number">0</span> }
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;Counter 1.constructor&apos;</span>)
    }
    componentWillMount() { <span class="hljs-comment">// &#x53D6;&#x672C;&#x5730;&#x7684;&#x6570;&#x636E; &#x540C;&#x6B65;&#x7684;&#x65B9;&#x5F0F;&#xFF1A;&#x91C7;&#x7528;&#x6E32;&#x67D3;&#x4E4B;&#x524D;&#x83B7;&#x53D6;&#x6570;&#x636E;&#xFF0C;&#x53EA;&#x6E32;&#x67D3;&#x4E00;&#x6B21;</span>
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;Counter 2.componentWillMount&apos;</span>);
    }
    componentDidMount() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;Counter 4.componentDidMount&apos;</span>);
    }
    handleClick = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        <span class="hljs-keyword">this</span>.setState({ <span class="hljs-attr">number</span>: <span class="hljs-keyword">this</span>.state.number + <span class="hljs-number">1</span> });
    };
    <span class="hljs-comment">// react&#x53EF;&#x4EE5;shouldComponentUpdate&#x65B9;&#x6CD5;&#x4E2D;&#x4F18;&#x5316; PureComponent &#x53EF;&#x4EE5;&#x5E2E;&#x6211;&#x4EEC;&#x505A;&#x8FD9;&#x4EF6;&#x4E8B;</span>
    shouldComponentUpdate(nextProps, nextState) { <span class="hljs-comment">// &#x4EE3;&#x8868;&#x7684;&#x662F;&#x4E0B;&#x4E00;&#x6B21;&#x7684;&#x5C5E;&#x6027; &#x548C; &#x4E0B;&#x4E00;&#x6B21;&#x7684;&#x72B6;&#x6001;</span>
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;Counter 5.shouldComponentUpdate&apos;</span>);
        <span class="hljs-keyword">return</span> nextState.number % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>;
        <span class="hljs-comment">// return nextState.number!==this.state.number; //&#x5982;&#x679C;&#x6B64;&#x51FD;&#x6570;&#x79CD;&#x8FD4;&#x56DE;&#x4E86;false &#x5C31;&#x4E0D;&#x4F1A;&#x8C03;&#x7528;render&#x65B9;&#x6CD5;&#x4E86;</span>
    } <span class="hljs-comment">//&#x4E0D;&#x8981;&#x968F;&#x4FBF;&#x7528;setState &#x53EF;&#x80FD;&#x4F1A;&#x6B7B;&#x5FAA;&#x73AF;</span>
    componentWillUpdate() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;Counter 6.componentWillUpdate&apos;</span>);
    }
    componentDidUpdate() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;Counter 7.componentDidUpdate&apos;</span>);
    }
    render() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;Counter 3.render&apos;</span>);
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{this.state.number}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{this.handleClick}</span>&gt;</span>+<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
        )
    }
}
ReactDOM.render(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Counter</span> /&gt;</span></span>, <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;root&apos;</span>));
</code></pre>
<pre><code class="lang-js">Counter <span class="hljs-number">1.</span><span class="hljs-keyword">constructor</span>
Counter 2.componentWillMount
Counter 3.render
Counter 4.componentDidMount
2 Counter 5.shouldComponentUpdate
Counter 6.componentWillUpdate
Counter 3.render
Counter 7.componentDidUpdate
2 Counter 5.shouldComponentUpdate
Counter 6.componentWillUpdate
Counter 3.render
Counter 7.componentDidUpdate
</code></pre>
<h3 id="t918.2 src\Component.js">8.2 src\Component.js <a href="106.1.react.html#t918.2%20src/Component.js"> # </a></h3>
<p>src\Component.js</p>
<pre><code class="lang-diff">import {findDOM,compareTwoVdom} from &apos;./react-dom&apos;;
export let updateQueue = {
    isBatchingUpdate:false,
    updaters:[],
    batchUpdate(){//&#x6279;&#x91CF;&#x66F4;&#x65B0;
      for(let updater of updateQueue.updaters){
        updater.updateComponent();
      }
      updateQueue.isBatchingUpdate = false;
      updateQueue.updaters.length=0;
    }
}
class Updater{
    constructor(classInstance){
        this.classInstance = classInstance;
        this.pendingStates = [];
        this.callbacks = [];
    }
    addState(partialState,callback){
        this.pendingStates.push(partialState);///&#x7B49;&#x5F85;&#x66F4;&#x65B0;&#x7684;&#x6216;&#x8005;&#x8BF4;&#x7B49;&#x5F85;&#x751F;&#x6548;&#x7684;&#x72B6;&#x6001;
        if(typeof callback <span class="hljs-comment">===&apos;function&apos;)</span>
            this.callbacks.push(callback);//&#x72B6;&#x6001;&#x66F4;&#x65B0;&#x540E;&#x7684;&#x56DE;&#x8C03;
        this.emitUpdate();    
    }
    emitUpdate(nextProps){
        this.nextProps = nextProps;
        if(updateQueue.isBatchingUpdate){
            updateQueue.updaters.push(this);
        }else{
            this.updateComponent();
        }
    }
    updateComponent(){
        let {classInstance,pendingStates,nextProps} = this;
        if(nextProps || pendingStates.length&gt;0){
           shouldUpdate(classInstance,nextProps,this.getState());
        }
    }
    getState(){
        let {classInstance,pendingStates} = this;
        let {state}=classInstance;
        pendingStates.forEach((nextState)=&gt;{
            if(typeof nextState <span class="hljs-comment">=== &apos;function&apos;){</span>
                nextState=nextState(state);
            }
            state={...state,...nextState};
        });
        pendingStates.length=0;
        return state;
    }
}
function shouldUpdate(classInstance,nextProps,nextState){
<span class="hljs-addition">+    let willUpdate = true;</span>
<span class="hljs-addition">+    if(classInstance.shouldComponentUpdate</span>
<span class="hljs-addition">+        &amp;&amp;!classInstance.shouldComponentUpdate(nextProps,nextState)){</span>
<span class="hljs-addition">+            willUpdate = false;</span>
<span class="hljs-addition">+    }</span>
<span class="hljs-addition">+    if(willUpdate &amp;&amp; classInstance.componentWillUpdate){</span>
<span class="hljs-addition">+        classInstance.componentWillUpdate();</span>
<span class="hljs-addition">+    }</span>
<span class="hljs-addition">+    if(nextProps){</span>
<span class="hljs-addition">+        classInstance.props = nextProps;</span>
<span class="hljs-addition">+    }</span>
    classInstance.state = nextState;
<span class="hljs-addition">+    if(willUpdate)</span>
<span class="hljs-addition">+        classInstance.forceUpdate();</span>
}
export class Component{
    static isReactComponent = true;
    constructor(props){
        this.props = props;
        this.state = {};
        this.updater = new Updater(this);
    }
    setState(partialState,callback){
        this.updater.addState(partialState,callback);
    }
    forceUpdate(){
        let oldRenderVdom=this.oldRenderVdom;
        let oldDOM = findDOM(oldRenderVdom);
        let newRenderVdom = this.render();
        compareTwoVdom(oldDOM.parentNode,oldRenderVdom,newRenderVdom);
        this.oldRenderVdom=newRenderVdom;
<span class="hljs-addition">+        if(this.componentDidUpdate){</span>
<span class="hljs-addition">+            this.componentDidUpdate(this.props,this.state);</span>
<span class="hljs-addition">+        }</span>
    }
}
</code></pre>
<h3 id="t928.3 src\react-dom.js">8.3 src\react-dom.js <a href="106.1.react.html#t928.3%20src/react-dom.js"> # </a></h3>
<p>src\react-dom.js</p>
<pre><code class="lang-diff">import {REACT_TEXT,REACT_FORWARD_REF_TYPE} from &apos;./constants&apos;;
import {addEvent} from &apos;./event&apos;;
function render(vdom,container){
    mount(vdom,container);
}
export function mount(vdom,container){
    let newDOM = createDOM(vdom);
    container.appendChild(newDOM);
    if (newDOM.componentDidMount) newDOM.componentDidMount();
}
export function createDOM(vdom){
    let {type,props,ref} = vdom;
    let dom;
    if(type&amp;&amp;type.$$typeof<span class="hljs-comment">===REACT_FORWARD_REF_TYPE){</span>
       return mountForwardComponent(vdom);
    }else if(type <span class="hljs-comment">=== REACT_TEXT){</span>
        dom = document.createTextNode(props.content);
    }else if(typeof type <span class="hljs-comment">=== &apos;function&apos;){//&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x51FD;&#x6570;&#x7EC4;&#x4EF6;</span>
        if(type.isReactComponent){//&#x8BF4;&#x660E;&#x8FD9;&#x4E2A;type&#x662F;&#x4E00;&#x4E2A;&#x7C7B;&#x7EC4;&#x4EF6;&#x7684;&#x865A;&#x62DF;DOM&#x5143;&#x7D20;
                return mountClassComponent(vdom);
        } else{
                return mountFunctionComponent(vdom);
        }
    }else{
        dom = document.createElement(type);
    }
    if(props){
        updateProps(dom,{},props);
        if(typeof props.children==&apos;object&apos; &amp;&amp; props.children.type){
            mount(props.children,dom);
        }else if(Array.isArray(props.children)){//&#x662F;&#x6570;&#x7EC4;&#x7684;&#x8BDD;
            reconcileChildren(props.children,dom);
        }
    }
    vdom.dom=dom;
    if(ref) ref.current = dom;
    return dom;
}
function mountForwardComponent(vdom){
    let {type,props,ref} = vdom;
    let renderVdom = type.render(props,ref);
    vdom.oldRenderVdom = renderVdom;
    return createDOM(renderVdom);
}
function mountClassComponent(vdom){
    let {type,props,ref}= vdom;
    let classInstance = new type(props);
<span class="hljs-addition">+   if (classInstance.componentWillMount) classInstance.componentWillMount();</span>
    if(ref) classInstance.ref = ref;
    let renderVdom = classInstance.render();
    classInstance.oldRenderVdom = renderVdom;
    let dom =  createDOM(renderVdom);
<span class="hljs-addition">+   if (classInstance.componentDidMount)</span>
        dom.componentDidMount = classInstance.componentDidMount.bind(classInstance);
    return dom;
}
function mountFunctionComponent(vdom){
    let {type,props}= vdom;
    let renderVdom = type(props);
    return createDOM(renderVdom);
}
function updateProps(dom,oldProps,newProps){
    for(let key in newProps){
        if(key <span class="hljs-comment">=== &apos;children&apos;){continue;}</span>
        if(key <span class="hljs-comment">=== &apos;style&apos;){</span>
            let style = newProps[key];
            for(let attr in style){
                dom.style[attr] = style[attr]
            }
        }else if(key.startsWith(&apos;on&apos;)){
            addEvent(dom,key.toLocaleLowerCase(),newProps[key]);
        }else{
            dom[key]=newProps[key];
        }
    }
}
function reconcileChildren(childrenVdom,parentDOM){
    for (let i = 0; i &lt; childrenVdom.length; i++) {
        let childVdom = childrenVdom[i];
        mount(childVdom,parentDOM);
    }
}
export function findDOM(vdom){
    let {type}= vdom;
    let dom;
    if(typeof type <span class="hljs-comment">=== &apos;function&apos;){</span>
        dom=findDOM(vdom.oldRenderVdom);
    }else{
        dom=vdom.dom;
    }
    return dom;
}
export function compareTwoVdom(parentDOM, oldVdom, newVdom) {
    let oldDOM = findDOM(oldVdom);
    let newDOM = createDOM(newVdom);
    parentDOM.replaceChild(newDOM, oldDOM);
}
const ReactDOM =  {
    render
};
export default ReactDOM;
</code></pre>
<h2 id="t939.&#x5B50;&#x7EC4;&#x4EF6;&#x751F;&#x547D;&#x5468;&#x671F;">9.&#x5B50;&#x7EC4;&#x4EF6;&#x751F;&#x547D;&#x5468;&#x671F; <a href="106.1.react.html#t939.%E5%AD%90%E7%BB%84%E4%BB%B6%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"> # </a></h2>
<h3 id="t949.1 src\index.js">9.1 src\index.js <a href="106.1.react.html#t949.1%20src/index.js"> # </a></h3>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./react&apos;</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./react-dom&apos;</span>;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Counter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span></span>{ <span class="hljs-comment">// &#x4ED6;&#x4F1A;&#x6BD4;&#x8F83;&#x4E24;&#x4E2A;&#x72B6;&#x6001;&#x76F8;&#x7B49;&#x5C31;&#x4E0D;&#x4F1A;&#x5237;&#x65B0;&#x89C6;&#x56FE; PureComponent&#x662F;&#x6D45;&#x6BD4;&#x8F83;</span>
    <span class="hljs-keyword">static</span> defaultProps = {
        <span class="hljs-attr">name</span>: <span class="hljs-string">&apos;&#x73E0;&#x5CF0;&#x67B6;&#x6784;&apos;</span>
    };
    <span class="hljs-keyword">constructor</span>(props) {
        <span class="hljs-keyword">super</span>(props);
        <span class="hljs-keyword">this</span>.state = { <span class="hljs-attr">number</span>: <span class="hljs-number">0</span> }
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;Counter 1.constructor&apos;</span>)
    }
    componentWillMount() { <span class="hljs-comment">// &#x53D6;&#x672C;&#x5730;&#x7684;&#x6570;&#x636E; &#x540C;&#x6B65;&#x7684;&#x65B9;&#x5F0F;&#xFF1A;&#x91C7;&#x7528;&#x6E32;&#x67D3;&#x4E4B;&#x524D;&#x83B7;&#x53D6;&#x6570;&#x636E;&#xFF0C;&#x53EA;&#x6E32;&#x67D3;&#x4E00;&#x6B21;</span>
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;Counter 2.componentWillMount&apos;</span>);
    }
    componentDidMount() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;Counter 4.componentDidMount&apos;</span>);
    }
    handleClick = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        <span class="hljs-keyword">this</span>.setState({ <span class="hljs-attr">number</span>: <span class="hljs-keyword">this</span>.state.number + <span class="hljs-number">1</span> });
    };
    <span class="hljs-comment">// react&#x53EF;&#x4EE5;shouldComponentUpdate&#x65B9;&#x6CD5;&#x4E2D;&#x4F18;&#x5316; PureComponent &#x53EF;&#x4EE5;&#x5E2E;&#x6211;&#x4EEC;&#x505A;&#x8FD9;&#x4EF6;&#x4E8B;</span>
    shouldComponentUpdate(nextProps, nextState) { <span class="hljs-comment">// &#x4EE3;&#x8868;&#x7684;&#x662F;&#x4E0B;&#x4E00;&#x6B21;&#x7684;&#x5C5E;&#x6027; &#x548C; &#x4E0B;&#x4E00;&#x6B21;&#x7684;&#x72B6;&#x6001;</span>
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;Counter 5.shouldComponentUpdate&apos;</span>);
        <span class="hljs-keyword">return</span> nextState.number % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>;
        <span class="hljs-comment">// return nextState.number!==this.state.number; //&#x5982;&#x679C;&#x6B64;&#x51FD;&#x6570;&#x79CD;&#x8FD4;&#x56DE;&#x4E86;false &#x5C31;&#x4E0D;&#x4F1A;&#x8C03;&#x7528;render&#x65B9;&#x6CD5;&#x4E86;</span>
    } <span class="hljs-comment">//&#x4E0D;&#x8981;&#x968F;&#x4FBF;&#x7528;setState &#x53EF;&#x80FD;&#x4F1A;&#x6B7B;&#x5FAA;&#x73AF;</span>
    componentWillUpdate() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;Counter 6.componentWillUpdate&apos;</span>);
    }
    componentDidUpdate() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;Counter 7.componentDidUpdate&apos;</span>);
    }
    render() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;Counter 3.render&apos;</span>);
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{this.state.number}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                {this.state.number === 4 ? null : <span class="hljs-tag">&lt;<span class="hljs-name">ChildCounter</span> <span class="hljs-attr">count</span>=<span class="hljs-string">{this.state.number}</span> /&gt;</span>}
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{this.handleClick}</span>&gt;</span>+<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
        )
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ChildCounter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
    componentWillUnmount() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos; ChildCounter 6.componentWillUnmount&apos;</span>)
    }
    componentWillMount() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;ChildCounter 1.componentWillMount&apos;</span>)
    }
    render() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;ChildCounter 2.render&apos;</span>)
        <span class="hljs-keyword">return</span> (<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            {this.props.count}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>)
    }
    componentDidMount() {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;ChildCounter 3.componentDidMount&apos;</span>)
    }
    componentWillReceiveProps(newProps) { <span class="hljs-comment">// &#x7B2C;&#x4E00;&#x6B21;&#x4E0D;&#x4F1A;&#x6267;&#x884C;&#xFF0C;&#x4E4B;&#x540E;&#x5C5E;&#x6027;&#x66F4;&#x65B0;&#x65F6;&#x624D;&#x4F1A;&#x6267;&#x884C;</span>
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;ChildCounter 4.componentWillReceiveProps&apos;</span>)
    }
    shouldComponentUpdate(nextProps, nextState) {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;ChildCounter 5.shouldComponentUpdate&apos;</span>)
        <span class="hljs-keyword">return</span> nextProps.n % <span class="hljs-number">3</span> === <span class="hljs-number">0</span>; <span class="hljs-comment">//&#x5B50;&#x7EC4;&#x4EF6;&#x5224;&#x65AD;&#x63A5;&#x6536;&#x7684;&#x5C5E;&#x6027; &#x662F;&#x5426;&#x6EE1;&#x8DB3;&#x66F4;&#x65B0;&#x6761;&#x4EF6; &#x4E3A;true&#x5219;&#x66F4;&#x65B0;</span>
    }
}
ReactDOM.render(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Counter</span> /&gt;</span></span>, <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;root&apos;</span>));
</code></pre>
<pre><code class="lang-js">Counter <span class="hljs-number">1.</span><span class="hljs-keyword">constructor</span>
Counter 2.componentWillMount
Counter 3.render
ChildCounter 1.componentWillMount
ChildCounter 2.render
ChildCounter 3.componentDidMount
Counter 4.componentDidMount
Counter 5.shouldComponentUpdate
Counter 5.shouldComponentUpdate
Counter 6.componentWillUpdate
Counter 3.render
ChildCounter 4.componentWillReceiveProps
Counter 5.shouldComponentUpdate
Counter 7.componentDidUpdate
Counter 5.shouldComponentUpdate
Counter 5.shouldComponentUpdate
Counter 6.componentWillUpdate
Counter 3.render
ChildCounter 6.componentWillUnmount
Counter 7.componentDidUpdate
Counter 5.shouldComponentUpdate
Counter 5.shouldComponentUpdate
Counter 6.componentWillUpdate
Counter 3.render
ChildCounter 1.componentWillMount
ChildCounter 2.render
ChildCounter 3.componentDidMount
Counter 7.componentDidUpdate
Counter 5.shouldComponentUpdate
Counter 5.shouldComponentUpdate
Counter 6.componentWillUpdate
Counter 3.render
ChildCounter 4.componentWillReceiveProps
Counter 5.shouldComponentUpdate
Counter 7.componentDidUpdate
</code></pre>
<p><img src="https://img.zhufengpeixun.com/counterdomdiff.jpg" alt="counterdomdiff.jpg"></p>
<h3 id="t959.2 src\Component.js">9.2 src\Component.js <a href="106.1.react.html#t959.2%20src/Component.js"> # </a></h3>
<p>src\Component.js</p>
<pre><code class="lang-diff">import {findDOM,compareTwoVdom} from &apos;./react-dom&apos;;
export let updateQueue = {
  isBatchingUpdate:false,//&#x901A;&#x8FC7;&#x6B64;&#x53D8;&#x91CF;&#x6765;&#x63A7;&#x5236;&#x662F;&#x5426;&#x6279;&#x91CF;&#x66F4;&#x65B0;
  updaters:[],
  batchUpdate(){
    for(let updater of updateQueue.updaters){
      updater.updateComponent();
    }
    updateQueue.isBatchingUpdate=false;
    updateQueue.updaters.length=0;
  }
}
class Updater{
  constructor(classInstance){
    this.classInstance = classInstance;
    this.pendingStates = [];
    this.callbacks = [];
  }
  addState(partialState,callback){
    this.pendingStates.push(partialState);
    if(typeof callback <span class="hljs-comment">===&apos;function&apos;)</span>
       this.callbacks.push(callback)
    this.emitUpdate();   
  }
  emitUpdate(nextProps){
       this.nextProps  = nextProps;
       if(updateQueue.isBatchingUpdate){
         updateQueue.updaters.push(this);
       }else{
        this.updateComponent();
       }
  }
  updateComponent(){
     let {classInstance,pendingStates,nextProps} = this;   
     if(nextProps||pendingStates.length &gt; 0){
        shouldUpdate(classInstance,nextProps,this.getState());
     }
  }
  getState(){
    let {classInstance,pendingStates} = this;  
    let {state} = classInstance;
    pendingStates.forEach(nextState=&gt;{
       if(typeof nextState <span class="hljs-comment">=== &apos;function&apos;)  {</span>
        nextState=nextState(state);
       }  
       state = {...state,...nextState};
    });
    pendingStates.length = 0;
    return state;
  }
}
function shouldUpdate(classInstance,nextProps,nextState){
  let willUpdate = true;
  if(classInstance.shouldComponentUpdate
    &amp;&amp;(!classInstance.shouldComponentUpdate(nextProps,nextState))){
      willUpdate=false;
  }
  if(willUpdate &amp;&amp; classInstance.componentWillUpdate){
    classInstance.componentWillUpdate();
  }
  if(nextProps) classInstance.props = nextProps;
  classInstance.state = nextState;
  if(willUpdate){
    classInstance.forceUpdate();
  }
}
export class Component{
    static isReactComponent = true
    constructor(props){
        this.props = props;
        this.state = {};
        this.updater = new Updater(this);
    }
    setState(partialState,callback){
        this.updater.addState(partialState,callback);
    }
    forceUpdate(){
        let oldRenderVdom = this.oldRenderVdom;
        let oldDOM = findDOM(oldRenderVdom);
        let newRenderVdom = this.render();
        compareTwoVdom(oldDOM.parentNode,oldRenderVdom,newRenderVdom);
        this.oldRenderVdom=newRenderVdom;
        if(this.componentDidUpdate){
          this.componentDidUpdate(this.props,this.state);
        } 
        this.updater.callbacks.forEach(callback=&gt;callback());
        this.callbacks.length=0;
    }
}
</code></pre>
<h3 id="t969.3 react-dom.js">9.3 react-dom.js <a href="106.1.react.html#t969.3%20react-dom.js"> # </a></h3>
<p>src\react-dom.js</p>
<pre><code class="lang-diff">import { REACT_TEXT, REACT_FORWARD_REF_TYPE } from &apos;./constants&apos;;
import { addEvent } from &apos;./event&apos;;

function render(vdom, container) {
    let newDOM = createDOM(vdom);
    container.appendChild(newDOM);
    if (newDOM.componentDidMount) newDOM.componentDidMount();
}

function createDOM(vdom) {
    let { type, props, ref } = vdom;
    let dom;
    if (type&amp;&amp;type.$$typeof<span class="hljs-comment">===REACT_FORWARD_REF_TYPE) {</span>
        return mountForwardComponent(vdom);
    } else if (type <span class="hljs-comment">=== REACT_TEXT) {</span>
        dom = document.createTextNode(props.content);
    } else if (typeof type <span class="hljs-comment">=== &apos;function&apos;) {</span>
        if (type.isReactComponent) {
            return mountClassComponent(vdom);
        } else {
            return mountFunctionComponent(vdom);
        }
    } else {
        dom = document.createElement(type);
    }
    if (props) {
        updateProps(dom, {}, props);
        if (typeof props.children == &apos;object&apos; &amp;&amp; props.children.type) {
            render(props.children, dom);
        } else if (Array.isArray(props.children)) {
            reconcileChildren(props.children, dom);
        }
    }
    vdom.dom = dom;
    if (ref) ref.current = dom;
    return dom;
}
function mountForwardComponent(vdom) {
    let { type, props, ref } = vdom;
    let renderVdom = type.render(props, ref);
    vdom.oldRenderVdom = renderVdom;
    return createDOM(renderVdom);
}
function mountClassComponent(vdom) {
    let { type, props, ref } = vdom;
    let defaultProps = type.defaultProps || {};
    let classInstance = new type({ ...defaultProps, ...props });
    vdom.classInstance = classInstance;
    if (classInstance.componentWillMount) classInstance.componentWillMount();
    let renderVdom = classInstance.render();
    classInstance.oldRenderVdom = vdom.oldRenderVdom = renderVdom;
    if (ref) ref.current = classInstance;
    let dom = createDOM(renderVdom);
    if (classInstance.componentDidMount)
        dom.componentDidMount = classInstance.componentDidMount.bind(classInstance);
    return dom;
}
function mountFunctionComponent(vdom) {
    let { type, props } = vdom;
    let renderVdom = type(props);
    vdom.oldRenderVdom = renderVdom;
    return createDOM(renderVdom);
}
function reconcileChildren(childrenVdom, parentDOM) {
    for (let i = 0; i &lt; childrenVdom.length; i++) {
        let childVdom = childrenVdom[i];
        render(childVdom, parentDOM);
    }
}
function updateProps(dom, oldProps, newProps) {
    for (let key in newProps) {
        if (key <span class="hljs-comment">=== &apos;children&apos;) { continue; }</span>
        if (key <span class="hljs-comment">=== &apos;style&apos;) {</span>
            let styleObj = newProps[key];
            for (let attr in styleObj) {
                dom.style[attr] = styleObj[attr];
            }
        } else if (key.startsWith(&apos;on&apos;)) {
            addEvent(dom, key.toLocaleLowerCase(), newProps[key]);
        } else {
            dom[key] = newProps[key];
        }
    }
}

export function findDOM(vdom) {
    let { type } = vdom;
    let dom;
    if (typeof type <span class="hljs-comment">=== &apos;function&apos;) {</span>
        dom = findDOM(vdom.oldRenderVdom);
    } else {
        dom = vdom.dom;
    }
    return dom;
}

export function compareTwoVdom(parentDOM, oldVdom, newVdom, nextDOM) {
    if (!oldVdom &amp;&amp; !newVdom) {
    } else if ((!!oldVdom) &amp;&amp; (!newVdom)) {
        let currentDOM = findDOM(oldVdom);
        currentDOM.parentNode.removeChild(currentDOM);
        if (oldVdom.classInstance &amp;&amp; oldVdom.classInstance.componentWillUnmount) {
            oldVdom.classInstance.componentWillUnmount();
        }
    } else if (!oldVdom &amp;&amp; (!!newVdom)) {
        let newDOM = createDOM(newVdom);
<span class="hljs-addition">+       if (nextDOM)</span>
<span class="hljs-addition">+           parentDOM.insertBefore(newDOM, nextDOM);</span>
<span class="hljs-addition">+       else</span>
<span class="hljs-addition">+           parentDOM.appendChild(newDOM);</span>
        if (newDOM.componentDidMount) newDOM.componentDidMount();
        return;
    } else if ((!!oldVdom) &amp;&amp; (!!newVdom) &amp;&amp; (oldVdom.type !== newVdom.type)) {
        let oldDOM = findDOM(oldVdom);
        let newDOM = createDOM(newVdom);
        oldDOM.parentNode.replaceChild(newDOM, oldDOM);
        if (oldVdom.classInstance &amp;&amp; oldVdom.classInstance.componentWillUnmount) {
            oldVdom.classInstance.componentWillUnmount();
        }
        if (newDOM.componentDidMount) newDOM.componentDidMount();
    } else {
<span class="hljs-addition">+       updateElement(oldVdom, newVdom);</span>
    }
}
<span class="hljs-addition">+function updateElement(oldVdom, newVdom) {</span>
<span class="hljs-addition">+    if (oldVdom.type === REACT_TEXT &amp;&amp; newVdom.type === REACT_TEXT) {</span>
<span class="hljs-addition">+       let currentDOM = newVdom.dom = findDOM(oldVdom);</span>
<span class="hljs-addition">+       if (oldVdom.props.content !== newVdom.props.content) {</span>
<span class="hljs-addition">+           currentDOM.textContent = newVdom.props.content;</span>
<span class="hljs-addition">+       }</span>
<span class="hljs-addition">+       return;</span>
<span class="hljs-addition">+    }else if (typeof oldVdom.type === &apos;string&apos;) {</span>
<span class="hljs-addition">+        let currentDOM = newVdom.dom = findDOM(oldVdom);</span>
<span class="hljs-addition">+        updateProps(currentDOM, oldVdom.props, newVdom.props);</span>
<span class="hljs-addition">+        updateChildren(currentDOM, oldVdom.props.children, newVdom.props.children);</span>
<span class="hljs-addition">+    } else if (typeof oldVdom.type === &apos;function&apos;) {</span>
<span class="hljs-addition">+        if (oldVdom.type.isReactComponent) {</span>
<span class="hljs-addition">+            newVdom.classInstance = oldVdom.classInstance;</span>
<span class="hljs-addition">+            updateClassInstance(oldVdom, newVdom);</span>
<span class="hljs-addition">+        } else {</span>
<span class="hljs-addition">+            updateFunctionComponent(oldVdom, newVdom);</span>
<span class="hljs-addition">+        }</span>
<span class="hljs-addition">+    }</span>
<span class="hljs-addition">+}</span>
<span class="hljs-addition">+function updateFunctionComponent(oldVdom, newVdom) {</span>
<span class="hljs-addition">+    let parentDOM = findDOM(oldVdom).parentNode;</span>
<span class="hljs-addition">+    let { type, props } = newVdom;</span>
<span class="hljs-addition">+    let newRenderVdom = type(props);</span>
<span class="hljs-addition">+    compareTwoVdom(parentDOM, oldVdom.oldRenderVdom, newRenderVdom);</span>
<span class="hljs-addition">+    newVdom.oldRenderVdom = newRenderVdom;</span>
<span class="hljs-addition">+}</span>
<span class="hljs-addition">+function updateClassInstance(oldVdom, newVdom) {</span>
<span class="hljs-addition">+    let classInstance = newVdom.classInstance = oldVdom.classInstance;</span>
<span class="hljs-addition">+    newVdom.oldRenderVdom = oldVdom.oldRenderVdom;</span>
<span class="hljs-addition">+    if (classInstance.componentWillReceiveProps) {</span>
<span class="hljs-addition">+        classInstance.componentWillReceiveProps();</span>
<span class="hljs-addition">+    }</span>
<span class="hljs-addition">+    classInstance.updater.emitUpdate(newVdom.props);</span>
<span class="hljs-addition">+}</span>
<span class="hljs-addition">+function updateChildren(parentDOM, oldVChildren, newVChildren) {</span>
<span class="hljs-addition">+    oldVChildren = Array.isArray(oldVChildren) ? oldVChildren : [oldVChildren];</span>
<span class="hljs-addition">+    newVChildren = Array.isArray(newVChildren) ? newVChildren : [newVChildren];</span>
<span class="hljs-addition">+    let maxLength = Math.max(oldVChildren.length, newVChildren.length);</span>
<span class="hljs-addition">+    for (let i = 0; i &lt; maxLength; i++) {</span>
<span class="hljs-addition">+       let nextVNode = oldVChildren.find((item,index)=&gt;index&gt;i&amp;&amp;item&amp;&amp;findDOM(item));</span>
<span class="hljs-addition">+       compareTwoVdom(parentDOM, oldVChildren[i], newVChildren[i],nextVNode&amp;&amp;findDOM(nextVNode));</span>
<span class="hljs-addition">+    }</span>
<span class="hljs-addition">+}</span>
const ReactDOM = {
    render
}
export default ReactDOM;
</code></pre>
<h2 id="t9710.DOM-DIFF&#x7B97;&#x6CD5;">10.DOM-DIFF&#x7B97;&#x6CD5; <a href="106.1.react.html#t9710.DOM-DIFF%E7%AE%97%E6%B3%95"> # </a></h2>
<h3 id="t9810.1 React&#x4F18;&#x5316;&#x539F;&#x5219;">10.1 React&#x4F18;&#x5316;&#x539F;&#x5219; <a href="106.1.react.html#t9810.1%20React%E4%BC%98%E5%8C%96%E5%8E%9F%E5%88%99"> # </a></h3>
<ul>
<li>&#x53EA;&#x5BF9;&#x540C;&#x7EA7;&#x8282;&#x70B9;&#x8FDB;&#x884C;&#x5BF9;&#x6BD4;&#xFF0C;&#x5982;&#x679C;DOM&#x8282;&#x70B9;&#x8DE8;&#x5C42;&#x7EA7;&#x79FB;&#x52A8;&#xFF0C;&#x5219;React&#x4E0D;&#x4F1A;&#x590D;&#x7528;</li>
<li>&#x4E0D;&#x540C;&#x7C7B;&#x578B;&#x7684;&#x5143;&#x7D20;&#x4F1A;&#x4EA7;&#x51FA;&#x4E0D;&#x540C;&#x7684;&#x7ED3;&#x6784; &#xFF0C;&#x4F1A;&#x9500;&#x6BC1;&#x8001;&#x7ED3;&#x6784;&#xFF0C;&#x521B;&#x5EFA;&#x65B0;&#x7ED3;&#x6784;</li>
<li>&#x53EF;&#x4EE5;&#x901A;&#x8FC7;key&#x6807;&#x8BC6;&#x79FB;&#x52A8;&#x7684;&#x5143;&#x7D20;</li>
</ul>
<p><img src="https://img.zhufengpeixun.com/81b92f5eeab21a3f37fe7c3728ec13d4" alt="81b92f5eeab21a3f37fe7c3728ec13d4"></p>
<h2 id="t9911.&#x65B0;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;">11.&#x65B0;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F; <a href="106.1.react.html#t9911.%E6%96%B0%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"> # </a></h2>
<h3 id="t10011.1 Component.js">11.1 Component.js <a href="106.1.react.html#t10011.1%20Component.js"> # </a></h3>
<p>src\Component.js</p>
<pre><code class="lang-diff">import {findDOM,compareTwoVdom} from &apos;./react-dom&apos;;
export let updateQueue = {
  isBatchingUpdate:false,//&#x901A;&#x8FC7;&#x6B64;&#x53D8;&#x91CF;&#x6765;&#x63A7;&#x5236;&#x662F;&#x5426;&#x6279;&#x91CF;&#x66F4;&#x65B0;
  updaters:[],
  batchUpdate(){
    for(let updater of updateQueue.updaters){
      updater.updateComponent();
    }
    updateQueue.isBatchingUpdate=false;
    updateQueue.updaters.length=0;
  }
}
class Updater{
  constructor(classInstance){
    this.classInstance = classInstance;
    this.pendingStates = [];
    this.callbacks = [];
  }
  addState(partialState,callback){
    this.pendingStates.push(partialState);
    if(typeof callback <span class="hljs-comment">===&apos;function&apos;)</span>
       this.callbacks.push(callback)
    this.emitUpdate();   
  }
  emitUpdate(nextProps){
       this.nextProps  = nextProps;
       if(updateQueue.isBatchingUpdate){
         updateQueue.updaters.push(this);
       }else{
        this.updateComponent();
       }
  }
  updateComponent(){
     let {classInstance,pendingStates,nextProps} = this;   
     if(nextProps||pendingStates.length &gt; 0){
        shouldUpdate(classInstance,nextProps,this.getState());
     }
  }
  getState(){
    let {classInstance,pendingStates} = this;  
    let {state} = classInstance;
    pendingStates.forEach(nextState=&gt;{
       if(typeof nextState <span class="hljs-comment">=== &apos;function&apos;)  {</span>
        nextState=nextState(state);
       }  
       state = {...state,...nextState};
    });
    pendingStates.length = 0;
    return state;
  }
}
function shouldUpdate(classInstance,nextProps,nextState){
  let willUpdate = true;
  if(classInstance.shouldComponentUpdate
    &amp;&amp;(!classInstance.shouldComponentUpdate(nextProps,nextState))){
      willUpdate=false;
  }
  if(willUpdate &amp;&amp; classInstance.componentWillUpdate){
    classInstance.componentWillUpdate();
  }
  if(nextProps) classInstance.props = nextProps;
  classInstance.state = nextState;
  if(willUpdate){
    classInstance.forceUpdate();
  }
}
export class Component{
    static isReactComponent = true
    constructor(props){
        this.props = props;
        this.state = {};
        this.updater = new Updater(this);
    }
    setState(partialState,callback){
        this.updater.addState(partialState,callback);
    }
    forceUpdate(){

        let oldRenderVdom = this.oldRenderVdom;
        let oldDOM = findDOM(oldRenderVdom);
<span class="hljs-addition">+       if (classInstance.constructor.getDerivedStateFromProps) {</span>
<span class="hljs-addition">+            let newState = classInstance.constructor.getDerivedStateFromProps(this.props, this.state);</span>
<span class="hljs-addition">+            if (newState)</span>
<span class="hljs-addition">+              this.state = newState;</span>
<span class="hljs-addition">+       }</span>
<span class="hljs-addition">+       let extraArgs = this.getSnapshotBeforeUpdate &amp;&amp; this.getSnapshotBeforeUpdate();</span>
        let newRenderVdom = this.render();
        compareTwoVdom(oldDOM.parentNode,oldRenderVdom,newRenderVdom);
        this.oldRenderVdom=newRenderVdom;
        if(this.componentDidUpdate){
<span class="hljs-addition">+         this.componentDidUpdate(this.props,this.state,extraArgs);</span>
        } 
        this.updater.callbacks.forEach(callback=&gt;callback());
        this.callbacks.length=0;
    }
}
</code></pre>
<h2 id="t10112.context">12.context <a href="106.1.react.html#t10112.context"> # </a></h2>
<h3 id="t10212.1 src\index.js">12.1 src\index.js <a href="106.1.react.html#t10212.1%20src/index.js"> # </a></h3>
<pre><code class="lang-js"><span class="hljs-keyword">import</span> React, { Component } <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./react&apos;</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./react-dom&apos;</span>;
<span class="hljs-keyword">let</span> ThemeContext = React.createContext(<span class="hljs-literal">null</span>);
<span class="hljs-keyword">let</span> root = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">&apos;#root&apos;</span>);
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Header</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>{
    render() {
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ThemeContext.Consumer</span>&gt;</span>
                {
                    (value) =&gt; (
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">border:</span> `<span class="hljs-attr">5px</span> <span class="hljs-attr">solid</span> ${<span class="hljs-attr">value.color</span>}`, <span class="hljs-attr">padding:</span> &apos;<span class="hljs-attr">5px</span>&apos; }}&gt;</span>
                            header
                          <span class="hljs-tag">&lt;<span class="hljs-name">Title</span> /&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    )
                }
            <span class="hljs-tag">&lt;/<span class="hljs-name">ThemeContext.Consumer</span>&gt;</span></span>
        )
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Title</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>{
    render() {
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ThemeContext.Consumer</span>&gt;</span>
                {
                    (value) =&gt; (
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">border:</span> `<span class="hljs-attr">5px</span> <span class="hljs-attr">solid</span> ${<span class="hljs-attr">value.color</span>}` }}&gt;</span>
                            title
                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    )
                }
            <span class="hljs-tag">&lt;/<span class="hljs-name">ThemeContext.Consumer</span>&gt;</span></span>
        )
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Main</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>{
    render() {
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ThemeContext.Consumer</span>&gt;</span>
                {
                    (value) =&gt; (
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">border:</span> `<span class="hljs-attr">5px</span> <span class="hljs-attr">solid</span> ${<span class="hljs-attr">value.color</span>}`, <span class="hljs-attr">margin:</span> &apos;<span class="hljs-attr">5px</span>&apos;, <span class="hljs-attr">padding:</span> &apos;<span class="hljs-attr">5px</span>&apos; }}&gt;</span>
                            main
                        <span class="hljs-tag">&lt;<span class="hljs-name">Content</span> /&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    )
                }
            <span class="hljs-tag">&lt;/<span class="hljs-name">ThemeContext.Consumer</span>&gt;</span></span>
        )
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Content</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>{
    render() {
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ThemeContext.Consumer</span>&gt;</span>
                {
                    (value) =&gt; (
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">border:</span> `<span class="hljs-attr">5px</span> <span class="hljs-attr">solid</span> ${<span class="hljs-attr">value.color</span>}`, <span class="hljs-attr">padding:</span> &apos;<span class="hljs-attr">5px</span>&apos; }}&gt;</span>
                            Content
                            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> value.changeColor(&apos;red&apos;)} style={{ color: &apos;red&apos; }}&gt;&#x7EA2;&#x8272;<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> value.changeColor(&apos;green&apos;)} style={{ color: &apos;green&apos; }}&gt;&#x7EFF;&#x8272;<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    )
                }
            <span class="hljs-tag">&lt;/<span class="hljs-name">ThemeContext.Consumer</span>&gt;</span></span>

        )
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Page</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span></span>{
    <span class="hljs-keyword">constructor</span>(props) {
        <span class="hljs-keyword">super</span>(props);
        <span class="hljs-keyword">this</span>.state = { <span class="hljs-attr">color</span>: <span class="hljs-string">&apos;red&apos;</span> };
    }
    changeColor = <span class="hljs-function">(<span class="hljs-params">color</span>) =&gt;</span> {
        <span class="hljs-keyword">this</span>.setState({ color });
    }
    render() {
        <span class="hljs-keyword">let</span> contextVal = { <span class="hljs-attr">changeColor</span>: <span class="hljs-keyword">this</span>.changeColor, <span class="hljs-attr">color</span>: <span class="hljs-keyword">this</span>.state.color };
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ThemeContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{contextVal}</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">margin:</span> &apos;<span class="hljs-attr">10px</span>&apos;, <span class="hljs-attr">border:</span> `<span class="hljs-attr">5px</span> <span class="hljs-attr">solid</span> ${<span class="hljs-attr">this.state.color</span>}`, <span class="hljs-attr">padding:</span> &apos;<span class="hljs-attr">5px</span>&apos;, <span class="hljs-attr">width:</span> <span class="hljs-attr">200</span> }}&gt;</span>
                    page
                    <span class="hljs-tag">&lt;<span class="hljs-name">Header</span> /&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">Main</span> /&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">ThemeContext.Provider</span>&gt;</span></span>

        )
    }
}
ReactDOM.render(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Page</span> /&gt;</span></span>, root);
</code></pre>
<h3 id="t10312.2 src\react.js">12.2 src\react.js <a href="106.1.react.html#t10312.2%20src/react.js"> # </a></h3>
<p>src\react.js</p>
<pre><code class="lang-diff">import {wrapToVdom} from &apos;./utils&apos;;
import {Component} from &apos;./Component&apos;;
import {REACT_FORWARD_REF_TYPE} from &apos;./constants&apos;;
/**
 * 
 * @param {*} type &#x7C7B;&#x578B;
 * @param {*} config &#x914D;&#x7F6E;&#x5BF9;&#x8C61;
 * @param {*} children  &#x7B2C;&#x4E00;&#x4E2A;&#x513F;&#x5B50;
 * &#x591A;&#x4E2A;&#x513F;&#x5B50;&#x5C31;&#x662F;&#x6570;&#x7EC4;
 * &#x4E00;&#x4E2A;&#x513F;&#x5B50;&#x5C31;&#x662F;&#x5BF9;&#x8C61;&#x6216;&#x8005;null
 * &#x6CA1;&#x6709;&#x513F;&#x5B50;&#x5C31;&#x662F;undefined
 * &#x540E;&#x9762;&#x4F1A;&#x8BB2;dom-diff
 * @returns 
 */
function createElement(type,config,children){
    let ref;//&#x662F;&#x7528;&#x6765;&#x83B7;&#x53D6;&#x865A;&#x62DF;DOM&#x5B9E;&#x4F8B;&#x7684;
    let key;//&#x7528;&#x6765;&#x533A;&#x5206;&#x540C;&#x4E00;&#x4E2A;&#x7236;&#x4EB2;&#x7684;&#x4E0D;&#x540C;&#x513F;&#x5B50;&#x7684;
    if(config){
        delete config.__source;
        delete config.__self;
        ref = config.ref;
        delete config.ref;
        key = config.key;
        delete config.key;
    }
    let props = {...config};//&#x6CA1;&#x6709;ref&#x548C;key
    if(arguments.length&gt;3){//&#x5982;&#x679C;&#x53C2;&#x6570;&#x5927;&#x4E8E;3&#x4E2A;&#xFF0C;&#x8BF4;&#x660E;&#x6709;&#x591A;&#x4E2A;&#x513F;&#x5B50;
        //&#x6838;&#x5FC3;&#x5C31;&#x662F;&#x628A;&#x5B57;&#x7B26;&#x4E32;&#x6216;&#x8005;&#x8BF4;&#x6570;&#x5B57;&#x7C7B;&#x578B;&#x7684;&#x8282;&#x70B9;&#x8F6C;&#x6362;&#x6210;&#x5BF9;&#x8C61;&#x7684;&#x5F62;&#x5F0F;
        props.children = Array.prototype.slice.call(arguments,2).map(wrapToVdom);
    }else{
        //children&#x53EF;&#x80FD;&#x662F;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x4E5F;&#x53EF;&#x80FD;&#x662F;&#x4E00;&#x4E2A;&#x6570;&#x5B57;&#xFF0C;&#x4E5F;&#x53EF;&#x80FD;&#x662F;&#x4E2A;null undefined,&#x4E5F;&#x53EF;&#x80FD;&#x662F;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;
        props.children = wrapToVdom(children);
    }
    return {
        type,
        props,
        ref,
        key
    }
}
function createRef(){
    return {current:null};
}
/* function forwardRef(FunctionComponent){
  return class extends Component{
    render(){
        return FunctionComponent(this.props,this.props.ref);
    }
  }
} */

function forwardRef(render) {  
    var elementType = {
      $$typeof: REACT_FORWARD_REF_TYPE,
      render: render
    };
    return elementType;
}
<span class="hljs-addition">+function createContext() {</span>
<span class="hljs-addition">+  function Provider(props) {</span>
<span class="hljs-addition">+    Provider._value = props.value;</span>
<span class="hljs-addition">+    return props.children;</span>
<span class="hljs-addition">+  }</span>
<span class="hljs-addition">+  function Consumer(props) {</span>
<span class="hljs-addition">+    return props.children(Provider._value);</span>
<span class="hljs-addition">+  }</span>
<span class="hljs-addition">+  return {</span>
<span class="hljs-addition">+    Provider,</span>
<span class="hljs-addition">+    Consumer,</span>
<span class="hljs-addition">+  };</span>
<span class="hljs-addition">+}</span>
const React = {
    createElement,
    Component,
    createRef,
    forwardRef,
<span class="hljs-addition">+   createContext</span>
}
export default React;
</code></pre>
<h2 id="t10412.context">12.context <a href="106.1.react.html#t10412.context"> # </a></h2>
<h3 id="t10512.1 src\constants.js">12.1 src\constants.js <a href="106.1.react.html#t10512.1%20src/constants.js"> # </a></h3>
<p>src\constants.js</p>
<pre><code class="lang-diff"><span class="hljs-addition">+export const REACT_CONTEXT = Symbol(&apos;react.context&apos;);</span>
<span class="hljs-addition">+export const REACT_PROVIDER = Symbol(&apos;react.provider&apos;);</span>
</code></pre>
<h3 id="t10612.2 src\Component.js">12.2 src\Component.js <a href="106.1.react.html#t10612.2%20src/Component.js"> # </a></h3>
<p>src\Component.js</p>
<pre><code class="lang-diff">    forceUpdate(){
        let oldRenderVdom = this.oldRenderVdom;//&#x8001;&#x7684;&#x865A;&#x62DF;DOM
        //&#x6839;&#x636E;&#x8001;&#x7684;&#x865A;&#x62DF;DOM&#x67E5;&#x5230;&#x8001;&#x7684;&#x771F;&#x5B9E;DOM
        let oldDOM = findDOM(oldRenderVdom);
        if(this.constructor.contextType){
<span class="hljs-addition">+         this.context = this.constructor.contextType._currentValue;</span>
        }
        let newRenderVdom = this.render();//&#x8BA1;&#x7B97;&#x65B0;&#x7684;&#x865A;&#x62DF;DOM
        let extraArgs;
        if(this.getSnapshotBeforeUpdate){
          extraArgs = this.getSnapshotBeforeUpdate();
        }
        compareTwoVdom(oldDOM.parentNode,oldRenderVdom,newRenderVdom);//&#x6BD4;&#x8F83;&#x5DEE;&#x5F02;&#xFF0C;&#x628A;&#x66F4;&#x65B0;&#x540C;&#x6B65;&#x5230;&#x771F;&#x5B9E;DOM&#x4E0A;
        this.oldRenderVdom=newRenderVdom;
        if(this.componentDidUpdate){
          this.componentDidUpdate(this.props,this.state,extraArgs);
        } 
    }
</code></pre>
<h3 id="t10712.3 src\react.js">12.3 src\react.js <a href="106.1.react.html#t10712.3%20src/react.js"> # </a></h3>
<p>src\react.js</p>
<pre><code class="lang-diff"><span class="hljs-addition">+function createContext(){</span>
<span class="hljs-addition">+    let context ={$$typeof: REACT_CONTEXT};</span>
<span class="hljs-addition">+    context.Provider ={</span>
<span class="hljs-addition">+        $$typeof: REACT_PROVIDER,</span>
<span class="hljs-addition">+        _context:context</span>
<span class="hljs-addition">+    }</span>
<span class="hljs-addition">+    context.Consumer ={</span>
<span class="hljs-addition">+        $$typeof: REACT_CONTEXT,</span>
<span class="hljs-addition">+        _context:context</span>
<span class="hljs-addition">+    }</span>
<span class="hljs-addition">+    return context;</span>
<span class="hljs-addition">+}</span>
</code></pre>
<h3 id="t10812.4 src\react-dom.js">12.4 src\react-dom.js <a href="106.1.react.html#t10812.4%20src/react-dom.js"> # </a></h3>
<p>src\react-dom.js</p>
<pre><code class="lang-diff">import {REACT_TEXT,REACT_FORWARD_REF_TYPE,REACT_PROVIDER,REACT_CONTEXT} from &apos;./constants&apos;;
function createDOM(vdom){
    let {type,props,ref} = vdom;
    let dom;//&#x83B7;&#x53D6; &#x771F;&#x5B9E;DOM&#x5143;&#x7D20;
    //&#x5982;&#x679C;type.$$typeof&#x5C5E;&#x6027;&#x662F;REACT_FORWARD_REF_TYPE&#x503C;
    if(type&amp;&amp;type.$$typeof<span class="hljs-comment">===REACT_PROVIDER){</span>
        return mountProviderComponent(vdom)
    }else if(type&amp;&amp;type.$$typeof<span class="hljs-comment">===REACT_CONTEXT){</span>
        return mountContextComponent(vdom)
    }if(type&amp;&amp;type.$$typeof<span class="hljs-comment">===REACT_FORWARD_REF_TYPE){</span>
        return mountForwardComponent(vdom)
    }else if(type <span class="hljs-comment">=== REACT_TEXT){//&#x5982;&#x679C;&#x662F;&#x4E00;&#x4E2A;&#x6587;&#x672C;&#x5143;&#x7D20;&#xFF0C;&#x5C31;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x6587;&#x672C;&#x8282;&#x70B9;</span>
        dom = document.createTextNode(props.content);
    }else if(typeof type <span class="hljs-comment">=== &apos;function&apos;){//&#x8BF4;&#x660E;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;React&#x51FD;&#x6570;&#x7EC4;&#x4EF6;&#x7684;React&#x5143;&#x7D20;</span>
        if(type.isReactComponent){//&#x8BF4;&#x660E;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x7C7B;&#x7EC4;&#x4EF6;
            return mountClassComponent(vdom);
        }else{
            return mountFunctionComponent(vdom);
        }
    }else if(typeof type <span class="hljs-comment">=== &apos;string&apos;){</span>
        dom = document.createElement(type);//&#x539F;&#x751F;DOM&#x7C7B;&#x578B;
    }else{
        throw new Error(`&#x65E0;&#x6CD5;&#x5904;&#x7406;&#x7684;&#x5143;&#x7D20;&#x7C7B;&#x578B;`,type);
    } 
    if(props){
        updateProps(dom,{},props);//&#x6839;&#x636E;&#x865A;&#x62DF;DOM&#x4E2D;&#x7684;&#x5C5E;&#x6027;&#x66F4;&#x65B0;&#x771F;&#x5B9E;DOM&#x5C5E;&#x6027;
        if(typeof props.children == &apos;object&apos; &amp;&amp; props.children.type){//&#x5B83;&#x662F;&#x4E2A;&#x5BF9;&#x8C61; &#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x513F;&#x5B50;
            render(props.children,dom);
        }else if(Array.isArray(props.children)){//&#x5982;&#x679C;&#x662F;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;
            reconcileChildren(props.children,dom);
        }
    }
    //&#x8BA9;&#x865A;&#x62DF;DOM&#x7684;dom&#x5C5E;&#x751F;&#x6307;&#x5411;&#x5B83;&#x7684;&#x771F;&#x5B9E;DOM 
    vdom.dom = dom;
    if(ref)ref.current = dom;//&#x8BA9;ref.current&#x5C5E;&#x6027;&#x6307;&#x5411;&#x771F;&#x5B9E;DOM&#x7684;&#x5B9E;&#x4F8B;
    return dom;
}
function mountContextComponent(vdom){
    let {type,props} = vdom;
    let context = type._context;
    let renderVdom = props.children(context._currentValue);
    vdom.oldRenderVdom = renderVdom;
    return createDOM(renderVdom);
}
function mountProviderComponent(vdom){
    let {type,props} = vdom;
    let context = type._context;
    context._currentValue=props.value;
    let renderVdom = props.children;
    vdom.oldRenderVdom = renderVdom;
    return createDOM(renderVdom);
}

function mountClassComponent(vdom){
    let {type,props,ref} = vdom;
    let defaultProps = type.defaultProps||{};
    let classInstance = new type({...defaultProps,...props});
    if(type.contextType){
        classInstance.context = type.contextType._currentValue;
    }
    vdom.classInstance = classInstance;
    if(classInstance.componentWillMount)classInstance.componentWillMount();
    let renderVdom= classInstance.render();
    classInstance.oldRenderVdom = vdom.oldRenderVdom = renderVdom;//&#x6302;&#x8F7D;&#x7684;&#x65F6;&#x5019;&#x8BA1;&#x7B97;&#x51FA;&#x865A;&#x62DF;DOM&#xFF0C;&#x7136;&#x540E;&#x6302;&#x5230;&#x7C7B;&#x7684;&#x5B9E;&#x4F8B;&#x4E0A;
    if(ref) ref.current = classInstance;//ref.current&#x6307;&#x5411;&#x7C7B;&#x7EC4;&#x4EF6;&#x7684;&#x5B9E;&#x4F8B;
    let dom =  createDOM(renderVdom);
    //&#x6682;&#x65F6;&#x628A;didMount&#x65B9;&#x6CD5;&#x6682;&#x5B58;&#x5230;dom&#x4E0A;
    if(classInstance.componentDidMount)
        dom.componentDidMount=classInstance.componentDidMount.bind(classInstance);
    return dom;    
}
export function findDOM(vdom){
   let {type} = vdom;
   let dom;
   if(typeof type <span class="hljs-comment">=== &apos;string&apos;|| type === REACT_TEXT){//&#x865A;&#x62DF;DOM&#x7EC4;&#x4EF6;&#x7684;&#x7C7B;&#x578B;&#x7684;&#x8BDD;</span>
    dom = vdom.dom;
   }else{
       //&#x627E;&#x5B83;&#x7684;oldRenderVdom&#x7684;&#x771F;&#x5B9E;DOM&#x5143;&#x7D20;
    dom = findDOM(vdom.oldRenderVdom);

   }
   return dom;
}
function updateElement(oldVdom,newVdom){
    //&#x6587;&#x672C;&#x8282;&#x70B9;&#x7684;&#x66F4;&#x65B0;
    if(oldVdom.type.$$typeof <span class="hljs-comment">=== REACT_CONTEXT){</span>
        updateContextComponent(oldVdom,newVdom);
    }else if(oldVdom.type.$$typeof <span class="hljs-comment">=== REACT_PROVIDER){</span>
        updateProviderComponent(oldVdom,newVdom);
    }else if(oldVdom.type <span class="hljs-comment">=== REACT_TEXT &amp;&amp; newVdom.type === REACT_TEXT){</span>
        let currentDOM = newVdom.dom = findDOM(oldVdom);
        if(oldVdom.props.content!==newVdom.props.content)
            currentDOM.textContent = newVdom.props.content;
    }else if(typeof oldVdom.type <span class="hljs-comment">=== &apos;string&apos;){//&#x8BF4;&#x660E;&#x662F;&#x539F;&#x751F;&#x7EC4;&#x4EF6; div</span>
        //&#x8BA9;&#x65B0;&#x7684;&#x865A;&#x62DF;DOM&#x7684;&#x771F;&#x5B9E;DOM&#x5C5E;&#x6027;&#x7B49;&#x4E8E;&#x8001;&#x7684;&#x865A;&#x62DF;DOM&#x5BF9;&#x5E94;&#x7684;&#x90A3;&#x4E2A;&#x771F;&#x5B9E;DOM
        let currentDOM = newVdom.dom = findDOM(oldVdom);
        //&#x7528;&#x65B0;&#x7684;&#x5C5E;&#x6027;&#x66F4;&#x65B0;DOM&#x7684;&#x8001;&#x5C5E;&#x6027;
        updateProps(currentDOM,oldVdom.props,newVdom.props);
        updateChildren(currentDOM,oldVdom.props.children,newVdom.props.children);
    }else if(typeof oldVdom.type <span class="hljs-comment">=== &apos;function&apos;){</span>
        if(oldVdom.type.isReactComponent){//&#x8BF4;&#x660E;&#x662F;&#x4E00;&#x4E2A;&#x7C7B;&#x7EC4;&#x4EF6;
            updateClassComponent(oldVdom,newVdom);
        }else{
            updateFunctionComponent(oldVdom,newVdom);
        }
    }
}
function updateContextComponent(oldVdom,newVdom){
    let parentDOM = findDOM(oldVdom).parentNode;
    let {type,props} = newVdom;
    let context = type._context;
    let renderVdom = props.children(context._currentValue);
    compareTwoVdom(parentDOM,oldVdom.oldRenderVdom,renderVdom);
    newVdom.oldRenderVdom = renderVdom;
}
function updateProviderComponent(oldVdom,newVdom){
    let parentDOM = findDOM(oldVdom).parentNode;
    let {type,props} = newVdom;
    let context = type._context;
    context._currentValue=props.value;
    let renderVdom = props.children;
    compareTwoVdom(parentDOM,oldVdom.oldRenderVdom,renderVdom);
    newVdom.oldRenderVdom = renderVdom;
}
function updateFunctionComponent(oldVdom,newVdom){
    let parentDOM = findDOM(oldVdom).parentNode;
    let {type,props} = newVdom;
    let renderVdom = type(props);

    compareTwoVdom(parentDOM,oldVdom.oldRenderVdom,renderVdom);
    newVdom.oldRenderVdom = renderVdom;
}
</code></pre>
<h2 id="t10913.HOC">13.HOC <a href="106.1.react.html#t10913.HOC"> # </a></h2>
<h3 id="t11013.1 src\react.js">13.1 src\react.js <a href="106.1.react.html#t11013.1%20src/react.js"> # </a></h3>
<pre><code class="lang-diff">import {wrapToVdom} from &apos;./utils&apos;;
import {Component} from &apos;./Component&apos;;
import {REACT_FORWARD_REF_TYPE} from &apos;./constants&apos;;
/**
 * 
 * @param {*} type &#x7C7B;&#x578B;
 * @param {*} config &#x914D;&#x7F6E;&#x5BF9;&#x8C61;
 * @param {*} children  &#x7B2C;&#x4E00;&#x4E2A;&#x513F;&#x5B50;
 * &#x591A;&#x4E2A;&#x513F;&#x5B50;&#x5C31;&#x662F;&#x6570;&#x7EC4;
 * &#x4E00;&#x4E2A;&#x513F;&#x5B50;&#x5C31;&#x662F;&#x5BF9;&#x8C61;&#x6216;&#x8005;null
 * &#x6CA1;&#x6709;&#x513F;&#x5B50;&#x5C31;&#x662F;undefined
 * &#x540E;&#x9762;&#x4F1A;&#x8BB2;dom-diff
 * @returns 
 */
function createElement(type,config,children){
    let ref;//&#x662F;&#x7528;&#x6765;&#x83B7;&#x53D6;&#x865A;&#x62DF;DOM&#x5B9E;&#x4F8B;&#x7684;
    let key;//&#x7528;&#x6765;&#x533A;&#x5206;&#x540C;&#x4E00;&#x4E2A;&#x7236;&#x4EB2;&#x7684;&#x4E0D;&#x540C;&#x513F;&#x5B50;&#x7684;
    if(config){
        delete config.__source;
        delete config.__self;
        ref = config.ref;
        //delete config.ref;
        key = config.key;
        delete config.key;
    }
    let props = {...config};//&#x6CA1;&#x6709;ref&#x548C;key
    if(arguments.length&gt;3){//&#x5982;&#x679C;&#x53C2;&#x6570;&#x5927;&#x4E8E;3&#x4E2A;&#xFF0C;&#x8BF4;&#x660E;&#x6709;&#x591A;&#x4E2A;&#x513F;&#x5B50;
        //&#x6838;&#x5FC3;&#x5C31;&#x662F;&#x628A;&#x5B57;&#x7B26;&#x4E32;&#x6216;&#x8005;&#x8BF4;&#x6570;&#x5B57;&#x7C7B;&#x578B;&#x7684;&#x8282;&#x70B9;&#x8F6C;&#x6362;&#x6210;&#x5BF9;&#x8C61;&#x7684;&#x5F62;&#x5F0F;
        props.children = Array.prototype.slice.call(arguments,2).map(wrapToVdom);
    }else{
        //children&#x53EF;&#x80FD;&#x662F;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x4E5F;&#x53EF;&#x80FD;&#x662F;&#x4E00;&#x4E2A;&#x6570;&#x5B57;&#xFF0C;&#x4E5F;&#x53EF;&#x80FD;&#x662F;&#x4E2A;null undefined,&#x4E5F;&#x53EF;&#x80FD;&#x662F;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;
        props.children = wrapToVdom(children);
    }
    return {
        type,
        props,
        ref,
        key
    }
}
function createRef(){
    return {current:null};
}
/* function forwardRef(FunctionComponent){
  return class extends Component{
    render(){
        return FunctionComponent(this.props,this.props.ref);
    }
  }
} */

function forwardRef(render) {  
    var elementType = {
      type: REACT_FORWARD_REF_TYPE,
      render: render
    };
    return elementType;
}
function createContext() {
  function Provider(props) {
    Provider._value = props.value;
    return props.children;
  }
  function Consumer(props) {
    return props.children(Provider._value);
  }
  return {
    Provider,
    Consumer,
  };
}
<span class="hljs-addition">+function cloneElement(element,newProps,...newChildren){</span>
<span class="hljs-addition">+  let oldChildren = element.props&amp;&amp;element.props.children;</span>
<span class="hljs-addition">+  let children = [...(Array.isArray(oldChildren)?oldChildren:[oldChildren]),...newChildren]</span>
<span class="hljs-addition">+  .filter(item=&gt;item!==undefined)</span>
<span class="hljs-addition">+  .map(wrapToVdom);</span>
<span class="hljs-addition">+  if(children.length===1) children=children[0];</span>
<span class="hljs-addition">+  let props = {...element.props,...newProps,children};</span>
<span class="hljs-addition">+  return {...element,props};</span>
<span class="hljs-addition">+}</span>
const React = {
    createElement,
    Component,
    createRef,
    forwardRef,
    createContext,
<span class="hljs-addition">+   cloneElement</span>
}
export default React;
</code></pre>

    </div>
</div>
<div class="modal fade" id="loginModal" tabindex="-1" role="dialog"
    aria-labelledby="loginModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"
                    aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="loginModalLabel">请登录</h4>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label for="username" class="control-label">姓名:</label>
                        <input type="text" class="form-control" id="username" placeholder="珠峰架构VIP会员系统用户名">
                    </div>
                    <div class="form-group">
                        <label for="password" class="control-label">密码:</label>
                        <input type="text" class="form-control" id="password" placeholder="珠峰架构VIP会员系统密码">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default"
                    data-dismiss="modal">登录</button>
            </div>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
<script>
let zhufengjiagou = localStorage.getItem('zhufengjiagou');
const host = 'http://login.zhufengpeixun.com';
if(zhufengjiagou){
  fetch(host+'/check',{method:"GET",mode: 'cors',
　　headers: {'Content-Type': 'application/json', authorization: `Bearer ${zhufengjiagou}`}}).then(response => response.json()).then(res => {
    if(res.success){
     
    }else{
      $('#loginModal').modal('hide')
    }
  }) 
}else{
   $('#loginModal').modal('hide')
}

$('#loginModal').on('hidden.bs.modal', function (event) {
  var modal = $(this)
  let username = modal.find('.modal-body #username').val();
  let password = modal.find('.modal-body #password').val();
  fetch(host+'/login',{method:"POST",mode: 'cors',
　　headers: {'Content-Type': 'application/json'},
　　body:JSON.stringify({username,password})}).then(response => response.json()).then(res => {
  console.log(res);
    if(res.success){
      localStorage.setItem('zhufengjiagou',res.zhufengjiagou);
    }else{
      window.location.href = 'http://www.zhufengpeixun.cn';
    }
  })
})
</script>
<script>
$('.warpper .page-toc ul ul li a').on('click',function(){
  $('.warpper .page-toc ul ul li a').removeClass('my-active')
  $(this).addClass('my-active')
})
$('.logo').on('mouseenter',function(){
  $('.nav').height('450px');
})
$('.nav').on('mouseleave',function(){
  $('.nav').height('80px');
})
$('.logo').on('click',function(){
  $('.nav').css('display','none');
 $('.warpper').css('padding','0px');
})
</script>
</body>
</html>
